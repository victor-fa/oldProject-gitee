<app-left-nav></app-left-nav>
<div class="sessionAnalysis" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">

  <nz-card style="width: 100%;">
    <nz-card-tab>
      <nz-tabset nzSize="large" [(nzSelectedIndex)]="tabsetJson.currentNum">
        <nz-tab [nzTitle]="dataAppTemplate" (nzClick)="changePanel('sessionLog')" *ngIf="commonService.haveMenuPermission('children', '对话日志')">
          <ng-template #dataAppTemplate><i class="anticon anticon-message"></i>对话日志</ng-template>
          <form [formGroup]="searchSessionLogForm" *ngIf="currentPanel === 'sessionLog'">
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment">
                日期范围：
              </div>
              <div nz-col nzSpan="7" class="span_down">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyyMMdd'" nzShowTime [nzShowToday]="true"
                  [(ngModel)]="dateRange" [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange('date', $event)">
                </nz-range-picker>
              </div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="loadData('sessionLogSearch')" style="display: none"></button>
                <button nz-button nzType="primary" (click)="showSomething('explain', '')">
                  <i class="anticon anticon-question-circle-o"></i>数据说明？
                </button>
              </div>
              <div nz-col nzSpan="6"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="showSomething('orign', '')">来源筛选</button>
              </div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="showSomething('sessionLog', '')">
                  <i class="anticon anticon-plus-circle-o" *ngIf="!visiable.sessionLogSearch"></i>
                  <i class="anticon anticon-minus-circle-o" *ngIf="visiable.sessionLogSearch"></i>
                  {{visiable.sessionLogSearch ? '收起' : '展开'}}筛选区
                </button>
              </div>
            </div>
            <div style="background-color: #F7F7F7;padding: 10px 0px 0px 10px;margin-bottom: 10px;" *ngIf="visiable.sessionLogSearch">
              <div nz-row>
                <div nz-col nzSpan="24">
                  <div nz-row>
                    <div nz-col nzSpan="24">
                      <label nz-checkbox [(ngModel)]="allSessionBusinessChecked" (ngModelChange)="updateAllChecked()" [nzIndeterminate]="indeterminate" formControlName="checkA">全选</label>
                      <nz-checkbox-group [(ngModel)]="checkOptionsOne" (ngModelChange)="updateSingleChecked()" formControlName="checkB"></nz-checkbox-group>
                    </div>
                  </div>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="12">
                  <div nz-col nzSpan="12">
                    <input nz-input formControlName="ask" placeholder="关键词搜问句" type="text" nzSize="default">
                  </div>
                  <div nz-col nzSpan="12">
                    <input nz-input formControlName="answer" placeholder="关键词搜回答" type="text" nzSize="default">
                  </div>
                </div>
                <div nz-col nzSpan="12">
                  <div nz-col nzSpan="5">
                    <input nz-input formControlName="uid" [(ngModel)]="uid" placeholder="输入用户ID" type="text" nzSize="default">
                  </div>
                  <div nz-col nzSpan="4" class="span_down right_alignment" style="letter-spacing: 0px;">
                    会话内意图数&nbsp;<a (click)="chooseSessionCompare($event, 'conpareFirst')" style="letter-spacing: 7px;font-weight: bold;">{{conpareFirst === '<' ? '<' : '>'}}</a>
                  </div>
                  <div nz-col nzSpan="3" style="margin-right: -15px;">
                    <input nz-input formControlName="intentionNum" type="text" nzSize="default">
                  </div>
                  <div nz-col nzSpan="3" class="span_down right_alignment" style="letter-spacing: 0px;">
                    重复回答&nbsp;<a (click)="chooseSessionCompare($event, 'conpareSecond')" style="letter-spacing: 7px;font-weight: bold;">{{conpareSecond === '<' ? '<' : '>'}}</a>
                  </div>
                  <div nz-col nzSpan="3" style="margin-right: -15px;">
                    <input nz-input formControlName="repetitionNum" type="text" nzSize="default">
                  </div>
                  <div nz-col nzSpan="3" class="span_down right_alignment" style="letter-spacing: 0px;">
                    响应时长&nbsp;<a (click)="chooseSessionCompare($event, 'conpareThird')" style="letter-spacing: 7px;font-weight: bold;">{{conpareThird === '<' ? '<' : '>'}}</a>&nbsp;
                  </div>
                  <div nz-col nzSpan="2">
                    <input nz-input formControlName="cost" type="text" nzSize="default">
                  </div>
                  <div nz-col nzSpan="1" class="span_down">&nbsp;ms</div>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="1" class="span_down right_alignment" style="letter-spacing: -2px;">标记：</div>
                <div nz-col nzSpan="3" class="span_down">
                  <nz-select [(ngModel)]="sessionLogFlag" formControlName="flag">
                    <nz-option [nzLabel]="'全部'" [nzValue]="0"></nz-option>
                    <nz-option required [nzLabel]="'已标记'" [nzValue]="1"></nz-option>
                    <nz-option required [nzLabel]="'未标记'" [nzValue]="2"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down right_alignment" style="letter-spacing: -2px;">
                  异常回答：
                </div>
                <div nz-col nzSpan="3">
                  <nz-select [(ngModel)]="abnormalType" formControlName="abnormalType">
                    <nz-option [nzLabel]="'不筛选'" [nzValue]="''"></nz-option>
                    <nz-option [nzLabel]="'全部异常话术'" [nzValue]="'ALL'"></nz-option>
                    <nz-option [nzLabel]="'后端问题话术'" [nzValue]="'BACK_END'"></nz-option>
                    <nz-option [nzLabel]="'业务bot挽回话术'" [nzValue]="'BUSINESS_BOT_DETAINMENT'"></nz-option>
                    <nz-option [nzLabel]="'闲聊兜底话术'" [nzValue]="'FREE_CHAT_SPEECHLESS'"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down right_alignment">
                  账户类型：
                </div>
                <div nz-col nzSpan="3">
                  <nz-select nzMode="tags" style="width: 100%;" nzPlaceHolder="请选择账户类型" [(ngModel)]="accountType" formControlName="accountType">
                    <nz-option *ngFor="let option of listOfOption1" [nzLabel]="option.label" [nzValue]="option.value"> </nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down right_alignment">
                  特殊用户：
                </div>
                <div nz-col nzSpan="3">
                  <nz-select nzMode="tags" style="width: 100%;" nzPlaceHolder="请选择特殊用户" [(ngModel)]="specialUserCategoryIds" formControlName="specialUserCategoryIds">
                    <nz-option *ngFor="let option of listOfOption2" [nzLabel]="option.label" [nzValue]="option.value"> </nz-option>
                    <nz-option [nzLabel]="'非特殊用户'" [nzValue]="'NON-SPECIAL-USERS'"> </nz-option>
                  </nz-select>
                </div>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="3">
                <nz-select [(ngModel)]="sessionLogLevel" formControlName="level">
                  <nz-option required [nzLabel]="'只查询符合条件的问答'" [nzValue]="'QA'"></nz-option>
                  <nz-option required [nzLabel]="'包含相同BOT上下文'" [nzValue]="'INTENTION'"></nz-option>
                  <nz-option required [nzLabel]="'包含完整的上下文'" [nzValue]="'SESSION'"></nz-option>
                </nz-select>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="loadData('sessionLogSearch')"><i class="anticon anticon-search"></i>查询</button>
              </div>
              <div nz-col nzSpan="15" class="span_down">共搜索到 {{totalSessionLog}} 条数据</div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="getExcecl('sessionLog')"><i class="anticon anticon-export"></i>导出</button>
              </div>
            </div>
          </form>
          <nz-table #rowSelectionTable [nzData]="sessionLogData" [nzSimple]="true" [nzPageSize]="100" [nzShowPagination]="false" [nzScroll]="{x:'3200px'}" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="30px">序号</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[0].checked">用户ID</th>
                <th nzWidth="50px" *ngIf="checkDataOptions.sessionAnalysis[1].checked">日期</th>
                <th nzWidth="50px" *ngIf="checkDataOptions.sessionAnalysis[2].checked">时间</th>
                <th nzWidth="120px" *ngIf="checkDataOptions.sessionAnalysis[3].checked">用户问询</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[4].checked">BOT</th>
                <th nzWidth="200px" *ngIf="checkDataOptions.sessionAnalysis[5].checked">回答</th>
                <th nzWidth="30px" *ngIf="checkDataOptions.sessionAnalysis[6].checked">操作</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[7].checked">批注</th>
                <th nzWidth="30px" *ngIf="checkDataOptions.sessionAnalysis[8].checked">来源</th>
                <th nzWidth="30px" *ngIf="checkDataOptions.sessionAnalysis[9].checked">账户类型</th>
                <th nzWidth="30px" *ngIf="checkDataOptions.sessionAnalysis[10].checked">特殊用户</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[11].checked">会话ID</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[12].checked">意图ID</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[13].checked">对话ID</th>
                <th nzWidth="100px" *ngIf="checkDataOptions.sessionAnalysis[14].checked">中控回答</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[15].checked">总耗时</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[16].checked">子BOT耗时</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[17].checked">中控耗时</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[18].checked">异常回答</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[19].checked">重复回答</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[20].checked">会话轮数</th>
                <th nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[21].checked">会话内意图数量</th>
                <th nzWidth="100px" *ngIf="checkDataOptions.sessionAnalysis[22].checked">会话持续时长</th>
                <th nzWidth="30px" *ngIf="checkDataOptions.sessionAnalysis[23].checked">返回卡片信息</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionTable.data; let i=index;">
                <td nzWidth="30px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }">{{i+1}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[0].checked">{{data.uid}}</td>
                <!-- <td nzWidth="60px" *ngIf="checkDataOptions.sessionAnalysis[0].checked">{{data.uid}}</td> -->
                <td nzWidth="50px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[1].checked">{{data.create | date:'yy-MM-dd'}}</td>
                <td nzWidth="50px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[2].checked">{{data.create | date:'HH:mm:ss'}}</td>
                <td nzWidth="100px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[3].checked">{{data.ask}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[4].checked">{{data.business}}</td>
                <td nzWidth="200px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[5].checked" nzTitle="{{data.businessAnswer}}" nzPlacement="bottom" nz-tooltip>
                  <a>{{data.businessAnswer ? data.businessAnswer.length > 60 ? data.businessAnswer.substring(0, 60) + '…' : data.businessAnswer : 'null'}}</a>
                </td>
                <td nzWidth="30px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[6].checked">
                  <!-- <button nz-button nzType="primary" (click)="changeFlag(data, 'sessionLog')"><i class="anticon anticon-star"></i>{{data.flag ? '已标记' : '标记'}}</button> -->
                  <button nz-button nzType="primary" (click)="showSomething('changeFlag', data)"><i class="anticon anticon-star"></i>{{data.flag ? '已标记' : '标记'}}</button>
                </td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[7].checked">
                  {{data.remark ? data.remark : '--'}}
                </td>
                <td nzWidth="30px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[8].checked">
                  {{data.appkey}}
                </td>
                <td nzWidth="30px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[9].checked">
                  {{data.accountType === 'ORIGINAL' ? '首批账户' : data.accountType === 'GENERAL' ? '普通账户' : data.accountType === 'CUSTOMER_TEST' ? '客户测试账户' : data.accountType === 'CONSOLE_TEST' ? '控制台测试' : data.accountType === 'CONSOLE_AUTO_TEST' ? '控制台自动测试' : data.accountType === 'OTHER' ? '其他账户' : '其他账户'}}
                </td>
                <td nzWidth="30px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[10].checked">
                  {{data.specialUserCategory ? data.specialUserCategory.name : '非特殊用户'}}
                </td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[11].checked" nzTitle="{{data.sessionId}}" nzPlacement="bottom" nz-tooltip>
                  <a>{{data.sessionId ? data.sessionId.length > 6 ? data.sessionId.substring(0, 6) + '…' : data.sessionId : 'null'}}</a>
                </td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[12].checked" nzTitle="{{data.intentionId}}" nzPlacement="bottom" nz-tooltip>
                  <a>{{data.intentionId ? data.intentionId.length > 6 ? data.intentionId.substring(0, 6) + '…' : data.intentionId : 'null'}}</a>
                </td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[13].checked" nzTitle="{{data.id}}" nzPlacement="bottom" nz-tooltip>
                  <a>{{data.id ? data.id.length > 6 ? data.id.substring(0, 6) + '…' : data.id : 'null'}}</a>
                </td>
                <td nzWidth="100px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[14].checked" nzTitle="{{data.cpsAnswer}}" nzPlacement="bottom" nz-tooltip>
                  <a>{{data.cpsAnswer ? data.cpsAnswer.length > 12 ? data.cpsAnswer.substring(0, 12) + '…' : data.cpsAnswer : 'null'}}</a>
                </td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[15].checked">{{data.businessCost + data.cpsCost}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[16].checked">{{data.businessCost}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[17].checked">{{data.cpsCost}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[18].checked">{{data.abnormalStatement}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[19].checked">{{data.repeatedCounter}}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[20].checked">{{data.sessionRoundsNum  }}</td>
                <td nzWidth="60px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[21].checked">{{data.sessionIntentionsNum}}</td>
                <td nzWidth="100px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[22].checked">{{data.sessionDuration}}</td>
                <td nzWidth="30px" [ngStyle]="{'background-color': data.flag ? '#FFCCCC' : (data.color ? '#E0F5EB' : '#F2F2F2') }" *ngIf="checkDataOptions.sessionAnalysis[23].checked">
                  返回卡片信息~
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div nz-row style="margin: 10px 0;line-height: 30px;">
            <div nz-col nzSpan="12"></div>
            <div nz-col nzSpan="2">
              <nz-select [(ngModel)]="sessionLogPageSize">
                <nz-option required [nzLabel]="'5'" [nzValue]="5"></nz-option>
                <nz-option required [nzLabel]="'10'" [nzValue]="10"></nz-option>
                <nz-option required [nzLabel]="'20'" [nzValue]="20"></nz-option>
                <nz-option required [nzLabel]="'50'" [nzValue]="50"></nz-option>
              </nz-select>
            </div>
            <div nz-col nzSpan="1" ><button [disabled]="changeSessionLogPage === 1 || totalSessionLog === 0" nz-button nzType="primary" (click)="lastPage('sessionLog')"><i class="anticon anticon-left"></i></button></div>
            <div nz-col nzSpan="6">当前为 {{changeSessionLogPage}} / {{allSessionLogSize}} 页 &nbsp;&nbsp; 共 {{totalSessionLog}} 条</div>
            <div nz-col nzSpan="1"><button [disabled]="changeSessionLogPage === allSessionLogSize || totalSessionLog === 0" nz-button nzType="primary" (click)="nextPage('sessionLog')"><i class="anticon anticon-right"></i></button></div>
          </div>


          <nz-modal [(nzVisible)]="visiable.changeFlag" nzWidth="1250" nzTitle="标记批注" [nzFooter]="changeFlagModalFooter" (nzOnCancel)="showSomething('changeFlag', '')" nzMaskClosable="false">
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="3" class="right_alignment">用户问询：</div>
              <div nz-col nzSpan="14" class="left_alignment">{{checkFlag.ask}}</div>
              <div nz-col nzSpan="3" class="right_alignment">BOT：</div>
              <div nz-col nzSpan="4" class="left_alignment">{{checkFlag.business}}</div>
            </div><br>
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="3" class="right_alignment">回答：</div>
              <div nz-col nzSpan="19" class="left_alignment">{{checkFlag.businessAnswer}}</div>
            </div><br>
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="3" class="right_alignment">批注：</div>
              <div nz-col nzSpan="21" class="left_alignment">
                <!-- height: 70px -->
                <input nz-input [(ngModel)]="checkFlag.remark" placeholder="请输入批注" type="text" nzSize="default" (keyup.enter)="changeFlag('sessionLog')">
              </div>
            </div><br>
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="3" class="right_alignment">标记状态：</div>
              <div nz-col nzSpan="19" class="left_alignment"><label nz-checkbox [(ngModel)]="checkFlag.checked" (keyup.enter)="changeFlag('sessionLog')">已标记</label></div>
            </div>
            <ng-template #changeFlagModalFooter>
              <button nz-button nzType="default" (click)="changeFlag('sessionLog')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="showSomething('changeFlag', '')"><i class="anticon anticon-close-circle-o"></i>关闭</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.explain" nzWidth="1450" nzTitle="{{currentTitle}}数据说明" [nzFooter]="ecplainModalFooter" (nzOnCancel)="showSomething('explain', '')" nzMaskClosable="false">
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="2">
                <span style="line-height: 30px;">&nbsp;</span><br>
                <ng-container *ngIf="currentPanel === 'sessionLog'">
                  <ng-container *ngFor="let item of checkDataOptions.sessionAnalysis; let i=index;">
                    <label nz-checkbox [(nzChecked)]="item.checked" style="line-height: 31px;"></label><br>
                  </ng-container>
                </ng-container>
              </div>
              <div nz-col nzSpan="22">
                <img *ngIf="currentPanel === 'sessionLog'" [src]="'assets/images/sessionAnalysis.png'">
              </div>
            </div>
            <ng-template #ecplainModalFooter>
              <button nz-button nzType="default" (click)="showSomething('explain', '')"><i class="anticon anticon-close-circle-o"></i>关闭</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.orign" nzWidth="950" nzTitle="来源筛选" [nzFooter]="eorignModalFooter" (nzOnCancel)="showSomething('orign', '')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="2">来源：</div>
              <div nz-col nzSpan="5"><label nz-checkbox (ngModelChange)="onChange('allApp', $event)" [(ngModel)]="checkOrign.allApp">全选（APP）</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox (ngModelChange)="onChange('allSdk', $event)" [(ngModel)]="checkOrign.allSdk">全选（SDK）</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox (ngModelChange)="onChange('allApi', $event)" [(ngModel)]="checkOrign.allApi">全选（API）</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox (ngModelChange)="onChange('allTest', $event)" [(ngModel)]="checkOrign.allTest">全选（测试）</label></div>
            </div>
            <br>
            <div nz-row>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">手机：</div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.phone.xiaowu">你好小悟</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.phone.tingting">听听同学</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.phone.wotewode">沃特沃德6</label></div>
            </div>
            <br>
            <div nz-row>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">车机：</div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.car.botai">博泰车机api</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.car.tongxingApi">同行者车机api</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.car.tongxingSdk">同行者车机sdk</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.car.tongxingTest">同行者test</label></div>
            </div>
            <br>
            <div nz-row>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">手表：</div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.watch.weiteSdk">维特智能sdk</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.watch.weiteTest">维特智能test</label></div>
            </div>
            <br>
            <div nz-row>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">机器人：</div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.robot.xiaohaSdk">小哈机器人sdk</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.robot.xiaohaTest">小哈机器人test</label></div>
            </div>
            <br>
            <div nz-row>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">其他：</div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.other.k11Api">k11公共屏幕api</label></div>
              <div nz-col nzSpan="5"><label nz-checkbox [(ngModel)]="checkOrign.other.k11Test">k11 test</label></div>
            </div>
            <ng-template #eorignModalFooter>
              <button nz-button nzType="primary" (click)="showSomething('orign', '')"><i class="anticon anticon-save"></i>保存</button>
            </ng-template>
          </nz-modal>

        </nz-tab>






        <nz-tab [nzTitle]="specialUserTemplate" (nzClick)="changePanel('specialUser')" *ngIf="commonService.haveMenuPermission('children', '特殊用户')">
          <ng-template #specialUserTemplate><i class="anticon anticon-user"></i>特殊用户</ng-template>
          <div nz-row>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showSomething('addUserType', '')"><i class="anticon anticon-user-add"></i>新增用户类别</button>
            </div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showSomething('modifyUserType', '')"><i class="anticon anticon-edit"></i>修改用户类别</button>
            </div>
            <div nz-col nzSpan="13"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="doSave('refreshHistory')"><i class="anticon anticon-reload"></i>更新</button>
            </div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showSomething('addSpecialUser', '')"><i class="anticon anticon-user-add"></i>新增特殊用户</button>
            </div>
          </div>

          <nz-table #specialUserSelectionTable [nzData]="specialUserData" [nzSimple]="true" [nzShowPagination]="false" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户类别</th>
                <th>类别序号</th>
                <th>用户ID</th>
                <th>用户备注</th>
                <th>导入时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of specialUserSelectionTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.category.name}}</td>
                <td>{{data.category.order}}</td>
                <td>{{data.uid}}</td>
                <td>{{data.remark}}</td>
                <td>{{data.operatingTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="goUid(data)" style="margin-right: 10px"><i class="anticon anticon-search"></i>查询</button>
                  <button nz-button nzType="primary" (click)="showSomething('deleteSpecialUser', data.uid)"><i class="anticon anticon-delete"></i>删除</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <nz-modal [(nzVisible)]="visiable.addUserType" nzWidth="750" nzTitle="新增用户类别" [nzFooter]="addUserTypeModalFooter" (nzOnCancel)="showSomething('addUserType', '')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="4">增改用户类别：</div>
              <div nz-col nzSpan="8">用户类别</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="4">类别序号</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="5">
                <button nz-button nzType="primary" (click)="showSomething('addUserTypeItem', data)"><i class="anticon anticon-user-add"></i>新增</button>
              </div>
            </div>
            <div nz-row *ngFor="let data of userTypeData; let i=index;">
              <div nz-col nzSpan="4"></div>
              <div nz-col nzSpan="8">
                <input nz-input type="text" [(ngModel)]="data.name" nzSize="default" *ngIf="data.createTime === undefined">
                {{data.createTime !== undefined ? data.name : ''}}
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="4">
                <input nz-input type="text" [(ngModel)]="data.order" nzSize="default" *ngIf="data.createTime === undefined">
                {{data.createTime !== undefined ? data.order : ''}}
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="5" *ngIf="data.createTime === undefined">
                <button nz-button nzType="primary" (click)="showSomething('deleteUserType', i)"><i class="anticon anticon-delete"></i>删除</button>
              </div>
            </div>
            <ng-template #addUserTypeModalFooter>
              <button nz-button nzType="primary" (click)="doSave('addUserType')"><i class="anticon anticon-save"></i>确定</button>
              <button nz-button nzType="default" (click)="showSomething('addUserType', '')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.modifyUserType" nzWidth="750" nzTitle="修改用户类别" [nzFooter]="modifyUserTypeModalFooter" (nzOnCancel)="showSomething('modifyUserType', '')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="4">增改用户类别：</div>
              <div nz-col nzSpan="8">用户类别</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="4">类别序号</div>
              <div nz-col nzSpan="1"></div>
            </div>
            <div nz-row *ngFor="let data of userTypeData; let i=index;">
              <div nz-col nzSpan="4"></div>
              <div nz-col nzSpan="8">
                <input nz-input type="text" [(ngModel)]="data.name" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="4">
                <input nz-input type="text" [(ngModel)]="data.order" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="5">
                <button nz-button nzType="primary" (click)="showSomething('deleteUserTypeById', data.id)"><i class="anticon anticon-delete"></i>删除</button>
              </div>
            </div>
            <ng-template #modifyUserTypeModalFooter>
              <button nz-button nzType="primary" (click)="doSave('modifyUserType')"><i class="anticon anticon-save"></i>确定</button>
              <button nz-button nzType="default" (click)="showSomething('modifyUserType', '')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.addSpecialUser" nzWidth="750" nzTitle="新增特殊用户" [nzFooter]="addSpecialUserModalFooter" (nzOnCancel)="showSomething('addSpecialUser', '')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="6">特殊用户类型</div>
              <div nz-col nzSpan="18">
                <nz-select [(ngModel)]="dataSpecialUser.categoryId">
                  <nz-option *ngFor="let data of userTypeData; let i=index;" [nzLabel]="data.name" [nzValue]="data.id"></nz-option>
                </nz-select>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="24">可输入添加或以文件批量导入</div>
            </div>
            <div nz-row>
              <textarea rows="6" nz-input nzSize="default" [(ngModel)]="dataSpecialUser.content"></textarea>
            </div>
            <div nz-row>
              <div nz-col nzSpan="4" class="span_down">
                <a href="javascript:;" class="a-upload"><i class="anticon anticon-upload"></i>上传文件
                  <input type="file" (change)="getExcel($event)" multiple="false" />
                </a>
              </div>
              <div nz-col nzSpan="6" class="span_down" style="margin-top: 15px;">支持.CSV，.xls，.xlsx</div>
            </div>
            <ng-template #addSpecialUserModalFooter>
              <button nz-button nzType="primary" (click)="doSave('addSpecialUser')"><i class="anticon anticon-save"></i>确定</button>
              <button nz-button nzType="default" (click)="showSomething('addSpecialUser', '')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

        </nz-tab>

      </nz-tabset>
      <div class="spin" *ngIf="isSpinning">
        <nz-spin [nzSize]="'large'"></nz-spin>
      </div>
    </nz-card-tab>
  </nz-card>
</div>

