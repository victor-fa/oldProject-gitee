<app-left-nav></app-left-nav>
<div class="content" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">
  <nz-card>
    <nz-card-tab>
      <nz-tabset nzSize="large" [(nzSelectedIndex)]="tabsetJson.currentNum">

        <nz-tab [nzTitle]="couponTemplate" (nzClick)="changePanel('coupon')" *ngIf="commonService.haveMenuPermission('children', '优惠券配置')">
          <ng-template #couponTemplate><i class="anticon anticon-gift"></i>优惠券配置</ng-template>
          <div nz-row>
            <form [formGroup]="searchCouponForm">
              <div nz-col nzSpan="9" class="span_down">
                <nz-range-picker formControlName="date" [nzPlaceHolder]="['创建开始日期', '创建结束日期']" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'coupon')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券品类：</div>
              <div nz-col nzSpan="3">
                <nz-select [ngModel]="''" formControlName="couponCategory">
                  <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'全品类'" [nzValue]="'all'"></nz-option>
                  <nz-option required [nzLabel]="'机票'" [nzValue]="'flight'"></nz-option>
                  <nz-option required [nzLabel]="'火车'" [nzValue]="'hotel'"></nz-option>
                  <nz-option required [nzLabel]="'酒店'" [nzValue]="'train'"></nz-option>
                  <nz-option required [nzLabel]="'打车'" [nzValue]="'taxi'"></nz-option>
                </nz-select>
              </div>
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券名称：</div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="couponName" placeholder="输入订单编号" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券类型：</div>
              <div nz-col nzSpan="3">
                <nz-select [ngModel]="''" formControlName="discountType">
                  <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'满减固定额'" [nzValue]="'FIX_DISCOUNT'"></nz-option>
                  <nz-option required [nzLabel]="'满减百分比'" [nzValue]="'PERCENTAGE_DISCOUNT'"></nz-option>
                </nz-select>
              </div>
            </form>
          </div>
          <div nz-row>
            <div nz-col nzSpan="18" class="span_down right_alignment">如果想要废除某个优惠券，请联系产品人员</div>
            <div nz-col nzSpan="1"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="showModal('coupon', '')"><i class="anticon anticon-file-add"></i>新增优惠券</button>
            </div>
            <div nz-col nzSpan="1"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="doSearchCoupon('coupon')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #couponManagerTable [nzData]="dataCoupon" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">优惠券创建时间</th>
                <th nzWidth="20px">优惠券编号</th>
                <th nzWidth="20px">优惠券名称</th>
                <th nzWidth="20px">优惠券类型</th>
                <th nzWidth="20px">时间限制</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of couponManagerTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.ctime | date:'yyyy-MM-dd HH:mm'}}</td>
                <td>{{data.couponNo}}</td>
                <td>{{data.couponName}}</td>
                <td>{{data.couponCategory === 'all' ? '全品类' : data.couponCategory === 'flight' ? '订机票' : data.couponCategory === 'hotel' ? '订酒店' : data.couponCategory === 'train' ? '订火车' : '打车' }}</td>
                <td *ngIf="data.timeLimitType === 'fix_start_end'">{{data.timeLimitStart | date:'yyyy-MM-dd'}}&nbsp;至&nbsp;{{data.timeLimitEnd | date:'yyyy-MM-dd'}}</td>
                <td *ngIf="data.timeLimitType === 'fix_duration'">{{data.timeLimitValidDay}}</td>
                <td *ngIf="!data.timeLimitType">null</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('modifyCoupon', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>编辑</button>
                  <button nz-button nzType="primary" (click)="showModal('previewCoupon', data)" style="margin-right: 10px;"><i class="anticon anticon-eye-o"></i>查看</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="visiable.addCoupon" nzWidth="1150" nzTitle="新增优惠券" [nzFooter]="addCouponModalFooter" (nzOnCancel)="hideModal('addCoupon')" nzMaskClosable="false">
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment">红包名称：</div>
              <div nz-col nzSpan="4">
                <input nz-input maxlength="12" [(ngModel)]="couponDate.couponName" placeholder="请输入红包名称" nzSize="default">
              </div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">优惠规则</div></div>
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down">
                <nz-radio-group [(ngModel)]="couponDate.discountType">
                  <label nz-radio nzValue="FIX_DISCOUNT">满减固定额</label>
                  <label nz-radio nzValue="PERCENTAGE_DISCOUNT" [nzDisabled]="true">满减百分比</label>
                  <label nz-radio nzValue="PERCENTAGE_DISCOUNT" [nzDisabled]="true">满减随机额</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="12">
                <ng-container *ngFor="let item of couponDate.discountPrices; let i=index;">
                  <div nz-row style="margin-bottom: 5px;text-align: center;">
                    <div nz-col nzSpan="3" class="span_down">订单满</div>
                    <div nz-col nzSpan="5">
                      <input nz-input [(ngModel)]="item.main" nzSize="default">
                    </div>
                    <div nz-col nzSpan="2" class="span_down">减</div>
                    <div nz-col nzSpan="4">
                      <input nz-input [(ngModel)]="item.content" nzSize="default">
                    </div>
                    <div nz-col nzSpan="2" class="span_down">元</div>
                    <div nz-col nzSpan="4"><button nz-button nzType="primary" (click)="onChange(i, 'removeDiscountPrices')"><i class="anticon anticon-delete"></i>删除</button></div>
                    <div nz-col nzSpan="4"><button nz-button nzType="primary" (click)="onChange(i, 'addDiscountPrices')"><i class="anticon anticon-plus"></i>添加</button></div>
                  </div>
                </ng-container>
              </div>
              <div nz-col nzSpan="12">
                <div nz-col nzSpan="10" class="span_down" style="font-size: 12px;color: #A9A9A9">说明：例如，订单满100减20<br>可以定义阶梯满减规则，例如：订单满100减20；满300减50</div>
              </div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">时间限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down" style="text-align: center;">有效时间</div>
              <div nz-col nzSpan="5" class="span_down">
                <nz-radio-group [(ngModel)]="couponDate.timeLimitType">
                  <label nz-radio nzValue="fix_start_end">固定时间</label>
                  <label nz-radio nzValue="fix_duration">相对时间</label>
                </nz-radio-group>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="span_down" style="font-size: 12px;color: #A9A9A9">固定时间，指的是固定开始和结束日期<br>相对时间，指的是从用户领取之日，开始计算</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">相对时间-领取后0天，失效日期是用户领取当日的最后1秒<br>相对时间-领取后1天，失效日期是用户领取次日的最后1秒</div>
            </div>
            <div nz-row *ngIf="couponDate.timeLimitType === 'fix_start_end'">
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="9">
                <nz-range-picker [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'coupon')"></nz-range-picker>
              </div>
            </div>
            <div nz-row *ngIf="couponDate.timeLimitType === 'fix_duration'">
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">自领取之日起</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="2">
                <input nz-input maxlength="12" [(ngModel)]="couponDate.timeLimitValidDay" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="2">天</div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">品类限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="16" class="span_down" style="font-size: 20px;font-weight: bold;">
                <nz-table #rowCategoryAddTable [nzData]="category" [nzShowPagination]="false" (nzCurrentPageDataChange)="currentPageDataCouponChange($event)" (nzPageIndexChange)="refreshCouponStatus()" (nzPageSizeChange)="refreshCouponStatus()" *ngIf="!isSpinning">
                  <thead>
                    <tr>
                      <th nzShowCheckbox [(nzChecked)]="couponAllChecked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAll($event)"></th>
                      <th>全品类</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of rowCategoryAddTable.data">
                      <td nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="data.disabled" (nzCheckedChange)="refreshCouponStatus()"></td>
                      <td>{{data.name}}</td>
                    </tr>
                  </tbody>
                </nz-table>
                <div class="spin" *ngIf="isSpinning">
                  <nz-spin [nzSize]="'large'"></nz-spin>
                </div>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="span_down" style="font-size: 12px;">1. 默认勾选【全品类】，勾选【全品类】，下方全部勾选<br>2. 也可单独勾选【具体品类】</div>
            </div>
            <!-- <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">互斥限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="5" class="span_down">
                <label nz-checkbox [(nzChecked)]="checkCouponOptions[0].checked">{{checkCouponOptions[0].label}}</label><br>
                <label nz-checkbox [(nzChecked)]="checkCouponOptions[1].checked">{{checkCouponOptions[1].label}}</label>
              </div>
              <div nz-col nzSpan="18" class="span_down" style="font-size: 12px;color: #A9A9A9">
                默认不勾选，则无任何使用约束<br>勾选-活动不可用，则互斥限制
                在全平台（满x减y）活动的情况下，不允许使用<br>勾选-会员可用，则是会员身份方可使用，非会员不可用
              </div>
            </div> -->
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">红包预览</div>
              <div nz-col nzSpan="10" class="span_down" style="background-image: url('assets/images/couponBg.png'); background-size: 85% 90%; background-repeat: no-repeat; width: 469px; height: 209px; padding: 18px;">
                <div>
                  <div style="color: #01C44E;">{{couponDate.couponName}}</div>
                  <div>限{{couponDate.couponCategory === 'all' ? '全品类' : couponDate.couponCategory === 'flight' ? '订机票' : couponDate.couponCategory === 'hotel' ? '订酒店' : couponDate.couponCategory === 'train' ? '订火车' : '打车' }}使用</div>
                  <div>满{{couponDate.xxxxx}}元可用</div>
                  <div>{{couponDate.mutualExcludeRules === [] ? '不可与任何活动叠加使用' : couponDate.mutualExcludeRules }}</div>
                  <!-- <div>有效期至：{{couponEndDate | date:'yyyy-MM-dd hh:mm:ss'}}</div> -->
                  <div>有效期至：{{couponEndDate}}</div>
                </div>
              </div>
            </div>
            <ng-template #addCouponModalFooter>
              <button nz-button nzType="primary" (click)="doSave('addCoupon')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('addCoupon')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.modifyCoupon" nzWidth="1150" nzTitle="编辑优惠券" [nzFooter]="modifyCouponModalFooter" (nzOnCancel)="hideModal('modifyCoupon')" nzMaskClosable="false">
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment">红包名称：</div>
              <div nz-col nzSpan="4">
                <input nz-input maxlength="12" [(ngModel)]="couponDate.couponName" placeholder="请输入红包名称" nzSize="default">
              </div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">优惠规则</div></div>
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down">
                <nz-radio-group [ngModel]="couponDate.discountType">
                  <label nz-radio nzValue="FIX_DISCOUNT">满减固定额</label>
                  <label nz-radio nzValue="PERCENTAGE_DISCOUNT" [nzDisabled]="true">满减百分比</label>
                  <label nz-radio nzValue="PERCENTAGE_DISCOUNT" [nzDisabled]="true">满减随机额</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="12">
                <ng-container *ngFor="let item of couponDate.discountPrices; let i=index;">
                  <div nz-row style="margin-bottom: 5px;text-align: center;">
                    <div nz-col nzSpan="3" class="span_down">订单满</div>
                    <div nz-col nzSpan="5">
                      <input nz-input [(ngModel)]="item.main" nzSize="default">
                    </div>
                    <div nz-col nzSpan="2" class="span_down">减</div>
                    <div nz-col nzSpan="4">
                      <input nz-input [(ngModel)]="item.content" nzSize="default">
                    </div>
                    <div nz-col nzSpan="2" class="span_down">元</div>
                    <div nz-col nzSpan="4"><button nz-button nzType="primary" (click)="onChange(i, 'removeDiscountPrices')"><i class="anticon anticon-delete"></i>删除</button></div>
                    <div nz-col nzSpan="4"><button nz-button nzType="primary" (click)="onChange(i, 'addDiscountPrices')"><i class="anticon anticon-plus"></i>添加</button></div>
                  </div>
                </ng-container>
              </div>
              <div nz-col nzSpan="12">
                <div nz-col nzSpan="10" class="span_down" style="font-size: 12px;color: #A9A9A9">说明：例如，订单满100减20<br>可以定义阶梯满减规则，例如：订单满100减20；满300减50</div>
              </div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">时间限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down" style="text-align: center;">有效时间</div>
              <div nz-col nzSpan="5" class="span_down">
                <nz-radio-group [(ngModel)]="couponDate.timeLimitType">
                  <label nz-radio nzValue="fix_start_end">固定时间</label>
                  <label nz-radio nzValue="fix_duration">相对时间</label>
                </nz-radio-group>
                <br>
                {{couponDate.timeLimitStart}}&nbsp;至&nbsp;{{couponDate.timeLimitEnd}}
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="span_down" style="font-size: 12px;color: #A9A9A9">固定时间，指的是固定开始和结束日期<br>相对时间，指的是从用户领取之日，开始计算</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">相对时间-领取后0天，失效日期是用户领取当日的最后1秒<br>相对时间-领取后1天，失效日期是用户领取次日的最后1秒</div>
            </div>
            <div nz-row *ngIf="couponDate.timeLimitType === 'fix_start_end'">
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="9">
                <nz-range-picker [nzFormat]="'yyyy-MM-dd'" [(ngModel)]="dateRange" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'coupon')"></nz-range-picker>
              </div>
            </div>
            <div nz-row *ngIf="couponDate.timeLimitType === 'fix_duration'">
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">自领取之日起</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="2">
                <input nz-input maxlength="12" [(ngModel)]="couponDate.timeLimitValidDay" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="2">天</div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">品类限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="16" class="span_down" style="font-size: 20px;font-weight: bold;">
                <nz-table #rowCategoryModifyTable [nzData]="category" [nzShowPagination]="false" (nzCurrentPageDataChange)="currentPageDataCouponChange($event)" (nzPageIndexChange)="refreshCouponStatus()" (nzPageSizeChange)="refreshCouponStatus()" *ngIf="!isSpinning">
                  <thead>
                    <tr>
                      <th nzShowCheckbox [(nzChecked)]="couponAllChecked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAll($event)"></th>
                      <th>全品类</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of rowCategoryModifyTable.data">
                      <td nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="data.disabled" (nzCheckedChange)="refreshCouponStatus()"></td>
                      <td>{{data.name}}</td>
                    </tr>
                  </tbody>
                </nz-table>
                <div class="spin" *ngIf="isSpinning">
                  <nz-spin [nzSize]="'large'"></nz-spin>
                </div>
              </div>
              <div nz-col nzSpan="1">
              </div>
              <div nz-col nzSpan="7" class="span_down" style="font-size: 12px;">1. 默认勾选【全品类】，勾选【全品类】，下方全部勾选<br>2. 也可单独勾选【具体品类】</div>
            </div>
            <!-- <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">互斥限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="5" class="span_down">
                <label nz-checkbox [(nzChecked)]="checkCouponOptions[0].checked">{{checkCouponOptions[0].label}}</label><br>
                <label nz-checkbox [(nzChecked)]="checkCouponOptions[1].checked">{{checkCouponOptions[1].label}}</label>
              </div>
              <div nz-col nzSpan="18" class="span_down" style="font-size: 12px;color: #A9A9A9">
                默认不勾选，则无任何使用约束<br>勾选-活动不可用，则在全平台（满x减y）活动的情况下，不允许使用<br>勾选-会员可用，则是会员身份方可使用，非会员不可用
              </div>
            </div> -->
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">红包预览</div>
              <div nz-col nzSpan="10" class="span_down" style="background-image: url('assets/images/couponBg.png'); background-size: 85% 90%; background-repeat: no-repeat; width: 469px; height: 209px; padding: 18px;">
                <div>
                  <div style="color: #01C44E;">{{couponDate.couponName}}</div>
                  <div>限{{couponDate.couponCategory === 'all' ? '全品类' : couponDate.couponCategory === 'flight' ? '订机票' : couponDate.couponCategory === 'hotel' ? '订酒店' : couponDate.couponCategory === 'train' ? '订火车' : '打车' }}使用</div>
                  <!-- <div>满{{couponDate.thresholdPrice}}元可用</div> -->
                  <div>{{couponDate.mutualExcludeRules === [] ? '不可与任何活动叠加使用' : couponDate.mutualExcludeRules }}</div>
                  <div>有效期至：{{couponEndDate}}</div>
                </div>
              </div>
            </div>
            <ng-template #modifyCouponModalFooter>
              <button nz-button nzType="primary" (click)="doSave('modifyCoupon')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('modifyCoupon')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.previewCoupon" nzWidth="1150" nzTitle="查看优惠券" [nzFooter]="previewCouponModalFooter" (nzOnCancel)="hideModal('previewCoupon')" nzMaskClosable="false">
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down">红包名称：{{couponDate.couponName}}</div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">优惠规则</div></div>
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down">
                <nz-radio-group [ngModel]="'FIX_DISCOUNT'">
                  <label nz-radio nzValue="FIX_DISCOUNT" [nzDisabled]="true">满减固定额</label>
                  <label nz-radio nzValue="PERCENTAGE_DISCOUNT" [nzDisabled]="true">满减百分比</label>
                  <label nz-radio nzValue="PERCENTAGE_DISCOUNT" [nzDisabled]="true">满减随机额</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="12">
                <ng-container *ngFor="let item of couponDate.discountPrices; let i=index;">
                  <div nz-row style="margin-bottom: 5px; text-align: center;">
                    <div nz-col nzSpan="3" class="span_down">订单满</div>
                    <div nz-col nzSpan="5">
                      <input nz-input [(ngModel)]="item.main" nzSize="default">
                    </div>
                    <div nz-col nzSpan="2" class="span_down">减</div>
                    <div nz-col nzSpan="4">
                      <input nz-input [(ngModel)]="item.content" nzSize="default">
                    </div>
                    <div nz-col nzSpan="2" class="span_down">元</div>
                    <div nz-col nzSpan="4"><button nz-button nzType="primary" (click)="onChange(i, 'removeDiscountPrices')"><i class="anticon anticon-delete"></i>删除</button></div>
                    <div nz-col nzSpan="4"><button nz-button nzType="primary" (click)="onChange(i, 'addDiscountPrices')"><i class="anticon anticon-plus"></i>添加</button></div>
                  </div>
                </ng-container>
              </div>
              <div nz-col nzSpan="12">
                <div nz-col nzSpan="10" class="span_down" style="font-size: 12px;color: #A9A9A9">说明：例如，订单满100减20<br>可以定义阶梯满减规则，例如：订单满100减20；满300减50</div>
              </div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">时间限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down" style="text-align: center;">有效时间</div>
              <div nz-col nzSpan="5" class="span_down">
                <nz-radio-group [(ngModel)]="couponDate.timeLimitType">
                  <label nz-radio nzValue="fix_start_end" [nzDisabled]="true">固定时间</label>
                  <label nz-radio nzValue="fix_duration" [nzDisabled]="true">相对时间</label>
                </nz-radio-group>
                <br>
                <div *ngIf="couponDate.timeLimitType === 'fix_start_end'">{{couponDate.timeLimitStart}} &nbsp; 至 &nbsp; {{couponDate.timeLimitEnd}}</div>
                <div *ngIf="couponDate.timeLimitType === 'fix_duration'">
                  自领取之日起&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{couponDate.timeLimitValidDay}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;天
                </div>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="span_down" style="font-size: 12px;color: #A9A9A9">固定时间，指的是固定开始和结束日期<br>相对时间，指的是从用户领取之日，开始计算</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">相对时间-领取后0天，失效日期是用户领取当日的最后1秒<br>相对时间-领取后1天，失效日期是用户领取次日的最后1秒</div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">品类限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="16" class="span_down" style="font-size: 20px;font-weight: bold;">
                <nz-table #rowCategoryPreviewTable [nzData]="category" [nzShowPagination]="false" (nzCurrentPageDataChange)="currentPageDataCouponChange($event)" (nzPageIndexChange)="refreshCouponStatus()" (nzPageSizeChange)="refreshCouponStatus()" *ngIf="!isSpinning">
                  <thead>
                    <tr>
                      <th nzShowCheckbox [(nzChecked)]="couponAllChecked" [nzDisabled]="true" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAll($event)"></th>
                      <th>全品类</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of rowCategoryPreviewTable.data">
                      <td nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="true" (nzCheckedChange)="refreshCouponStatus()"></td>
                      <td>{{data.name}}</td>
                    </tr>
                  </tbody>
                </nz-table>
                <div class="spin" *ngIf="isSpinning">
                  <nz-spin [nzSize]="'large'"></nz-spin>
                </div>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="span_down" style="font-size: 12px;">1. 默认勾选【全品类】，勾选【全品类】，下方全部勾选<br>2. 也可单独勾选【具体品类】</div>
            </div>
            <!-- <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">互斥限制</div></div>
            <div nz-row>
              <div nz-col nzSpan="5" class="span_down">
                <label nz-checkbox [(nzChecked)]="checkCouponOptions[0].checked" [nzDisabled]="true">{{checkCouponOptions[0].label}}</label><br>
                <label nz-checkbox [(nzChecked)]="checkCouponOptions[1].checked" [nzDisabled]="true">{{checkCouponOptions[1].label}}</label>
              </div>
              <div nz-col nzSpan="18" class="span_down" style="font-size: 12px;color: #A9A9A9">
                默认不勾选，则无任何使用约束<br>勾选-活动不可用，则在全平台（满x减y）活动的情况下，不允许使用<br>勾选-会员可用，则是会员身份方可使用，非会员不可用
              </div>
            </div> -->
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">红包预览</div>
              <div nz-col nzSpan="10" class="span_down" style="background-image: url('assets/images/couponBg.png'); background-size: 85% 90%; background-repeat: no-repeat; width: 469px; height: 209px; padding: 18px;">
                <div>
                  <div style="color: #01C44E;">{{couponDate.couponName}}</div>
                  <div>限{{couponDate.couponCategory === 'all' ? '全品类' : couponDate.couponCategory === 'flight' ? '订机票' : couponDate.couponCategory === 'hotel' ? '订酒店' : couponDate.couponCategory === 'train' ? '订火车' : '打车' }}使用</div>
                  <!-- <div>满{{couponDate.thresholdPrice}}元可用</div> -->
                  <div>{{couponDate.mutualExcludeRules === [] ? '不可与任何活动叠加使用' : couponDate.mutualExcludeRules }}</div>
                  <div>有效期至：{{couponEndDate}}</div>
                </div>
              </div>
            </div>
            <ng-template #previewCouponModalFooter>
              <button nz-button nzType="default" (click)="hideModal('previewCoupon')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab [nzTitle]="activityTemplate" (nzClick)="changePanel('activity')" *ngIf="commonService.haveMenuPermission('children', '优惠券活动')">
          <ng-template #activityTemplate><i class="anticon anticon-shop"></i>优惠券活动</ng-template>
          <div nz-row>
            <form [formGroup]="searchActivityForm">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">活动名称：</div>
              <div nz-col nzSpan="5">
                <input nz-input formControlName="actName" placeholder="请输入渠道" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">活动状态：</div>
              <div nz-col nzSpan="5">
                <nz-select [ngModel]="''" formControlName="actStatus">
                  <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'未知'" [nzValue]="'Unknown'"></nz-option>
                  <nz-option required [nzLabel]="'活动前'" [nzValue]="'Before'"></nz-option>
                  <nz-option required [nzLabel]="'活动中'" [nzValue]="'OnGoing'"></nz-option>
                  <nz-option required [nzLabel]="'活动后'" [nzValue]="'After'"></nz-option>
                </nz-select>
              </div>
            </form>
            <div nz-col nzSpan="5"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('activity')"><i class="anticon anticon-search"></i>查询</button>
            </div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showModal('addActivity', '')"><i class="anticon anticon-file-add"></i>新增活动</button>
            </div>
          </div>
          <nz-table #contentTable [nzData]="dataActivity" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">活动名称</th>
                <th nzWidth="20px">活动状态</th>
                <th nzWidth="20px">活动时间</th>
                <th nzWidth="20px">关联红包数</th>
                <th nzWidth="20px">已领取/剩余</th>
                <th nzWidth="20px">操作人</th>
                <th nzWidth="20px">创建时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of contentTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.actName}}</td>
                <td>{{data.actStatus === 'Unknown' ? '未知' : data.actStatus === 'Before' ? '活动前' : data.actStatus === 'OnGoing' ? '活动中' : '活动后'}}</td>
                <td>{{data.actStartDate | date:'yyyy-MM-dd HH:mm'}}</td>
                <td>{{data.allQuantity}}</td>
                <td>{{data.actTypeBo !== undefined && data.actTypeBo.consumedQuantity !== undefined ? data.actTypeBo.consumedQuantity + '/' : 'null'}}{{data.actTypeBo !== undefined && data.actTypeBo.perUserQuantity !== undefined ? data.actTypeBo.perUserQuantity : ''}}</td>
                <td>{{data.operator}}</td>
                <td>{{data.ctime | date:'yyyy-MM-dd HH:mm'}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('modifyActivity', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>编辑</button>
                  <button nz-button nzType="primary" (click)="doDelete(data, 'activity')" style="margin-right: 10px;"><i class="anticon anticon-delete"></i>删除</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="visiable.addActivity" nzWidth="1550" nzTitle="{{isModifyModelShow ? '修改活动' : '新增活动'}}" [nzFooter]="addContentModalFooter" (nzOnCancel)="hideModal('activity')" nzMaskClosable="false">
            <form [formGroup]="addActivityForm">
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
              <div nz-row>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动名称：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="12" [(ngModel)]="modifyctivityItem.actName" formControlName="actName" placeholder="请输入活动名称" nzSize="default">
                  </div>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动时间：</div>
                <div nz-col nzSpan="7" class="span_down">
                  <nz-range-picker formControlName="date" [(ngModel)]="dateRange" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'baseInfo')"></nz-range-picker>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动规则：</div>
                <div nz-col nzSpan="7" class="span_down">
                  <textarea rows="5" formControlName="actRuleDesc" [(ngModel)]="modifyctivityItem.actRuleDesc" maxlength="200" nz-input placeholder="输入活动规则，不超过200个字符"></textarea>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动图片：</div>
                <div nz-col nzSpan="12">
                  <nz-upload [(nzFileList)]="fileList" [nzShowButton]="fileList.length < 1" nzMultiple [nzBeforeUpload]="beforeUpload">
                    <button nz-button>
                      <i class="anticon anticon-upload"></i><span>选择文件</span>
                    </button>
                  </nz-upload>
                </div>
                <div nz-col nzSpan="7"></div>
                <div nz-col nzSpan="3">
                  <button [disabled]="baseInfoId === ''" nz-button nzType="primary" (click)="showModal('preview', '')"><i class="anticon anticon-eye-o"></i>活动页预览</button>
                </div>
              </div>
              <div nz-row>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动链接：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input [(ngModel)]="modifyctivityItem.actPageUrl" formControlName="actPageUrl" placeholder="请输入活动链接" nzSize="default">
                  </div>
                </div>
              </div>
              <!-- <font color="#cccccc">建议尺寸：110*110&nbsp;&nbsp;限制大小：50K</font> -->
              <div nz-row *ngIf="fileList.length === 1">
                <div nz-col nzSpan="2" class="span_down right_alignment"></div>
                <div nz-col nzSpan="22">
                  <img *ngIf="showImageUrl" [src]="showImageUrl" class="image-panel">
                </div>
              </div>
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">活动规则配置</div></div>
              <div nz-row>
                <div nz-col nzSpan="24" class="span_down">
                  <nz-radio-group [(ngModel)]="activityRadioValue" formControlName="actType">
                    <label nz-radio nzValue="LoginOneOff">单日登录</label>
                    <label nz-radio nzValue="LoginDaily">周期登录</label>
                    <label nz-radio nzValue="ChargeOneOff">单笔充值</label>
                    <label nz-radio nzValue="ChargeMargin">区间充值</label>
                  </nz-radio-group>
                </div>
              </div>
              <!-- 规则1 -->
              <div *ngIf="activityRadioValue === 'LoginOneOff'">
                <div nz-row>
                  <div nz-col nzSpan="24">模板A&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;单日登录，领取红包（组）</div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">登录时间约束：</div>
                  <div nz-col nzSpan="7" class="span_down">
                    <nz-range-picker formControlName="date" [(ngModel)]="dateRangeA" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'rule')" nzShowTime></nz-range-picker>
                  </div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">奖励发放上限：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="9" [(ngModel)]="modifyctivityItem.totalQuantity" formControlName="totalQuantity" placeholder="请输入奖励发放上限" nzSize="default">
                  </div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">每个用户可领：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="2" [(ngModel)]="modifyctivityItem.perUserQuantity" formControlName="perUserQuantity" placeholder="请输入每个用户可领" nzSize="default">
                  </div>
                  <div nz-col nzSpan="2"></div>
                  <div nz-col nzSpan="3">
                    <nz-select [ngModel]="''" formControlName="temp" [ngModel]="addMarginArr[i].actGiftNo" (ngModelChange)="onMarginChange($event, 'actGiftNo', 0)">
                      <ng-container *ngFor="let item of actGiftNoArr">
                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                      </ng-container>
                    </nz-select>
                  </div>
                  <div nz-col nzSpan="3"></div>
                  <div nz-col nzSpan="7" style="color: #A2A2A2;">活动只能选1天<br>规定时间内，每个人只能领取1次</div>
                </div>
              </div>
              <!-- 规则2 -->
              <div *ngIf="activityRadioValue === 'LoginDaily'">
                <div nz-row>
                  <div nz-col nzSpan="24">模板B&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;单周期登录，领取红包（组）</div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">登录时间约束：</div>
                  <div nz-col nzSpan="7" class="span_down">
                    <nz-range-picker formControlName="date" [(ngModel)]="dateRangeA" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'rule')" nzShowTime></nz-range-picker>
                  </div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">奖励发放上限：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="9" [(ngModel)]="modifyctivityItem.totalQuantity" formControlName="totalQuantity" placeholder="请输入奖励发放上限" nzSize="default">
                  </div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">每个用户可领：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="2" [(ngModel)]="modifyctivityItem.perUserQuantity" formControlName="perUserQuantity" placeholder="请输入每个用户可领" nzSize="default">
                  </div>
                  <div nz-col nzSpan="2"></div>
                  <div nz-col nzSpan="3">
                    <nz-select [ngModel]="''" formControlName="temp" [ngModel]="addMarginArr[i].actGiftNo" (ngModelChange)="onMarginChange($event, 'actGiftNo', 0)">
                      <ng-container *ngFor="let item of actGiftNoArr">
                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                      </ng-container>
                    </nz-select>
                  </div>
                  <div nz-col nzSpan="3"></div>
                  <div nz-col nzSpan="7" style="color: #A2A2A2;">时间可选多天<br>规定时间内，每个人每天只能领取1次<br>（如果活动3天，每个自然日领取1次，总计3次）</div>
                </div>
              </div>
              <!-- 规则3 -->
              <div *ngIf="activityRadioValue === 'ChargeOneOff'">
                <div nz-row>
                  <div nz-col nzSpan="24">模板C&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;单笔充值X元，获赠红包（组）</div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">充值时间约束：</div>
                  <div nz-col nzSpan="7" class="span_down">
                    <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'rule')" nzShowTime></nz-range-picker>
                    <div *ngIf="isModifyModelShow && modifyctivityItem.actTypeStart!== ''">{{modifyctivityItem.actTypeStart}}&nbsp;&nbsp;至&nbsp;&nbsp;{{modifyctivityItem.actTypeEnd}}</div>
                  </div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">充值额度约束：</div>
                  <div nz-col nzSpan="2" class="span_down right_alignment">充值额度=&nbsp;&nbsp;&nbsp;</div>
                  <div nz-col nzSpan="5" class="span_down">
                    <input nz-input maxlength="9" [(ngModel)]="modifyctivityItem.chargeThreshold" formControlName="chargeThreshold" placeholder="请输入充值额度" nzSize="default">
                  </div>
                  <div nz-col nzSpan="2" class="span_down">&nbsp;&nbsp;&nbsp;RMB</div>
                  <div nz-col nzSpan="6"></div>
                  <div nz-col nzSpan="7" style="color: #A2A2A2;">23点59分59秒，发起了充值请求行为<br>如果用户充值成功，则是在次日0点0分20秒<br>此时要给用户结算奖励</div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">奖励发放上限：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="9" [(ngModel)]="modifyctivityItem.totalQuantity" formControlName="totalQuantity" placeholder="请输入奖励发放上限" nzSize="default">
                  </div>
                  <div nz-col nzSpan="8">&nbsp;&nbsp;&nbsp;组</div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">每个用户可领：</div>
                  <div nz-col nzSpan="7">
                    <input nz-input maxlength="2" [(ngModel)]="modifyctivityItem.perUserQuantity" formControlName="perUserQuantity" placeholder="请输入每个用户可领" nzSize="default">
                  </div>
                  <div nz-col nzSpan="2">&nbsp;&nbsp;&nbsp;组</div>
                  <div nz-col nzSpan="3">
                    <nz-select [ngModel]="''" formControlName="temp" [ngModel]="addMarginArr[i].actGiftNo" (ngModelChange)="onMarginChange($event, 'actGiftNo', 0)">
                      <ng-container *ngFor="let item of actGiftNoArr">
                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                      </ng-container>
                    </nz-select>
                  </div>
                  <div nz-col nzSpan="3"></div>
                  <div nz-col nzSpan="7" style="color: #A2A2A2;">活动周期内<br>充值100RMB，可领取1组红包</div>
                </div>
              </div>
              <!-- 规则4 -->
              <div *ngIf="activityRadioValue === 'ChargeMargin'">
                <div nz-row>
                  <div nz-col nzSpan="24">模板D&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;区间充值，获赠红包（组）</div>
                </div>
                <div nz-row>
                  <div nz-col nzSpan="2" class="span_down right_alignment">充值时间约束：</div>
                  <div nz-col nzSpan="7" class="span_down">
                    <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'rule')" nzShowTime></nz-range-picker>
                    <div *ngIf="isModifyModelShow && modifyctivityItem.actTypeStart!== ''">{{modifyctivityItem.actTypeStart}}&nbsp;&nbsp;至&nbsp;&nbsp;{{modifyctivityItem.actTypeEnd}}</div>
                  </div>
                </div>
              </div>
            </form>

            <!-- 规则4 -->
            <div *ngIf="activityRadioValue === 'ChargeMargin'">
              <div nz-row>
                <div nz-col nzSpan="20">
                  <ng-container *ngFor="let item of addMarginArr; let i=index;">
                    <div nz-row>
                      <div nz-col nzSpan="2"></div>
                      <div nz-col nzSpan="2" class="span_down right_alignment">充值额度约束：</div>
                      <div nz-col nzSpan="2" class="span_down right_alignment">充值额度=&nbsp;&nbsp;&nbsp;</div>
                      <div nz-col nzSpan="5" class="span_down">
                        <input nz-input maxlength="9" [ngModel]="addMarginArr[i].chargeThreshold" (ngModelChange)="onMarginChange($event, 'chargeThreshold', i)" placeholder="请输入充值额度约束" nzSize="default">
                      </div>
                      <div nz-col nzSpan="2" class="span_down">&nbsp;&nbsp;&nbsp;RMB</div>
                      <div nz-col nzSpan="8">&nbsp;</div>
                      <div nz-col nzSpan="3" *ngIf="i === 0">
                        <button nz-button nzType="primary" (click)="clickChangeMargin('activity', 'add', addMarginArr.length)"><i class="anticon anticon-file-add"></i>添加区间</button>
                      </div>
                    </div>
                    <div nz-row>
                      <div nz-col nzSpan="2">
                        区间{{i+1}}
                      </div>
                      <div nz-col nzSpan="2" class="span_down right_alignment">奖励发放上限：</div>
                      <div nz-col nzSpan="7">
                        <input nz-input maxlength="2" [ngModel]="addMarginArr[i].totalQuantity" (ngModelChange)="onMarginChange($event, 'totalQuantity', i)" placeholder="请输入奖励发放上限" nzSize="default">
                      </div>
                    </div>
                    <div nz-row>
                      <div nz-col nzSpan="2"></div>
                      <div nz-col nzSpan="2" class="span_down right_alignment">每个用户可领：</div>
                      <div nz-col nzSpan="7">
                        <input nz-input maxlength="2" [ngModel]="addMarginArr[i].perUserQuantity" (ngModelChange)="onMarginChange($event, 'perUserQuantity', i)" placeholder="请输入每个用户可领数额" nzSize="default">
                      </div>
                      <div nz-col nzSpan="1"></div>
                      <div nz-col nzSpan="3">
                        <nz-select [ngModel]="''" [ngModel]="addMarginArr[i].actGiftNo" (ngModelChange)="onMarginChange($event, 'actGiftNo', i)">
                          <ng-container *ngFor="let item of actGiftNoArr">
                            <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                          </ng-container>
                        </nz-select>
                      </div>
                      <div nz-col nzSpan="6"></div>
                      <div nz-col nzSpan="3" *ngIf="i > 0">
                        <button nz-button nzType="primary" (click)="clickChangeMargin('activity', 'delete', i)"><i class="anticon anticon-delete"></i>删除</button>
                      </div>
                    </div>
                  </ng-container>
                </div>
                <div nz-col nzSpan="4">活动周期内<br>充值x，可领取对应组红包<br>充值y，可领取对应组红包<br>充值z，可领取对应组红包<br><br>所有的奖励结算，以发起请求时<br>对应充值金额，对应红包组奖励<br>活动页面有2种做法<br>选中某礼包，1个充值按钮<br>3个礼包组，3个充值按钮<br><br></div>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="4" class="span_down" style="font-size: 20px;font-weight: bold;">活动奖励配置</div>
              <div nz-col nzSpan="17"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="showModal('addCoupon', '')"><i class="anticon anticon-file-add"></i>新增红包组</button>
              </div>
            </div>
            <ng-container *ngFor="let item of couponListArr">
              <div nz-row>
                <div nz-col nzSpan="24">
                  <nz-table #couponNumberTable [nzData]="item.actCouponRulePoL" *ngIf="!isSpinning">
                    <thead>
                      <tr>
                        <th [attr.rowspan]="2">红包组编号</th>
                        <th>序号</th>
                        <th>优惠券编号</th>
                        <th>优惠券名称</th>
                        <th>优惠券类型</th>
                        <th>时间限制</th>
                        <th>数量限制</th>
                        <th>操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let data of couponNumberTable.data; let i=index;">
                        <td>{{i === 0 ? item.actGiftNo : ''}}</td>
                        <td>{{i+1}}</td>
                        <td>{{data.couponRulePo.couponNo}}</td>
                        <td>{{data.couponRulePo.couponName}}</td>
                        <td>{{data.couponRulePo.couponCategory === 'all' ? '全品类' : data.couponRulePo.couponCategory === 'flight' ? '订机票' : data.couponRulePo.couponCategory === 'hotel' ? '订酒店' : data.couponRulePo.couponCategory === 'train' ? '订火车' : data.couponRulePo.couponCategory === 'taxi' ? '打车' : ''}}</td>
                        <td *ngIf="data.couponRulePo.timeLimitType === 'fix_start_end'">{{data.couponRulePo.timeLimitStart | date:'yyyy-MM-dd'}}&nbsp;至&nbsp;{{data.couponRulePo.timeLimitEnd | date:'yyyy-MM-dd'}}</td>
                        <td *ngIf="data.couponRulePo.timeLimitType === 'fix_duration'">{{data.couponRulePo.timeLimitValidDay}}</td>
                        <td *ngIf="!(data.couponRulePo.timeLimitType === 'fix_start_end' || data.couponRulePo.timeLimitType === 'fix_duration')"></td>
                        <td>{{data.quantity}}</td>
                        <td *ngIf="i === 0">
                          <button nz-button nzType="primary" (click)="showModal('modifyCoupon', item)"><i class="anticon anticon-form"></i>配置红包</button>
                          <button nz-button nzType="primary" (click)="doDelete(item.actGiftNo, 'couponList')"><i class="anticon anticon-delete"></i>删除</button>
                        </td>
                        <td *ngIf="i > 0"></td>
                      </tr>
                    </tbody>
                  </nz-table>
                  <div class="spin" *ngIf="isSpinning">
                    <nz-spin [nzSize]="'large'"></nz-spin>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #addContentModalFooter>
              <button nz-button nzType="primary" (click)="doSave('activity')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('activity')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.coupon" nzWidth="1450" nzTitle="红包编组选择区(读取红包列表）" [nzFooter]="couponModalFooter" (nzOnCancel)="hideModal('couponInActivity')" nzMaskClosable="false">
            <div nz-row>
              <form [formGroup]="searchCouponInActivityForm">
                <div nz-col nzSpan="2" class="span_down right_alignment">创建日期范围：</div>
                <div nz-col nzSpan="7" class="span_down">
                  <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'couponInActivity')"></nz-range-picker>
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券品类：</div>
                <div nz-col nzSpan="3">
                  <nz-select [ngModel]="''" formControlName="couponCategory">
                    <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'全品类'" [nzValue]="'all'"></nz-option>
                    <nz-option required [nzLabel]="'机票'" [nzValue]="'flight'"></nz-option>
                    <nz-option required [nzLabel]="'火车'" [nzValue]="'hotel'"></nz-option>
                    <nz-option required [nzLabel]="'酒店'" [nzValue]="'train'"></nz-option>
                    <nz-option required [nzLabel]="'打车'" [nzValue]="'taxi'"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券名称：</div>
                <div nz-col nzSpan="3">
                  <input nz-input maxlength="32" formControlName="couponName" placeholder="输入订单编号" nzSize="default">
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券类型：</div>
                <div nz-col nzSpan="3">
                  <nz-select [ngModel]="''" formControlName="discountType">
                    <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'满减固定额'" [nzValue]="'FIX_DISCOUNT'"></nz-option>
                    <nz-option required [nzLabel]="'满减百分比'" [nzValue]="'PERCENTAGE_DISCOUNT'"></nz-option>
                  </nz-select>
                </div>
              </form>
            </div>
            <div nz-row>
              <div nz-col nzSpan="22"></div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('couponInActivity')"><i class="anticon anticon-file-add"></i>查询</button>
              </div>
            </div>
            <nz-table #couponSelectTable [nzData]="dataSearchCoupon" *ngIf="!isSpinning">
              <thead>
                <tr>
                  <th nzShowCheckbox [(nzChecked)]="allSearchCouponChecked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAllSearchCoupon($event)"></th>
                  <th nzWidth="20px">序号</th>
                  <th nzWidth="20px">优惠券创建时间</th>
                  <th nzWidth="20px">优惠券编号</th>
                  <th nzWidth="20px">优惠券名称</th>
                  <th nzWidth="20px">优惠券类型</th>
                  <th nzWidth="20px">数量限制</th>
                  <th nzWidth="20px">时间限制</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of couponSelectTable.data; let i=index;">
                  <td nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="data.disabled" (nzCheckedChange)="refreshSearchCouponStatus()"></td>
                  <td>{{i+1}}</td>
                  <td>{{data.ctime | date:'yyyy-MM-dd HH:mm'}}</td>
                  <td>{{data.couponNo}}</td>
                  <td>{{data.couponName}}</td>
                  <td>{{data.couponCategory === 'all' ? '全品类' : data.couponCategory === 'flight' ? '订机票' : data.couponCategory === 'hotel' ? '订酒店' : data.couponCategory === 'train' ? '订火车' : '打车' }}</td>
                  <td><input nz-input maxlength="3" nzSize="default" [ngModel]="data.number" (ngModelChange)="getCouponNumber($event, data)"></td>
                  <td *ngIf="data.timeLimitType === 'fix_start_end'">{{data.timeLimitStart | date:'yyyy-MM-dd'}}&nbsp;至&nbsp;{{data.timeLimitEnd | date:'yyyy-MM-dd'}}</td>
                  <td *ngIf="data.timeLimitType === 'fix_duration'">{{data.timeLimitValidDay}}</td>
                </tr>
              </tbody>
            </nz-table>
            <div class="spin" *ngIf="isSpinning">
              <nz-spin [nzSize]="'large'"></nz-spin>
            </div>
            <ng-template #couponModalFooter>
              <button nz-button nzType="primary" (click)="doSave('couponInActivity')"><i class="anticon anticon-save"></i>确定</button>
              <button nz-button nzType="default" (click)="hideModal('couponInActivity')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.preview" nzWidth="360" nzTitle="活动页预览" [nzFooter]="previewFooter" (nzOnCancel)="hideModal('preview')" nzMaskClosable="false">
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="24" class="span_down">
                {{modifyctivityItem.actName}}
              </div>
              <div nz-col nzSpan="24" class="span_down">
                <img *ngIf="showImageUrl" [src]="showImageUrl" class="image-panel">
              </div>
              <div nz-col nzSpan="24" class="span_down">
                {{modifyctivityItem.actStartDate}}&nbsp;&nbsp;至&nbsp;&nbsp;{{modifyctivityItem.actEndDate}}
              </div>
              <div nz-col nzSpan="24" class="span_down">功能区</div>
              <div nz-col nzSpan="24" class="span_down">
                {{modifyctivityItem.actRuleDesc}}
              </div>
            </div>
            <ng-template #previewFooter>
              <button nz-button nzType="default" (click)="hideModal('preview')"><i class="anticon anticon-close-circle-o"></i>关闭</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab [nzTitle]="batchsendListTemplate" (nzClick)="changePanel('batchsendList')" *ngIf="commonService.haveMenuPermission('children', '批量发放')">
          <ng-template #batchsendListTemplate><i class="anticon anticon-fork"></i>批量发放</ng-template>
          <div nz-row>
            <div nz-col nzSpan="2" class="span_down right_alignment">查询范围：</div>
            <div nz-col nzSpan="7" class="span_down">
              <nz-range-picker [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'baseInfo')"></nz-range-picker>
            </div>
            <div nz-col nzSpan="9"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('batchsendList')"><i class="anticon anticon-search"></i>查询</button>
            </div>
            <div nz-col nzSpan="1"></div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showModal('addBatchsend', '')"><i class="anticon anticon-file-add"></i>新增发放</button>
            </div>
          </div>
          <nz-table #batchsendTable [nzData]="dataBatchsend" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">发放日期</th>
                <th nzWidth="20px">发放时间</th>
                <th nzWidth="20px">发放人数</th>
                <th nzWidth="20px">失败人数</th>
                <th nzWidth="20px">优惠券数量</th>
                <th nzWidth="20px">附带消息</th>
                <th nzWidth="20px">操作人</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of batchsendTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.sendTime ? (data.sendTime | date:'yyyy-MM-dd') : 'null' }}</td>
                <td>{{data.sendTime ? (data.sendTime | date:'HH:mm:ss') : 'null' }}</td>
                <td>{{data.invalidRevL ? data.invalidRevL.length : 0}}</td>
                <td>{{data.errorRevL ? data.errorRevL.length : 0}}</td>
                <td>{{data.totalRevNum}}</td>
                <td>{{data.displayMessage}}</td>
                <td>{{data.operator}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('detail', data)" style="margin-right: 10px;"><i class="anticon anticon-eye-o"></i>查看</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="visiable.addBatchsend" nzWidth="1150" nzTitle="新增内容" [nzFooter]="addBatchsendModalFooter" (nzOnCancel)="hideModal('batchsendList')" nzMaskClosable="false">
            <form [formGroup]="addBatchsendForm">
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down" style="font-size: 20px;font-weight: bold;">发送对象</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="20" style="color: #a9a9a9">请填写发送的用户手机号，如果需要发送多个，请换行输入</div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="12">
                  <textarea rows="5" nz-input formControlName="pendingRevL" [(ngModel)]="batchsendData.pendingRevL" [disabled]="true" placeholder="请输入发送对象手机号" nzSize="default"></textarea>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down" style="font-size: 20px;font-weight: bold;">附带消息</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="20" style="color: #a9a9a9">一般适用于奖励/补偿用户</div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="12">
                  <textarea rows="5" nz-input formControlName="displayMessage" [(ngModel)]="batchsendData.displayMessage" [disabled]="true" placeholder="这里是要写给用户的话，字数限制xxx个" nzSize="default"></textarea>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="4" class="span_down" style="font-size: 20px;font-weight: bold;">发送奖励配置</div>
                <div nz-col nzSpan="17"></div>
                <div nz-col nzSpan="3">
                  <button nz-button nzType="primary" (click)="showModal('addCouponInBatchsend', '')"><i class="anticon anticon-file-add"></i>新增红包组</button>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="24">
                  <nz-table #couponChooseTable [nzData]="couponListArrInBatchsend" *ngIf="!isSpinning">
                    <thead>
                      <tr>
                        <th>序号</th>
                        <th>优惠券编号</th>
                        <th>优惠券名称</th>
                        <th>优惠券类型</th>
                        <th>时间限制</th>
                        <th>数量限制</th>
                        <th>操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let data of couponChooseTable.data; let i=index;">
                        <td>{{i+1}}</td>
                        <td>{{data.couponNo}}</td>
                        <td>{{data.couponName}}</td>
                        <td>{{data.couponCategory === 'all' ? '全品类' : data.couponCategory === 'flight' ? '订机票' : data.couponCategory === 'hotel' ? '订酒店' : data.couponCategory === 'train' ? '订火车' : data.couponCategory === 'taxi' ? '打车' : ''}}</td>
                        <td *ngIf="data.timeLimitType === 'fix_start_end'">{{data.timeLimitStart | date:'yyyy-MM-dd'}}&nbsp;至&nbsp;{{data.timeLimitEnd | date:'yyyy-MM-dd'}}</td>
                        <td *ngIf="data.timeLimitType === 'fix_duration'">{{data.timeLimitValidDay}}</td>
                        <td *ngIf="!(data.timeLimitType === 'fix_start_end' || data.timeLimitType === 'fix_duration')"></td>
                        <td>{{data.quantity}}</td>
                        <td *ngIf="i === 0">
                          <button nz-button nzType="primary" (click)="showModal('modifyCoupon', item)"><i class="anticon anticon-form"></i>配置红包</button>
                        </td>
                        <td *ngIf="i > 0"></td>
                      </tr>
                    </tbody>
                  </nz-table>
                  <div class="spin" *ngIf="isSpinning">
                    <nz-spin [nzSize]="'large'"></nz-spin>
                  </div>
                </div>
              </div>
            </form>
            <ng-template #addBatchsendModalFooter>
              <button nz-button nzType="primary" (click)="doSave('batchsendList')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('batchsendList')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.couponInBatchsend" nzWidth="1450" nzTitle="红包编组选择区(读取红包列表）" [nzFooter]="couponModalFooter" (nzOnCancel)="hideModal('couponInBatchsend')" nzMaskClosable="false">
            <div nz-row>
              <form [formGroup]="searchCouponInBatchsendForm">
                <div nz-col nzSpan="2" class="span_down right_alignment">创建日期范围：</div>
                <div nz-col nzSpan="7" class="span_down">
                  <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'couponInBatchsend')"></nz-range-picker>
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券品类：</div>
                <div nz-col nzSpan="3">
                  <nz-select [ngModel]="''" formControlName="couponCategory">
                    <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'全品类'" [nzValue]="'all'"></nz-option>
                    <nz-option required [nzLabel]="'机票'" [nzValue]="'flight'"></nz-option>
                    <nz-option required [nzLabel]="'火车'" [nzValue]="'hotel'"></nz-option>
                    <nz-option required [nzLabel]="'酒店'" [nzValue]="'train'"></nz-option>
                    <nz-option required [nzLabel]="'打车'" [nzValue]="'taxi'"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券名称：</div>
                <div nz-col nzSpan="3">
                  <input nz-input maxlength="32" formControlName="couponName" placeholder="输入订单编号"
                    nzSize="default">
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券类型：</div>
                <div nz-col nzSpan="3">
                  <nz-select [ngModel]="''" formControlName="discountType">
                    <nz-option [nzLabel]="'---无---'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'满减固定额'" [nzValue]="'FIX_DISCOUNT'"></nz-option>
                    <nz-option required [nzLabel]="'满减百分比'" [nzValue]="'PERCENTAGE_DISCOUNT'"></nz-option>
                  </nz-select>
                </div>
              </form>
            </div>
            <div nz-row>
              <div nz-col nzSpan="22"></div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('couponInBatchsend')"><i class="anticon anticon-file-add"></i>查询</button>
              </div>
            </div>
            <nz-table #couponSelectTable [nzData]="dataSearchCouponInBatchsend" *ngIf="!isSpinning">
              <thead>
                <tr>
                  <th nzShowCheckbox [(nzChecked)]="allSearchCouponInBatchsendChecked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAllSearchCoupon($event)"></th>
                  <th nzWidth="20px">序号</th>
                  <th nzWidth="20px">优惠券创建时间</th>
                  <th nzWidth="20px">优惠券编号</th>
                  <th nzWidth="20px">优惠券名称</th>
                  <th nzWidth="20px">优惠券类型</th>
                  <th nzWidth="20px">数量限制</th>
                  <th nzWidth="20px">时间限制</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of couponSelectTable.data; let i=index;">
                  <td nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="data.disabled" (nzCheckedChange)="refreshSearchCouponStatus()"></td>
                  <td>{{i+1}}</td>
                  <td>{{data.ctime | date:'yyyy-MM-dd HH:mm'}}</td>
                  <td>{{data.couponNo}}</td>
                  <td>{{data.couponName}}</td>
                  <td>{{data.couponCategory === 'all' ? '全品类' : data.couponCategory === 'flight' ? '订机票' : data.couponCategory === 'hotel' ? '订酒店' : data.couponCategory === 'train' ? '订火车' : '打车' }}</td>
                  <td><input nz-input maxlength="3" nzSize="default" [ngModel]="data.number" (ngModelChange)="getCouponNumber($event, data)"></td>
                  <td *ngIf="data.timeLimitType === 'fix_start_end'">{{data.timeLimitStart | date:'yyyy-MM-dd'}}&nbsp;至&nbsp;{{data.timeLimitEnd | date:'yyyy-MM-dd'}}</td>
                  <td *ngIf="data.timeLimitType === 'fix_duration'">{{data.timeLimitValidDay}}</td>
                </tr>
              </tbody>
            </nz-table>
            <div class="spin" *ngIf="isSpinning">
              <nz-spin [nzSize]="'large'"></nz-spin>
            </div>
            <ng-template #couponModalFooter>
              <button nz-button nzType="primary" (click)="doSave('couponInBatchsend')"><i class="anticon anticon-save"></i>确定</button>
              <button nz-button nzType="default" (click)="hideModal('couponInBatchsend')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.detailBatchsend" nzWidth="750" nzTitle="查看发放情况" [nzFooter]="modifyBatchsendModalFooter" (nzOnCancel)="hideModal('detailBatchsend')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="7" class="spthumbnailan_down">发放对象</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="spthumbnailan_down">失败对象(总计y个)</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="spthumbnailan_down">附带消息</div>
              <div nz-col nzSpan="1"></div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="7">
                <textarea rows="5" nz-input [disabled]="true" nzSize="default" placeholder="发放日期：{{batchsendData.sendTime ? (batchsendData.sendTime | date:'yyyy-MM-dd') : 'null'}}
发放时间：{{batchsendData.sendTime ? (batchsendData.sendTime | date:'HH:mm:ss') : 'null'}}
发放人数：{{batchsendData.totalRevNum}}
失败人数：{{batchsendData.errorRevL.length}}"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7">
                <textarea rows="5" nz-input [(ngModel)]="batchsendData.errorRevL" [disabled]="true" zSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7">
                <textarea rows="5" nz-input [(ngModel)]="batchsendData.displayMessage" [disabled]="true" zSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="24">
                <nz-table #visitBatchsendTable [nzData]="batchsendData.actCouponRulePoL" *ngIf="!isSpinning">
                  <thead>
                    <tr>
                      <th>序号</th>
                      <th>优惠券编号</th>
                      <th>优惠券名称</th>
                      <th>优惠券类型</th>
                      <th>时间限制</th>
                      <th>数量限制</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of visitBatchsendTable.data; let i=index;">
                      <td>{{i+1}}</td>
                      <td>{{data.couponRulePo.couponNo}}</td>
                      <td>{{data.couponRulePo.couponName}}</td>
                      <td>{{data.couponRulePo.couponCategory === 'all' ? '全品类' : data.couponRulePo.couponCategory === 'flight' ? '订机票' : data.couponRulePo.couponCategory === 'hotel' ? '订酒店' : data.couponRulePo.couponCategory === 'train' ? '订火车' : data.couponRulePo.couponCategory === 'taxi' ? '打车' : ''}}</td>
                      <td *ngIf="data.couponRulePo.timeLimitType === 'fix_start_end'">{{data.couponRulePo.timeLimitStart | date:'yyyy-MM-dd'}}&nbsp;至&nbsp;{{data.couponRulePo.timeLimitEnd | date:'yyyy-MM-dd'}}</td>
                      <td *ngIf="data.couponRulePo.timeLimitType === 'fix_duration'">{{data.couponRulePo.timeLimitValidDay}}</td>
                      <td *ngIf="!(data.couponRulePo.timeLimitType === 'fix_start_end' || data.couponRulePo.timeLimitType === 'fix_duration')"></td>
                      <td>{{data.quantity}}</td>
                    </tr>
                  </tbody>
                </nz-table>
                <div class="spin" *ngIf="isSpinning">
                  <nz-spin [nzSize]="'large'"></nz-spin>
                </div>
              </div>
            </div>
            <ng-template #modifyBatchsendModalFooter>
              <button nz-button nzType="default" (click)="hideModal('detailBatchsend')"><i class="anticon anticon-close-circle-o"></i>关闭</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.batchsend" nzWidth="950" nzTitle="执行发送" [nzFooter]="batchsendModalFooter" (nzOnCancel)="hideModal('batchsend')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="6">发送对象(总计x个)</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="6">奖励配置</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="6">附带消息</div>
              <div nz-col nzSpan="1"></div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="6">
                <textarea rows="10" nz-input [(ngModel)]="finalBatchsendData.pendingRevL" [disabled]="true" nzSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="6">
                <textarea rows="10" nz-input [(ngModel)]="finalBatchsendData.tempCouponName" [disabled]="true" nzSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="6">
                <textarea rows="10" nz-input [(ngModel)]="finalBatchsendData.displayMessage" [disabled]="true" nzSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="6"></div>
              <div nz-col nzSpan="12">点击执行发送后，奖励将直接发送到对应的用户钱包中</div>
              <div nz-col nzSpan="6"></div>
            </div>
            <ng-template #batchsendModalFooter>
              <div nz-row>
                <div nz-col nzSpan="8"></div>
                <div nz-col nzSpan="3">
                  <button nz-button nzType="primary" (click)="doSave('batchsend')">执行发送</button>
                </div>
                <div nz-col nzSpan="3">
                  <button nz-button nzType="default" (click)="hideModal('batchsend')">放弃</button>
                </div>
                <div nz-col nzSpan="9"></div>
              </div>
            </ng-template>
          </nz-modal>

        </nz-tab>

        <nz-tab [nzTitle]="couponStatisticsTemplate" (nzClick)="changePanel('couponStatistics')" *ngIf="commonService.haveMenuPermission('children', '充值送豆')">
          <ng-template #couponStatisticsTemplate><i class="anticon anticon-line-chart"></i>优惠券统计</ng-template>
          <div nz-row>
            <form [formGroup]="searchCouponStatisticsForm">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">活动名称：</div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="aaa" placeholder="输入订单编号" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">优惠券名称：</div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="aaa" placeholder="输入优惠券名称" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="span_down">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'searchBean')" nzShowTime></nz-range-picker>
              </div>
              <div nz-col nzSpan="4"></div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('couponStatistics')"><i class="anticon anticon-search"></i>查询</button>
              </div>
            </form>
          </div>
          <nz-table #rowCouponStatisticsTable [nzData]="couponStatisticsData" [nzSimple]="true" [(nzPageSize)]="couponStatisticsPageSize" [nzShowPagination]="false" *ngIf="!isSpinning">
            <thead nzWidth="100px">
              <tr>
                <th nzWidth="50px">序号</th>
                <th>活动名称</th>
                <!-- <th>活动时间</th> -->
                <th>优惠券编号</th>
                <th>优惠券名称</th>
                <!-- <th>有效时间</th> -->
                <th>领取量</th>
                <th>使用量</th>
                <th>未使用量</th>
                <th>领取率</th>
                <th>使用率</th>
                <th>未使用率</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowCouponStatisticsTable.data; let i=index;">
                <td nzWidth="50px">{{i+1}}</td>
                <td>{{data.title}}</td>
                <!-- <td>{{data.beginTime | date:'yyyy-MM-dd HH:mm:ss'}}</td> -->
                <td>{{data.describe}}</td>
                <td>{{data.describe}}</td>
                <!-- <td>{{data.beginTime | date:'yyyy-MM-dd HH:mm:ss'}}</td> -->
                <td>{{data.describe}}</td>
                <td>{{data.describe}}</td>
                <td>{{data.describe}}</td>
                <td>{{data.describe}}</td>
                <td>{{data.describe}}</td>
                <td>{{data.describe}}</td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>
        </nz-tab>

        <nz-tab [nzTitle]="beanTemplate" (nzClick)="changePanel('bean')" *ngIf="commonService.haveMenuPermission('children', '充值送豆')">
          <ng-template #beanTemplate><i class="anticon anticon-pay-circle-o"></i>充值送豆</ng-template>
          <div nz-row>
            <form [formGroup]="searchBeanForm">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">活动名称：</div>
              <div nz-col nzSpan="3">
                <input nz-input maxlength="32" formControlName="title" placeholder="输入订单编号" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="2" class="span_down right_alignment">有效时间：</div>
              <div nz-col nzSpan="7" class="span_down">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'searchBean')" nzShowTime></nz-range-picker>
              </div>
              <div nz-col nzSpan="3"></div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('bean')"><i class="anticon anticon-search"></i>查询</button>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="showModal('addBean', '')"><i class="anticon anticon-file-add"></i>新增活动</button>
              </div>
            </form>
          </div>
          <nz-table #rowSelectionTable [nzData]="beanData" [nzSimple]="true" [(nzPageSize)]="beanPageSize" [nzShowPagination]="false" *ngIf="!isSpinning">
            <thead nzWidth="100px">
              <tr>
                <th nzWidth="50px">序号</th>
                <th>活动名称</th>
                <th>送豆规则</th>
                <th>有效时间</th>
                <!-- <th>活动状态</th> -->
                <th>创建时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionTable.data; let i=index;">
                <td nzWidth="50px">{{i+1}}</td>
                <td>{{data.title}}</td>
                <td>{{data.describe}}</td>
                <td>{{data.beginTime | date:'yyyy-MM-dd HH:mm:ss'}}——{{data.endTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                <!-- <td>{{data.activeStatus}}</td> -->
                <td>{{data.createTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('searchBean', data)" style="margin-right: 10px;"><i class="anticon anticon-eye-o"></i>查看</button>
                  <button nz-button nzType="primary" (click)="showModal('modifyBean', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>编辑</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="visiable.addBean" nzWidth="1150" nzTitle="新增活动" [nzFooter]="addBeanModalFooter" (nzOnCancel)="hideModal('addBean')" nzMaskClosable="false">
            <form [formGroup]="addBeanForm">
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动名称：</div>
                <div nz-col nzSpan="9">
                  <input nz-input maxlength="12" [(ngModel)]="beanItem.title" formControlName="title" placeholder="请输入活动名称" nzSize="default">
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">活动名称，最多20字符，超过20字符，无法继续输入</div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动文案：</div>
                <div nz-col nzSpan="9">
                  <textarea rows="2" formControlName="describe" [(ngModel)]="beanItem.describe" maxlength="50" nz-input placeholder="输入活动文案，不超过100个字符"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">活动文案，不限字数<br>客户端读取，活动文案</div>
              </div>
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">活动时间</div></div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>有效时间：</div>
                <div nz-col nzSpan="9">
                  <nz-range-picker [nzFormat]="'yyyy-MM-dd HH:mm:ss'" formControlName="date" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'searchBean')" nzShowTime></nz-range-picker>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">时间精细到，年-月-日，时分秒</div>
              </div>
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">送豆规则</div></div>
              <div nz-row>
                <div nz-col nzSpan="24" class="span_down">
                  <nz-radio-group [(ngModel)]="radioBeanValue" formControlName="type">
                    <label nz-radio nzValue="PERCENT_GIFT">充值送豆百分比</label>
                    <label nz-radio nzValue="FIXED_QUOTA_GIFT" [nzDisabled]="true">充值送豆固定额度</label>
                  </nz-radio-group>
                </div>
              </div>
              <div nz-row style="text-align: center;">
                <div nz-col nzSpan="1" class="span_down">满</div>
                <div nz-col nzSpan="3" class="span_down">
                  <nz-input-number formControlName="depositAmount" [(ngModel)]="beanItem.depositAmount" [nzMin]="0" [nzStep]="1" [nzParser]="parserPoint"></nz-input-number>
                </div>
                <div nz-col nzSpan="1" class="span_down">送</div>
                <div nz-col nzSpan="3" class="span_down" *ngIf="radioBeanValue === 'PERCENT_GIFT'">
                  <nz-input-number formControlName="giftPercent" [(ngModel)]="beanItem.giftPercent" [nzMin]="0" [nzMax]="100" [nzStep]="1" [nzParser]="parserPoint"></nz-input-number>
                </div>
                <div nz-col nzSpan="3" class="span_down" *ngIf="radioBeanValue === 'FIXED_QUOTA_GIFT'">
                  <nz-input-number formControlName="giftAmount" [(ngModel)]="beanItem.giftAmount" [nzMin]="0" [nzStep]="1" [nzParser]="parserPoint"></nz-input-number>
                </div>
                <div nz-col nzSpan="2" class="span_down">{{radioBeanValue === 'PERCENT_GIFT' ? '%' : ''}}&nbsp;&nbsp;小悟豆</div>
                <div nz-col nzSpan="2" class="span_down"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">说明：完成充值时，充值金额满100送10%，范围0-100%</div>
              </div>
            </form>
            <ng-template #addBeanModalFooter>
              <button nz-button nzType="primary" (click)="doSave('addBean')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('addBean')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.modifyBean" nzWidth="1150" nzTitle="修改活动" [nzFooter]="modifyBeanModalFooter" (nzOnCancel)="hideModal('modifyBean')" nzMaskClosable="false">
            <form [formGroup]="modifyBeanForm">
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动名称：</div>
                <div nz-col nzSpan="9">
                  <input nz-input maxlength="12" [(ngModel)]="beanItem.title" formControlName="title" placeholder="请输入活动名称" nzSize="default">
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">活动名称，最多20字符，超过20字符，无法继续输入</div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动文案：</div>
                <div nz-col nzSpan="9">
                  <textarea rows="2" formControlName="describe" [(ngModel)]="beanItem.describe" maxlength="50" nz-input placeholder="输入活动文案，不超过100个字符"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">活动文案，不限字数<br>客户端读取，活动文案</div>
              </div>
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">活动时间</div></div>
              <div nz-row>
                <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>有效时间：</div>
                <div nz-col nzSpan="9">
                  <nz-range-picker [nzFormat]="'yyyy-MM-dd HH:mm:ss'" formControlName="date" [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'searchBean')" nzShowTime></nz-range-picker>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">时间精细到，年-月-日，时分秒</div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="2"></div>
                <div nz-col nzSpan="22" class="span_down">{{beanItem.beginTime}}&nbsp;&nbsp;~&nbsp;&nbsp;{{beanItem.endTime}}</div>
              </div>
              <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">送豆规则</div></div>
              <div nz-row>
                <div nz-col nzSpan="24" class="span_down">
                  <nz-radio-group [(ngModel)]="radioBeanValue" formControlName="type">
                    <label nz-radio nzValue="PERCENT_GIFT">充值送豆百分比</label>
                    <label nz-radio nzValue="FIXED_QUOTA_GIFT" [nzDisabled]="true">充值送豆固定额度</label>
                  </nz-radio-group>
                </div>
              </div>
              <div nz-row style="text-align: center;">
                <div nz-col nzSpan="1" class="span_down">满</div>
                <div nz-col nzSpan="3" class="span_down">
                  <nz-input-number formControlName="depositAmount" [(ngModel)]="beanItem.depositAmount" [nzMin]="0" [nzStep]="1" [nzParser]="parserPoint"></nz-input-number>
                </div>
                <div nz-col nzSpan="1" class="span_down">送</div>
                <div nz-col nzSpan="3" class="span_down" *ngIf="radioBeanValue === 'PERCENT_GIFT'">
                  <nz-input-number formControlName="giftPercent" [(ngModel)]="beanItem.giftPercent" [nzMin]="0" [nzMax]="100" [nzStep]="1" [nzParser]="parserPoint"></nz-input-number>
                </div>
                <div nz-col nzSpan="3" class="span_down" *ngIf="radioBeanValue === 'FIXED_QUOTA_GIFT'">
                  <nz-input-number formControlName="giftAmount" [(ngModel)]="beanItem.giftAmount" [nzMin]="0" [nzStep]="1" [nzParser]="parserPoint"></nz-input-number>
                </div>
                <div nz-col nzSpan="2" class="span_down">{{radioBeanValue === 'PERCENT_GIFT' ? '%' : ''}}&nbsp;&nbsp;小悟豆</div>
                <div nz-col nzSpan="2" class="span_down"></div>
                <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">说明：完成充值时，充值金额满100送10%，范围0-100%</div>
              </div>
            </form>
            <ng-template #modifyBeanModalFooter>
              <button nz-button nzType="primary" (click)="doSave('modifyBean')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('modifyBean')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.searchBean" nzWidth="1150" nzTitle="查看活动" [nzFooter]="searchBeanModalFooter" (nzOnCancel)="hideModal('searchBean')" nzMaskClosable="false">
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">基本信息</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动名称：</div>
              <div nz-col nzSpan="9" class="span_down">{{beanItem.title}}</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">活动名称，最多20字符，超过20字符，无法继续输入</div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>活动文案：</div>
              <div nz-col nzSpan="9" class="span_down">{{beanItem.describe}}</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">活动文案，不限字数<br>客户端读取，活动文案</div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">活动时间</div></div>
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment"><font color="red">*</font>有效时间：</div>
              <div nz-col nzSpan="9" class="span_down">{{beanItem.beginTime | date:'yyyy-MM-dd HH:mm:ss'}}——{{beanItem.endTime | date:'yyyy-MM-dd HH:mm:ss'}}</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">时间精细到，年-月-日，时分秒</div>
            </div>
            <div nz-row><div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">送豆规则</div></div>
            <div nz-row>
              <div nz-col nzSpan="24" class="span_down">
                <nz-radio-group [(ngModel)]="radioBeanValue">
                  <label nz-radio nzValue="PERCENT_GIFT" [nzDisabled]="radioBeanValue === 'FIXED_QUOTA_GIFT'">充值送豆百分比</label>
                  <label nz-radio nzValue="FIXED_QUOTA_GIFT" [nzDisabled]="radioBeanValue === 'PERCENT_GIFT'">充值送豆固定额度</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row style="text-align: center;">
              <div nz-col nzSpan="1" class="span_down">满</div>
              <div nz-col nzSpan="3" class="span_down">{{beanItem.depositAmount}}</div>
              <div nz-col nzSpan="1" class="span_down">送</div>
              <div nz-col nzSpan="3" class="span_down">{{radioBeanValue === 'PERCENT_GIFT' ? (beanItem.giftPercent * 100) : beanItem.giftAmount}}</div>
              <div nz-col nzSpan="2" class="span_down">{{radioBeanValue === 'PERCENT_GIFT' ? '%' : ''}}&nbsp;&nbsp;小悟豆</div>
              <div nz-col nzSpan="2" class="span_down"></div>
              <div nz-col nzSpan="8" class="span_down" style="font-size: 12px;color: #A9A9A9">说明：完成充值时，充值金额满100送10%，范围0-100%</div>
            </div>
            <ng-template #searchBeanModalFooter>
              <button nz-button nzType="default" (click)="hideModal('searchBean')"><i class="anticon anticon-close-circle-o"></i>关闭</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab [nzTitle]="taskCenterTemplate" (nzClick)="changePanel('taskCenter')" *ngIf="commonService.haveMenuPermission('children', '任务中心')">
          <ng-template #taskCenterTemplate><i class="anticon anticon-windows-o"></i>任务中心</ng-template>
          <form [formGroup]="searchTaskCenterForm">
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment">任务名称：</div>
              <div nz-col nzSpan="2">
                <input nz-input formControlName="name" placeholder="输入任务名称" nzSize="default" [(ngModel)]="taskCenterName">
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">任务类型：</div>
              <div nz-col nzSpan="2">
                <nz-select formControlName="type">
                  <nz-option required [nzLabel]="'全部'" nzValue=""></nz-option>
                  <nz-option required [nzLabel]="'新手'" nzValue="NOVICE"></nz-option>
                  <nz-option required [nzLabel]="'每日'" nzValue="DAILY"></nz-option>
                  <nz-option required [nzLabel]="'活动'" nzValue="ACTIVITY"></nz-option>
                </nz-select>
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">创建时间：</div>
              <div nz-col nzSpan="6">
                <nz-range-picker [nzFormat]="'yyyyMMdd'" formControlName="date" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'taskCenter')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('taskCenter')"><i class="anticon anticon-search"></i>查询</button>
              </div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="showModal('resetTaskCenter', '')"><i class="anticon anticon-reload"></i>重置任务</button>
              </div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="showModal('addTaskCenter', '')"><i class="anticon anticon-file-add"></i>新增任务</button>
              </div>
            </div>
          </form>
          <nz-table #taskCenterTable [nzData]="dataTaskCenter" *ngIf="!isSpinning" [nzScroll]="{x:'2800px'}">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">任务类型</th>
                <th nzWidth="20px">任务名称</th>
                <th nzWidth="20px">次数限制</th>
                <th nzWidth="20px">任务奖励1</th>
                <th nzWidth="20px">任务奖励2</th>
                <th nzWidth="20px">任务奖励3</th>
                <th nzWidth="20px">任务行为</th>
                <th nzWidth="20px">任务描述</th>
                <th nzWidth="20px">任务排序</th>
                <th nzWidth="20px">开启状态</th>
                <th nzWidth="20px">创建时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of taskCenterTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.type === 'NOVICE' ? '新手任务' : data.type === 'DAILY' ? '每日任务' : data.type === 'ACTIVITY' ? '活动任务' : ''}}</td>
                <td>{{data.name}}</td>
                <td>{{data.totalTimes}}</td>
                <td>{{data.taskAward ? data.taskAward.rule ?
                      (data.taskAward.rule.beanAwardType === 'NONE' ? '/' : (data.taskAward.rule.beanAwardType === 'FIXED' ? '小悟豆*' + data.taskAward.rule.beanValue : (data.taskAward.rule.beanAwardType === 'SCALE' ? '小悟豆*' + data.taskAward.rule.beanValue : '')))
                    : (data.taskAward.stepRuleFinal.beanAwardType !== undefined && data.taskAward.stepRuleFinal.beanAwardType === 'NONE' ? '/' : (data.taskAward.stepRuleFinal.beanAwardType === 'FIXED' ? '小悟豆*' + data.taskAward.stepRuleFinal.beanValue : (data.taskAward.stepRuleFinal.beanAwardType === 'SCALE' ? '小悟豆*' + data.taskAward.stepRuleFinal.beanValue : ''))) : ''}}</td>
                <td>{{data.taskAward ? data.taskAward.rule ?
                      (data.taskAward.rule.expAwardType === 'NONE' ? '/' : (data.taskAward.rule.expAwardType === 'FIXED' ? '经验*' + data.taskAward.rule.expValue : (data.taskAward.rule.expAwardType === 'SCALE' ? '经验值*' + data.taskAward.rule.expValue : '')))
                    : (data.taskAward.stepRuleFinal.expAwardType === 'NONE' ? '/' : (data.taskAward.stepRuleFinal.expAwardType === 'FIXED' ? '经验*' + data.taskAward.stepRuleFinal.expValue : (data.taskAward.stepRuleFinal.expAwardType === 'SCALE' ? '经验*' + data.taskAward.stepRuleFinal.expValue : ''))) : ''}}</td>
                <td>{{data.taskAward ? data.taskAward.rule ?
                      (data.taskAward.rule.perkAwardType === 'NONE' ? '/' : (data.taskAward.rule.perkAwardType === 'FIXED' ? '技能点*' + data.taskAward.rule.perkValue : (data.taskAward.rule.perkAwardType === 'SCALE' ? '技能点*' + data.taskAward.rule.perkValue : '')))
                    : (data.taskAward.stepRuleFinal.perkAwardType === 'NONE' ? '/' : (data.taskAward.stepRuleFinal.perkAwardType === 'FIXED' ? '技能点*' + data.taskAward.stepRuleFinal.perkValue : (data.taskAward.stepRuleFinal.perkAwardType === 'SCALE' ? '技能点*' + data.taskAward.stepRuleFinal.perkValue : ''))) : ''}}</td>
                <td>{{data.action === 'FINISH_TEACH' ? '完成新手教学' : data.action === 'SET_PAYMENT_PWD' ? '修改支付密码' : data.action === 'OPEN_SECRET_FREE_PAYMENT' ? '开启免密支付'
                    : data.action === 'FILL_INFO_LINK_MAN' ? '填写常用联系人' : data.action === 'FILL_INFO_USER_CONTACT' ? '填写出行人' : data.action === 'FILL_INFO_CONTACT_ADDRESS' ? '填写常用地址'
                    : data.action === 'FILL_INFO_SHIPPING_ADDRESS' ? '填写配送地址' : data.action === 'FILL_INFO_INVOICE' ? '填写发票抬头' : data.action === 'SEARCH_WEATHER' ? '查询天气'
                    : data.action === 'SEARCH_FORTUNE' ? '查询星座运势' : data.action === 'MOBILE_RECHARGE' ? '充话费' : data.action === 'LISTEN_AUDIO' ? '听音频' : data.action === 'LISTEN_NEWS' ? '听新闻'
                    : data.action === 'NAVIGATION' ? '导航' : data.action === 'FINISH_PLANE_TICKET_ORDER' ? '完成机票订单' : data.action === 'FINISH_TRAIN_TICKET_ORDER' ? '完成火车票订单'
                    : data.action === 'FINISH_HOTEL_ORDER' ? '完成酒店订单' : data.action === 'FINISH_ERRAND_ORDER' ? '完成闪送订单' : data.action === 'FINISH_FORTUNE_ORDER' ? '完成星座运势订单'
                    : data.action === 'FINISH_MOVIE_TICKET_ORDER' ? '完成电影票订单' : data.action === 'FINISH_TAXIS_ORDER' ? '完成打车订单' : data.action === 'CALL' ? '打电话'
                    : data.action === 'LIKE_OR_TREAD' ? '点赞/踩' : data.action === 'SHARE' ? '分享' : ''}}</td>
                <td nzTitle="{{data.description}}" nzPlacement="bottom" nz-tooltip><a>{{data.description ? data.description.substring(0, 8) + (data.description.length > 8 ? '…' : '') : ''}}</a></td>
                <td>{{data.group}}-{{data.sequence}}</td>
                <td>
                  <nz-form-item>
                    <nz-form-control>
                      <nz-switch [(ngModel)]="data.enabled" (click)="clickSwitch(data, 'taskCenter')"></nz-switch>
                    </nz-form-control>
                  </nz-form-item>
                </td>
                <td>{{data.createTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('modifyTaskCenter', data.id)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>修改</button>
                  <button nz-button nzType="primary" (click)="showDeleteModal(data.id, 'taskCenter')" style="margin-right: 10px;"><i class="anticon anticon-delete"></i>删除</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="visiable.resetTaskCenter" nzWidth="750" nzTitle="重置任务" [nzFooter]="resetTaskCenterFooter" (nzOnCancel)="hideModal('resetTaskCenter')" nzMaskClosable="false">
            <div nz-row>
              <div nz-col nzSpan="6" *ngFor="let data of dataTaskCenter; let i=index;">
                <label nz-checkbox [(nzChecked)]="data.checked" style="line-height: 31px;">{{data.name}}</label>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="24">提示：新手任务重置成功后，已完成该新手任务的用户，可以再做一次该新手任务 </div>
            </div>
            <ng-template #resetTaskCenterFooter>
                <button nz-button nzType="primary" (click)="showModal('ensureResetTaskCenter', '')"><i class="anticon anticon-save"></i>确定</button>
              <button nz-button nzType="default" (click)="hideModal('resetTaskCenter')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.ensureResetTaskCenter" nzWidth="750" nzTitle="重置任务" [nzFooter]="ensureResetTaskCenterFooter" (nzOnCancel)="hideModal('ensureResetTaskCenter')" nzMaskClosable="false">
            <div nz-row><div nz-col nzSpan="24">重置任务</div></div>
            <div nz-row>
              <ng-container *ngFor="let data of dataTaskCenter; let i=index;">
                <div nz-col nzSpan="8" *ngIf="data.checked">
                  <label nz-checkbox [(nzChecked)]="data.checked" style="line-height: 31px;" [nzDisabled]="true">{{data.name}}</label>
                </div>
              </ng-container>
            </div>
            <div nz-row>
              <div nz-col nzSpan="4">
                <nz-select [(ngModel)]="operateObject.operater">
                  <nz-option required [nzLabel]="'18682233554'" [nzValue]="'18682233554'"></nz-option>
                  <nz-option required [nzLabel]="'18665310035'" [nzValue]="'18665310035'"></nz-option>
                  <nz-option required [nzLabel]="'18516609441'" [nzValue]="'18516609441'"></nz-option>
                  <nz-option required [nzLabel]="'18682251210'" [nzValue]="'18682251210'"></nz-option>
                </nz-select>
              </div>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="doSave('sendMsg')" [disabled]="semdMesCodeText !== 60">{{semdMesCodeText === 60 ? '验证' : semdMesCodeText + 's'}}</button>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="4" class="right_alignment span_down">验证码：</div>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2"><input nz-input nzSize="default" [(ngModel)]="operateObject.code"></div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="24">提示：勾选任务，重置成功后，已完成该任务的用户，可以再做一次该任务</div>
            </div>
            <ng-template #ensureResetTaskCenterFooter>
              <button nz-button nzType="primary" (click)="doSave('resetTaskCenter', '')" [disabled]="operateObject.code.length !== 4"><i class="anticon anticon-reload"></i>确定重置</button>
              <button nz-button nzType="default" (click)="hideModal('ensureResetTaskCenter')"><i class="anticon anticon-close-circle-o"></i>放弃</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="visiable.addTaskCenter || visiable.modifyTaskCenter" nzWidth="1050" nzTitle="新增任务" [nzFooter]="addTaskCenterFooter" (nzOnCancel)="hideModal('taskCenter')" nzMaskClosable="false">
            <div nz-row><div nz-col nzSpan="3" class="span_down"><b>任务规则</b></div></div>
            <div nz-row>
              <div nz-col nzSpan="3" class="span_down right_alignment">任务类型：</div>
              <div nz-col nzSpan="21" class="span_down">
                <nz-radio-group [(ngModel)]="addTaskCenter.taskType">
                  <label nz-radio nzValue="DAILY">每日</label>
                  <label nz-radio nzValue="NOVICE">新手</label>
                  <label nz-radio nzValue="ACTIVITY">活动</label>
                </nz-radio-group>
              </div>
            </div>
            <div *ngIf="addTaskCenter.taskType === 'DAILY' || addTaskCenter.taskType === 'NOVICE'">
              <div nz-row *ngIf="addTaskCenter.taskType === 'DAILY'">
                <div nz-col nzSpan="3" class="span_down right_alignment">任务行为：</div>
                <div nz-col nzSpan="21" class="span_down">
                  <nz-radio-group [(ngModel)]="addTaskCenter.taskBehavior">
                    <label nz-radio nzValue="FINISH_TAXIS_ORDER">打车订单</label><label nz-radio nzValue="MOBILE_RECHARGE">充话费订单</label>
                    <label nz-radio nzValue="SEARCH_WEATHER">查询天气</label><label nz-radio nzValue="LISTEN_AUDIO">听音频</label>
                    <label nz-radio nzValue="SHARE">分享一次给朋友</label>
                    <!-- <label nz-radio nzValue="FINISH_PLANE_TICKET_ORDER">机票订单</label><label nz-radio nzValue="FINISH_TRAIN_TICKET_ORDER">火车订单</label>
                    <label nz-radio nzValue="FINISH_HOTEL_ORDER">酒店订单</label><label nz-radio nzValue="LIKE_OR_TREAD">点踩/点赞</label>
                    <label nz-radio nzValue="FINISH_ERRAND_ORDER">闪送订单</label><label nz-radio nzValue="FINISH_FORTUNE_ORDER">星座订单</label>
                    <label nz-radio nzValue="NAVIGATION">使用导航</label><label nz-radio nzValue="CALL">打电话</label>
                    <label nz-radio nzValue="SEARCH_FORTUNE">查看今日运势</label> -->
                  </nz-radio-group>
                </div>
              </div>
              <div nz-row *ngIf="addTaskCenter.taskType === 'NOVICE'">
                <div nz-col nzSpan="3" class="span_down right_alignment">次数限制：</div>
                <div nz-col nzSpan="21" class="span_down">
                  <nz-radio-group [(ngModel)]="addTaskCenter.taskBehavior">
                    <label nz-radio nzValue="FINISH_TEACH">新手教学任务</label><label nz-radio nzValue="LISTEN_AUDIO">听音频</label>
                    <label nz-radio nzValue="MOBILE_RECHARGE">充话费</label><label nz-radio nzValue="CALL">打电话</label>
                    <!-- <label nz-radio nzValue="NAVIGATION">使用导航</label><label nz-radio nzValue="LISTEN_NEWS">听新闻</label>
                    <label nz-radio nzValue="FINISH_PLANE_TICKET_ORDER">购买机票</label><label nz-radio nzValue="FINISH_TRAIN_TICKET_ORDER">购买火车票</label>
                    <label nz-radio nzValue="FINISH_HOTEL_ORDER">订酒店</label><label nz-radio nzValue="FINISH_TAXIS_ORDER">首次打车</label>
                    <label nz-radio nzValue="FINISH_ERRAND_ORDER">闪送订单</label><label nz-radio nzValue="FINISH_FORTUNE_ORDER">星座订单</label>
                    <label nz-radio nzValue="FINISH_MOVIE_TICKET_ORDER">电影票订单</label><label nz-radio nzValue="SET_PAYMENT_PWD">设置支付密码</label>
                    <label nz-radio nzValue="OPEN_SECRET_FREE_PAYMENT">开通免密支付</label><label nz-radio nzValue="FILL_INFO_USER_CONTACT">填写-出行人</label>
                    <label nz-radio nzValue="FILL_INFO_LINK_MAN">填写-常用联系人</label><label nz-radio nzValue="FILL_INFO_CONTACT_ADDRESS">填写-常用地址</label>
                    <label nz-radio nzValue="FILL_INFO_SHIPPING_ADDRESS">填写-配送地址</label><label nz-radio nzValue="FILL_INFO_INVOICE">填写-发票抬头</label> -->
                  </nz-radio-group>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">次数限制：</div>
                <div nz-col nzSpan="2" class="span_down">
                  <label nz-checkbox [(nzChecked)]="addTaskCenter.checkLimitNumber">{{addTaskCenter.taskType === 'DAILY' ? '每日' : addTaskCenter.taskType === 'NOVICE' ? '终身仅' : ''}}</label>
                </div>
                <div nz-col nzSpan="3" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.totalTimes">
                </div>
                <div nz-col nzSpan="1" class="span_down right_alignment">次</div>
              </div>
              <div nz-row><div nz-col nzSpan="3" class="span_down"><b>任务信息</b></div></div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">任务名称：</div>
                <div nz-col nzSpan="6" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.name">
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">任务描述：</div>
                <div nz-col nzSpan="21" class="span_down">
                  <input nz-input nzSize="default" maxlength="50" [(ngModel)]="addTaskCenter.description">
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">任务排序：</div>
                <div nz-col nzSpan="1" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.group">
                </div>
                <div nz-col nzSpan="1" class="span_down" style="text-align: center;">~</div>
                <div nz-col nzSpan="1" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.sequence">
                </div>
                <div nz-col nzSpan="1">&nbsp;</div>
                <div nz-col nzSpan="17" class="span_down">x-y，x为前置数字，y为后置数字。任务在后台的配置顺序，x越小越靠前，如果同时出现多个x，则y越小越靠前</div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">任务icon：</div>
                <div nz-col nzSpan="21" class="span_down">
                  <nz-upload [(nzFileList)]="fileList" nzMultiple [nzBeforeUpload]="beforeUpload">
                    <button nz-button nzType="primary">
                      <i class="anticon anticon-upload"></i><span>上传icon</span>
                    </button>
                    &nbsp;&nbsp;建议尺寸64*64，限制大小：50k
                  </nz-upload>
                </div>
              </div>
              <div nz-row *ngIf="fileList.length == 1">
                <div nz-col nzSpan="3" class="span_down right_alignment"></div>
                <div nz-col nzSpan="21">
                  <img *ngIf="imageUrl" [src]="showImageUrl" class="image-panel">
                  <font color="#cccccc">&nbsp;&nbsp;建议尺寸64*64，限制大小：50k</font>
                </div>
              </div>
              <div nz-row><div nz-col nzSpan="3" class="span_down"><b>任务跳转</b></div></div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down">
                  <nz-radio-group [(ngModel)]="addTaskCenter.jumpType">
                    <label nz-radio nzValue="NONE" style="margin-bottom: 20px;">不跳转</label><br>
                    <label nz-radio nzValue="APP" style="margin-bottom: 25px;">跳转到APP</label><br>
                    <label nz-radio nzValue="WEB" style="margin-bottom: 25px;">跳转到网页</label><br>
                    <label nz-radio nzValue="DIALOG">提示弹窗</label>
                  </nz-radio-group>
                </div>
                <div nz-col nzSpan="6" class="span_down">
                  <nz-select [(ngModel)]="addTaskCenter.jump.page" style="margin-bottom: 20px;margin-top: 40px;" [disabled]="!(addTaskCenter.jumpType === 'APP')">
                    <nz-option required [nzLabel]="'个人中心---------------------------------'" [nzValue]="1"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 设置-------------------------'" [nzValue]="2"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 我的订单--------------------'" [nzValue]="3"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 常用信息--------------------'" [nzValue]="4"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 我的账户 > 充值------------'" [nzValue]="5"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 我的账户--------------------'" [nzValue]="6"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 联系我们 > 我的建议-------'" [nzValue]="7"></nz-option>
                    <nz-option required [nzLabel]="'对话流 > 帮助---------------------------'" [nzValue]="8"></nz-option>
                    <nz-option required [nzLabel]="'对话流-----------------------------------'" [nzValue]="9"></nz-option>
                  </nz-select>
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.jump.url" style="margin-bottom: 20px;" [disabled]="!(addTaskCenter.jumpType === 'WEB')"><br>
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.jump.msg" style="margin-bottom: 20px;" [disabled]="!(addTaskCenter.jumpType === 'DIALOG')">
                </div>
                <div nz-col nzSpan="2" class="span_down"><br>&nbsp;</div>
                <div nz-col nzSpan="2" class="span_down" style="margin-top: 10px;" *ngIf="addTaskCenter.jumpType === 'APP' && addTaskCenter.jump.page === 9">
                  <br>发送话术
                </div>
                <div nz-col nzSpan="6" class="span_down" style="margin-top: 10px;" *ngIf="addTaskCenter.jumpType === 'APP' && addTaskCenter.jump.page === 9">
                  <br><input nz-input nzSize="default" [(ngModel)]="addTaskCenter.jump.appMsg">
                </div>
              </div>
              <div nz-row><div nz-col nzSpan="3" class="span_down"><b>任务奖励</b></div></div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down">
                  <label nz-checkbox [(nzChecked)]="addTaskCenter.checkBean" style="margin-bottom: 50px;">小悟豆</label><br><br>
                  <label nz-checkbox [(nzChecked)]="addTaskCenter.checkExperience" style="margin-bottom: 20px;">经验</label><br>
                  <label nz-checkbox [(nzChecked)]="addTaskCenter.checkSkill">技能点</label>
                </div>
                <div nz-col nzSpan="3" class="span_down">
                  <nz-radio-group [(ngModel)]="addTaskCenter.checkBeanRes">
                    <label nz-radio nzValue="Fixed" style="margin-bottom: 15px;">固定金额</label><br>
                    <div *ngIf="!(addTaskCenter.taskBehavior === 'FINISH_TAXIS_ORDER' || addTaskCenter.taskBehavior === 'MOBILE_RECHARGE')" style="margin-bottom: 10px;"></div>
                    <label *ngIf="addTaskCenter.taskBehavior === 'FINISH_TAXIS_ORDER' || addTaskCenter.taskBehavior === 'MOBILE_RECHARGE'" nz-radio nzValue="Percentage" style="margin-bottom: 10px;">百分比</label><br>
                  </nz-radio-group>
                  <nz-radio-group [(ngModel)]="addTaskCenter.checkExperienceRes" style="margin-bottom: 15px;">
                    <label nz-radio nzValue="Fixed">固定经验</label><br>
                  </nz-radio-group>
                  <nz-radio-group [(ngModel)]="addTaskCenter.checkSkillRes">
                    <label nz-radio nzValue="Fixed">固定技能点</label>
                  </nz-radio-group>
                </div>
                <div nz-col nzSpan="6" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.rule.beanValue" style="margin-bottom: 10px;" [disabled]="!(addTaskCenter.checkBean === true && addTaskCenter.checkBeanRes === 'Fixed')"><br>
                  <div *ngIf="!(addTaskCenter.taskBehavior === 'FINISH_TAXIS_ORDER' || addTaskCenter.taskBehavior === 'MOBILE_RECHARGE')" style="margin-bottom: 10px;"></div>
                  <input nz-input nzSize="default" *ngIf="addTaskCenter.taskBehavior === 'FINISH_TAXIS_ORDER' || addTaskCenter.taskBehavior === 'MOBILE_RECHARGE'" [(ngModel)]="addTaskCenter.rule.beanPreValue" style="margin-bottom: 10px;" [disabled]="!(addTaskCenter.checkBean === true && addTaskCenter.checkBeanRes === 'Percentage')"><br>
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.rule.expValue" style="margin-bottom: 10px;" [disabled]="addTaskCenter.checkExperience === false"><br>
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.rule.perkValue" style="margin-bottom: 10px;" [disabled]="addTaskCenter.checkSkill === false">
                </div>
                <div nz-col nzSpan="1" *ngIf="addTaskCenter.taskBehavior === 'FINISH_TAXIS_ORDER' || addTaskCenter.taskBehavior === 'MOBILE_RECHARGE'" class="span_down right_alignment" style="padding-top: 10px;">
                  <br>%
                </div>
              </div>
            </div>
            <div *ngIf="addTaskCenter.taskType === 'ACTIVITY'">
              <div nz-row><div nz-col nzSpan="3" class="span_down"><b>活动信息</b></div></div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">活动名称：</div>
                <div nz-col nzSpan="6" class="span_down">
                  <input nz-input nzSize="default" placeholder="活动名称，最多20字" [(ngModel)]="addTaskCenter.name">
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">活动时间：</div>
                <div nz-col nzSpan="6" class="span_down">
                  <nz-range-picker [nzFormat]="'yyyy-MM-dd HH:mm:ss'" nzShowTime [nzShowToday]="true" [(ngModel)]="addTaskCenter.date" [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'taskCenterAct')"></nz-range-picker>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">活动描述：</div>
                <div nz-col nzSpan="6" class="span_down">
                  <textarea rows="4" nz-input [(ngModel)]="addTaskCenter.description"></textarea>
                </div>
              </div>
              <div nz-row>
                <div nz-col nzSpan="3" class="span_down right_alignment">活动图片：</div>
                <div nz-col nzSpan="21" class="span_down">
                  <nz-upload [(nzFileList)]="fileList" nzMultiple [nzBeforeUpload]="beforeUpload">
                    <button nz-button nzType="primary">
                      <i class="anticon anticon-upload"></i><span>上传icon</span>
                    </button>
                    &nbsp;&nbsp;建议尺寸64*64，限制大小：50k
                  </nz-upload>
                </div>
              </div>
              <div nz-row *ngIf="fileList.length == 1">
                <div nz-col nzSpan="3" class="span_down right_alignment"></div>
                <div nz-col nzSpan="21">
                  <img *ngIf="imageUrl" [src]="showImageUrl" class="image-panel">
                  <font color="#cccccc">&nbsp;&nbsp;建议尺寸64*64，限制大小：50k</font>
                </div>
              </div>
              <div nz-row><div nz-col nzSpan="3" class="span_down"><b>活动跳转</b></div></div>
              <div nz-col nzSpan="3" class="span_down">
                <nz-radio-group [(ngModel)]="addTaskCenter.jumpType">
                  <label nz-radio nzValue="NONE" style="margin-bottom: 20px;">不跳转</label><br>
                  <label nz-radio nzValue="APP" style="margin-bottom: 30px;">跳转到APP</label><br>
                  <label nz-radio nzValue="WEB" style="margin-bottom: 30px;">跳转到网页</label><br>
                  <label nz-radio nzValue="DIALOG">提示弹窗</label>
                </nz-radio-group>
              </div>
              <div nz-row>
                <div nz-col nzSpan="6" class="span_down">
                  <nz-select [(ngModel)]="addTaskCenter.jump.page" style="margin-bottom: 20px;margin-top: 35px;" [disabled]="!(addTaskCenter.jumpType === 'APP')">
                    <nz-option required [nzLabel]="'个人中心---------------------------------'" [nzValue]="1"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 设置-------------------------'" [nzValue]="2"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 我的订单--------------------'" [nzValue]="3"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 常用信息--------------------'" [nzValue]="4"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 我的账户 > 充值------------'" [nzValue]="5"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 我的账户--------------------'" [nzValue]="6"></nz-option>
                    <nz-option required [nzLabel]="'个人中心 > 联系我们 > 我的建议-------'" [nzValue]="7"></nz-option>
                    <nz-option required [nzLabel]="'对话流 > 帮助---------------------------'" [nzValue]="8"></nz-option>
                    <nz-option required [nzLabel]="'对话流-----------------------------------'" [nzValue]="9"></nz-option>
                  </nz-select><br>
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.jump.url" style="margin-bottom: 20px;" [disabled]="!(addTaskCenter.jumpType === 'WEB')"><br>
                  <input nz-input nzSize="default" [(ngModel)]="addTaskCenter.jump.msg" style="margin-bottom: 20px;" [disabled]="!(addTaskCenter.jumpType === 'DIALOG')">
                </div>
                <div nz-col nzSpan="2" class="span_down"><br>&nbsp;</div>
                <div nz-col nzSpan="2" class="span_down" style="margin-top: 5px;" *ngIf="addTaskCenter.jumpType === 'APP' && addTaskCenter.jump.page === 9">
                  <br>发送话术
                </div>
                <div nz-col nzSpan="6" class="span_down" style="margin-top: 5px;" *ngIf="addTaskCenter.jumpType === 'APP' && addTaskCenter.jump.page === 9">
                  <br><input nz-input nzSize="default" [(ngModel)]="addTaskCenter.jump.appMsg">
                </div>
              </div>
              <div nz-row><div nz-col nzSpan="3" class="span_down"><b>活动规则</b></div></div>
              <div nz-row>
                <nz-radio-group [(ngModel)]="addTaskCenter.activityRule">
                  <label nz-radio nzValue="recharge">充值活动</label>
                  <!-- <label nz-radio nzValue="login">登录活动</label>
                  <label nz-radio nzValue="Invitation">邀请好友</label>
                  <label nz-radio nzValue="taxi">打车挑战</label>
                  <label nz-radio nzValue="consumption">消费活动</label> -->
                </nz-radio-group>
              </div>
              <div nz-row *ngFor="let data of addTaskCenter.stepRule; let i=index;">
                <div nz-col nzSpan="2" class="span_down right_alignment">充值金额=&nbsp;</div>
                <div nz-col nzSpan="2" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="data.rechargeAmount">
                </div>
                <div nz-col nzSpan="3" class="span_down right_alignment">
                  <label nz-checkbox [(nzChecked)]="data.checkBean">小悟豆</label>
                </div>
                <div nz-col nzSpan="2" class="span_down">
                  <nz-radio-group [(ngModel)]="data.checkBeanRes">
                    <label nz-radio nzValue="Fixed" style="margin-bottom: 20px;">固定金额</label><br>
                    <label nz-radio nzValue="Percentage">百分比</label>
                  </nz-radio-group>
                </div>
                <div nz-col nzSpan="2" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="data.beanValue" style="margin-bottom: 15px;" [disabled]="!(data.checkBean === true && data.checkBeanRes === 'Fixed')"><br>
                  <input nz-input nzSize="default" [(ngModel)]="data.beanPreValue" [disabled]="!(data.checkBean === true && data.checkBeanRes === 'Percentage')">
                </div>
                <div nz-col nzSpan="1" class="span_down" style="padding-top: 15px;">
                  <br>&nbsp;%
                </div>
                <div nz-col nzSpan="2" class="span_down right_alignment">
                  <label nz-checkbox [(nzChecked)]="data.checkExperience">经验</label>
                </div>
                <div nz-col nzSpan="2" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="data.expValue" [disabled]="data.checkExperience === false">
                </div>
                <div nz-col nzSpan="3" class="span_down right_alignment">
                  <label nz-checkbox [(nzChecked)]="data.checkSkill">技能点</label>
                </div>
                <div nz-col nzSpan="2" class="span_down">
                  <input nz-input nzSize="default" [(ngModel)]="data.perkValue" [disabled]="data.checkSkill === false">
                </div>
                <div nz-col nzSpan="1">
                </div>
                <div nz-col nzSpan="2" class="span_down" *ngIf="i !== 0">
                  <button nz-button nzType="primary" (click)="onChange(i, 'deleteStepRule')"><i class="anticon anticon-close-delete"></i>删除</button>
                </div>
              </div>
              <div nz-row>
                <button nz-button nzType="primary" (click)="onChange('', 'addStepRule')"><i class="anticon anticon-file-add"></i>添加规则</button>
              </div>
            </div>
            <ng-template #addTaskCenterFooter>
              <button nz-button nzType="primary" (click)="doSave('taskCenter', '')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('taskCenter')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab [nzTitle]="taskLogsTemplate" (nzClick)="changePanel('taskLogs')" *ngIf="commonService.haveMenuPermission('children', '任务日志')">
          <ng-template #taskLogsTemplate><i class="anticon anticon-scan"></i>任务日志</ng-template>
          <form [formGroup]="searchTaskLogsForm">
            <div nz-row>
              <div nz-col nzSpan="2" class="span_down right_alignment">完成时间：</div>
              <div nz-col nzSpan="7">
                <nz-range-picker [nzFormat]="'yyyy-MM-dd HH:mm:ss'" formControlName="date" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="commonService.dateSearch" (ngModelChange)="onChange($event, 'taskLogs')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">用户ID：</div>
              <div nz-col nzSpan="2">
                <input nz-input formControlName="userId" placeholder="输入任务名称" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">用户账号：</div>
              <div nz-col nzSpan="2">
                <input nz-input formControlName="userPhone" placeholder="输入任务名称" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">任务名称：</div>
              <div nz-col nzSpan="2">
                <input nz-input formControlName="taskName" placeholder="输入任务名称" nzSize="default">
              </div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="loadData('taskLogs')"><i class="anticon anticon-search"></i>查询</button>
              </div>
            </div>
          </form>
          <nz-table #taskLogsTable [nzData]="dataTaskLogs" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">完成时间</th>
                <th nzWidth="20px">用户ID</th>
                <th nzWidth="20px">用户账号</th>
                <th nzWidth="20px">用户昵称</th>
                <th nzWidth="20px">任务名称</th>
                <th nzWidth="20px">任务奖励1</th>
                <th nzWidth="20px">任务奖励2</th>
                <th nzWidth="20px">任务奖励3</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of taskLogsTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.finishTime}}</td>
                <td>{{data.userId}}</td>
                <td>{{data.userPhone}}</td>
                <td>{{data.userName}}</td>
                <td><a (click)="showModal('goTaskCenter', data)">{{data.taskName}}</a></td>
                <td>{{data.bean ? '小悟豆*' + data.bean : '/'}}</td>
                <td>{{data.exp ? '经验值*' + data.exp : '/'}}</td>
                <td>{{data.Skill ? '技能点*' + data.Skill : '/'}}</td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>
        </nz-tab>

      </nz-tabset>
    </nz-card-tab>
  </nz-card>
</div>
