<app-left-nav></app-left-nav>
<div class="content" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">
  <nz-card style="width: 100%;">
    <nz-card-tab>
      <nz-tabset nzSize="large">
        <nz-tab [nzTitle]="taxiTemplate" (nzClick)="changePanel('taxi')" *ngIf="commonService.haveMenuPermission('children', '打车监控')">
          <ng-template #taxiTemplate><i class="anticon anticon-car"></i>打车监控</ng-template>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="19">
              <form [formGroup]="searchTaxiForm">
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                  订单号：
                </div>
                <div nz-col nzSpan="4">
                  <input nz-input maxlength="32" formControlName="orderId" placeholder="输入订单编号"
                    nzSize="default">
                </div>
                <div nz-col nzSpan="1">
                </div>
                <div nz-col nzSpan="2" class="span_down right_alignment">
                  报警时间：
                </div>
                <div nz-col nzSpan="7" class="span_down">
                  <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'taxi')"></nz-range-picker>
                </div>

              </form>
            </div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('taxi')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #taxiTable [nzData]="dataTaxi" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">订单id</th>
                <th nzWidth="20px">用户手机号</th>
                <th nzWidth="20px">用户昵称</th>
                <th nzWidth="20px">司机手机号</th>
                <th nzWidth="20px">打车计价</th>
                <th nzWidth="20px">可用小悟币</th>
                <th nzWidth="20px">可用小悟豆</th>
                <th nzWidth="20px">预估价格</th>
                <th nzWidth="20px">报警原因</th>
                <th nzWidth="20px">报警时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of taxiTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.orderId}}</td>
                <td>{{data.userPhone}}</td>
                <td>{{data.userNickName}}</td>
                <td>{{data.driverPhone}}</td>
                <td>{{data.nowPrice}}</td>
                <td>{{data.availableAmount}}</td>
                <td>{{data.availableBeans}}</td>
                <td>{{data.estimate_price}}</td>
                <td>{{data.monitorType !== null ? (data.monitorType === 0 ? '余额不足' : (data.monitorType === 1 ? '超出预估' : 'null')) : 'null'}}</td>
                <td>{{data.createDate}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('taxi', data)"><i
                      class="anticon anticon-form"></i>详情</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <!-- 弹框 —— 详情 —— 打车路径 -->
          <nz-modal [(nzVisible)]="isTaxiDetailVisible" nzWidth="1150" nzTitle="打车监控" [nzFooter]="taxiDetailModalFooter" (nzOnCancel)="hideModal('taxi')" nzMaskClosable="false">
              <!-- 打车路径详情 -->
            <div nz-row class="search_panel">
              <div nz-col nzSpan="8">
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">订单号：</div><div nz-col nzSpan="16">{{currentTaxi.orderId}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">司机电话：</div><div nz-col nzSpan="16">{{currentTaxi.driverPhone}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">用户账号：</div><div nz-col nzSpan="16">{{currentTaxi.userPhone}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">用户昵称：</div><div nz-col nzSpan="16">{{currentTaxi.userNickName}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">打车计价：</div><div nz-col nzSpan="16">{{currentTaxi.nowPrice}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">可用小悟币：</div><div nz-col nzSpan="16">{{currentTaxi.availableAmount}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">可用小悟豆：</div><div nz-col nzSpan="16">{{currentTaxi.availableBeans}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">打车预估价：</div><div nz-col nzSpan="16">{{currentTaxi.estimate_price}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">打车平台：</div><div nz-col nzSpan="16">{{currentTaxi.source ? (currentTaxi.source === 'didi' ? '滴滴平台' : (currentTaxi.source === 'shenzhou' ? '神州平台' : (currentTaxi.source === 'yidao' ? '易到平台' : (currentTaxi.source === 'shouqi' ? '首汽平台' : (currentTaxi.source === 'caocao' ? '曹操' : 'null'))))) : 'null'}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">报警原因：</div><div nz-col nzSpan="16">{{currentTaxi.monitorType !== null ? (currentTaxi.monitorType === 0 ? '余额不足' : (currentTaxi.monitorType === 1 ? '超出预估' : 'null')) : 'null'}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">报警时间：</div><div nz-col nzSpan="16">{{currentTaxi.createDate}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">起始地点：</div><div nz-col nzSpan="16">{{currentTaxi.originName}}</div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="8" class="right_alignment">目标地点：</div><div nz-col nzSpan="16">{{currentTaxi.destinationName}}</div>
                </div>
              </div>
              <div nz-col nzSpan="16">
                <div id='container' style='width: 100%; height: 400px;'></div>
              </div>
            </div>

            <!-- 弹框和底部定制 -->
            <ng-template #taxiDetailModalFooter>
              <button nz-button nzType="default" (click)="hideModal('taxi')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

        </nz-tab>


        <nz-tab [nzTitle]="voiceTemplate" (nzClick)="changePanel('voice')" *ngIf="commonService.haveMenuPermission('children', 'ASR语音切换')">
          <ng-template #voiceTemplate><i class="anticon anticon-sound"></i>ASR语音切换</ng-template>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">iOS语音ASR配置</div>
          </div>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="2" class="span_down spacing right_alignment">{{currentChannelName}}</div>
            <div nz-col nzSpan="1"></div>
            <div nz-col nzSpan="9" class="span_down">
              <nz-radio-group [(ngModel)]="voiceIOSRadioValue">
                <label nz-radio nzValue="BAI_DU" [(nzDisabled)]="!isSaveIOSVoiceButton">百度ASR</label>
                <label nz-radio nzValue="XUN_FEI" [(nzDisabled)]="!isSaveIOSVoiceButton">讯飞ASR</label>
              </nz-radio-group>
            </div>
          </div>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="2">
              <button *ngIf="!isSaveIOSVoiceButton" nz-button nzType="primary" (click)="doSave('editVoiceIOS', '')"><i class="anticon anticon-form"></i>编辑</button>
              <button *ngIf="isSaveIOSVoiceButton" nz-button nzType="primary" (click)="doSave('saveVoicceIOS', '')"><i class="anticon anticon-save"></i>保存</button>
            </div>
            <div nz-col nzSpan="2" *ngIf="isSaveIOSVoiceButton">
              <button nz-button nzType="primary" (click)="hideModal('voicceIOS')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </div>
          </div>

          <div nz-row class="search_panel">
            <div nz-col nzSpan="24" class="span_down" style="font-size: 20px;font-weight: bold;">安卓语音ASR配置</div>
          </div>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="2" class="span_down spacing right_alignment">{{currentChannelName}}</div>
            <div nz-col nzSpan="1"></div>
            <div nz-col nzSpan="9" class="span_down">
              <nz-radio-group [(ngModel)]="voiceANDROIDRadioValue">
                <label nz-radio nzValue="BAI_DU" [(nzDisabled)]="!isSaveANDROIDVoiceButton">百度ASR</label>
                <label nz-radio nzValue="XUN_FEI" [(nzDisabled)]="!isSaveANDROIDVoiceButton">讯飞ASR</label>
              </nz-radio-group>
            </div>
          </div>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="2">
              <button *ngIf="!isSaveANDROIDVoiceButton" nz-button nzType="primary" (click)="doSave('editVoiceANDROID', '')"><i class="anticon anticon-form"></i>编辑</button>
              <button *ngIf="isSaveANDROIDVoiceButton" nz-button nzType="primary" (click)="doSave('saveVoicceANDROID', '')"><i class="anticon anticon-save"></i>保存</button>
            </div>
            <div nz-col nzSpan="2" *ngIf="isSaveANDROIDVoiceButton">
              <button nz-button nzType="primary" (click)="hideModal('voicceANDROID')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </div>
          </div>
        </nz-tab>


        <nz-tab [nzTitle]="orderStateTemplate" (nzClick)="changePanel('orderState')" *ngIf="commonService.haveMenuPermission('children', '打车监控')">
            <!-- 订单状态监控 -->
          <ng-template #orderStateTemplate><i class="anticon anticon-car"></i>订单状态监控</ng-template>
          <div nz-row class="search_panel">
            <div nz-col nzSpan="22">
              <form [formGroup]="searchOrderStateForm">
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                  订单号：
                </div>
                <div nz-col nzSpan="3">
                  <input nz-input maxlength="32" formControlName="orderId" placeholder="输入订单编号" nzSize="default">
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                  订单类型：
                </div>
                <div nz-col nzSpan="3">
                  <nz-select [(ngModel)]="taxiOrderType" formControlName="orderType">
                    <nz-option [nzLabel]="'全部'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'火车'" [nzValue]="'TRAIN_ORDER'"></nz-option>
                    <nz-option required [nzLabel]="'机票'" [nzValue]="'FLIGHT_ORDER'"></nz-option>
                    <nz-option required [nzLabel]="'酒店'" [nzValue]="'HOTEL_ORDER'"></nz-option>
                    <nz-option required [nzLabel]="'打车'" [nzValue]="'TAXI_ORDER'"></nz-option>
                    <nz-option required [nzLabel]="'闪送'" [nzValue]="'EXPRESS_ORDER'"></nz-option>
                    <nz-option required [nzLabel]="'充话费'" [nzValue]="'PHONE_CHARGE_ORDER'"></nz-option>
                    <nz-option required [nzLabel]="'电影票'" [nzValue]="'MOVIE_ORDER'"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                  订单状态：
                </div>
                <div nz-col nzSpan="3">
                  <nz-select [(ngModel)]="taxiOrderState" formControlName="state">
                    <nz-option [nzLabel]="'全部'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'待出行'" [nzValue]="'DAICHUXING'"></nz-option>
                    <nz-option required [nzLabel]="'司机到达'" [nzValue]="'SIJIDAODA'"></nz-option>
                    <nz-option required [nzLabel]="'出票中'" [nzValue]="'CHUPIAOZHONG'"></nz-option>
                    <nz-option required [nzLabel]="'占座中'" [nzValue]="'ZHANZUOZHONG'"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="2" class="span_down right_alignment">
                  报警时间：
                </div>
                <div nz-col nzSpan="7" class="span_down">
                  <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'orderState')"></nz-range-picker>
                </div>

              </form>
            </div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('orderState')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #orderStateTable [nzData]="dataOrderState" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">订单号</th>
                <th nzWidth="20px">用户账号</th>
                <th nzWidth="20px">用户昵称</th>
                <th nzWidth="20px">订单类型</th>
                <th nzWidth="20px">订单状态</th>
                <th nzWidth="20px">报警时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of orderStateTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.orderId}}</td>
                <td>{{data.userPhone}}</td>
                <td>{{data.userNickName}}</td>
                <td>{{data.orderType === 'FLIGHT_ORDER' ? '机票' : data.orderType === 'TRAIN_ORDER' ? '火车' : data.orderType === 'HOTEL_ORDER' ? '酒店' : data.orderType === 'TAXI_ORDER' ? '打车' : data.orderType === 'EXPRESS_ORDER' ? '闪送' : data.orderType === 'PHONE_CHARGE_ORDER' ? '充话费' : data.orderType === 'MOVIE_ORDER' ? '电影票' : ''}}</td>
                <td>{{data.state === 'DAICHUXING' ? '待出行' : data.state === 'SIJIDAODA' ? '司机到达' : data.state === 'CHUPIAOZHONG' ? '出票中' : data.state === 'ZHANZUOZHONG' ? '占座中' : '' }}</td>
                <td>{{data.alertTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="goTaxtOrder(data)"><i class="anticon anticon-form"></i>查看</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>
        </nz-tab>



        <nz-tab [nzTitle]="orderStateSettingTemplate" (nzClick)="changePanel('orderStateSetting')" *ngIf="commonService.haveMenuPermission('children', '打车监控')">
            <!-- 订单状态设置 -->
          <ng-template #orderStateSettingTemplate><i class="anticon anticon-car"></i>订单状态设置</ng-template>
          <nz-table #orderStateSettingTable [nzData]="dataOrderStateSetting" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">BOT名称</th>
                <th nzWidth="20px">订单状态</th>
                <th nzWidth="20px">报警阈值1</th>
                <th nzWidth="20px">报警阈值2</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of orderStateSettingTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.orderType === 'TRAIN_ORDER' ? '火车' : data.orderType === 'FLIGHT_ORDER' || data.orderType === 'FLIGHT_RETURN_ORDER' ? '机票' : data.orderType === 'HOTEL_ORDER' ? '酒店' : data.orderType === 'TAXI_ORDER' ? '打车' : data.orderType === 'EXPRESS_ORDER' ? '闪送' : data.orderType === 'PHONE_CHARGE_ORDER' ? '充话费' : data.orderType === 'MOVIE_ORDER' ? '电影票' : data.orderType === 'PAIR_ORDER' ? '恋爱运势' : data.orderType === 'FORTUNE_ORDER' ? '月运势' : ''}}</td>
                <td>{{data.state === 'CHUPIAOZHONG' ? '出票中' : data.state === 'TUIKUANZHONG' ? '退款中' : data.state === 'DAIZHIFU' ? '待支付' : data.state === 'DAICHUXING' ? '待出行' : data.state === 'CHUPIAOSHIBAI' ? '出票失败' : data.state === 'YIQUXIAO' ? '已取消' : data.state === 'YITUIKUAN' ? '已退款' : data.state === 'YICHUXING' ? '已出行' : data.state === 'JIAOYIGUANBI' ? '交易关闭' : data.state === 'GAIQIANZHONG' ? '改签中' : data.state === 'ZHANZUOZHONG' ? '占座中' : data.state === 'QUXIAOZHONG' ? '取消中' : data.state === 'TUIPIAOZHONG' ? '退票中' : data.state === 'CHUPIAOSHIBAITUIKUANZHONG' ? '出票失败退款中' : data.state === 'TUIKUANSHIBAI' ? '退款失败' : data.state === 'SIJIDAODA' ? '司机已到达' : data.state === 'CHAOSHIQUXIAO' ? '超时取消' : ''}}</td>
                <td>{{data.lowTime}}分钟</td>
                <td>{{data.highTime}}分钟</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('orderStateSetting', data)"><i class="anticon anticon-form"></i>修改</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <!-- 弹框 —— 详情 —— 修改状态监控 -->
          <nz-modal [(nzVisible)]="orderStateSettingVisible" nzWidth="750" nzTitle="修改状态监控" [nzFooter]="orderStateSettingModalFooter" (nzOnCancel)="hideModal('orderStateSetting')" nzMaskClosable="false">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="8" class="span_down right_alignment">
                BOT名称：
              </div>
              <div nz-col nzSpan="10" class="span_down">
                {{currentOrderStateSetting.orderType === 'TRAIN_ORDER' ? '火车' : currentOrderStateSetting.orderType === 'FLIGHT_ORDER' || currentOrderStateSetting.orderType === 'FLIGHT_RETURN_ORDER' ? '机票' : currentOrderStateSetting.orderType === 'HOTEL_ORDER' ? '酒店' : currentOrderStateSetting.orderType === 'TAXI_ORDER' ? '打车' : currentOrderStateSetting.orderType === 'EXPRESS_ORDER' ? '闪送' : currentOrderStateSetting.orderType === 'PHONE_CHARGE_ORDER' ? '充话费' : currentOrderStateSetting.orderType === 'MOVIE_ORDER' ? '电影票' : currentOrderStateSetting.orderType === 'PAIR_ORDER' ? '恋爱运势' : currentOrderStateSetting.orderType === 'FORTUNE_ORDER' ? '月运势' : ''}}
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="8" class="span_down right_alignment">
                订单状态：
              </div>
              <div nz-col nzSpan="10" class="span_down">
                {{currentOrderStateSetting.state === 'CHUPIAOZHONG' ? '出票中' : currentOrderStateSetting.state === 'TUIKUANZHONG' ? '退款中' : currentOrderStateSetting.state === 'DAIZHIFU' ? '待支付' : currentOrderStateSetting.state === 'DAICHUXING' ? '待出行' : currentOrderStateSetting.state === 'CHUPIAOSHIBAI' ? '出票失败' : currentOrderStateSetting.state === 'YIQUXIAO' ? '已取消' : currentOrderStateSetting.state === 'YITUIKUAN' ? '已退款' : currentOrderStateSetting.state === 'YICHUXING' ? '已出行' : currentOrderStateSetting.state === 'JIAOYIGUANBI' ? '交易关闭' : currentOrderStateSetting.state === 'GAIQIANZHONG' ? '改签中' : currentOrderStateSetting.state === 'ZHANZUOZHONG' ? '占座中' : currentOrderStateSetting.state === 'QUXIAOZHONG' ? '取消中' : currentOrderStateSetting.state === 'TUIPIAOZHONG' ? '退票中' : currentOrderStateSetting.state === 'CHUPIAOSHIBAITUIKUANZHONG' ? '出票失败退款中' : currentOrderStateSetting.state === 'TUIKUANSHIBAI' ? '退款失败' : currentOrderStateSetting.state === 'SIJIDAODA' ? '司机已到达' : currentOrderStateSetting.state === 'CHAOSHIQUXIAO' ? '超时取消' : ''}}
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="8" class="span_down right_alignment">
                报警阈值1：
              </div>
              <div nz-col nzSpan="8">
                <input nz-input [(ngModel)]="currentOrderStateSetting.lowTime" placeholder="请输入报警阈值1" nzSize="default">
              </div>
              <div nz-col nzSpan="8">
                <nz-radio-group [(ngModel)]="currentOrderStateSetting.time1" class="span_down">
                  <label nz-radio nzValue="0">分钟</label>
                  <label nz-radio nzValue="1">小时</label>
                  <label nz-radio nzValue="2">天</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="8" class="span_down right_alignment">
                报警阈值2：
              </div>
              <div nz-col nzSpan="8">
                <input nz-input [(ngModel)]="currentOrderStateSetting.highTime" placeholder="请输入报警阈值2" nzSize="default">
              </div>
              <div nz-col nzSpan="8">
                <nz-radio-group [(ngModel)]="currentOrderStateSetting.time2" class="span_down">
                  <label nz-radio nzValue="0">分钟</label>
                  <label nz-radio nzValue="1">小时</label>
                  <label nz-radio nzValue="2">天</label>
                </nz-radio-group>
              </div>
            </div>

            <!-- 弹框和底部定制 -->
            <ng-template #orderStateSettingModalFooter>
              <button nz-button nzType="primary" (click)="doSave('modifyOrderStateSetting')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('orderStateSetting')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

        </nz-tab>

      </nz-tabset>
    </nz-card-tab>
  </nz-card>
</div>
