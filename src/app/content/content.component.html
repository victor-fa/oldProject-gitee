<app-left-nav></app-left-nav>
<div class="content" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">
  <nz-card style="width: 100%;">
    <nz-card-tab>
      <nz-tabset nzSize="large">
        <nz-tab nzTitle="内容发布">
          <div nz-row class="search_panel">
            <div nz-col nzSpan="21"></div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showAddModal()"><i class="anticon anticon-file-add"></i>新增内容</button>
            </div>
          </div>
          <nz-table #basicTable [nzData]="dataSet">
            <thead>
              <tr>
                <th>序号</th>
                <th>缩略图</th>
                <th>标题</th>
                <th>类型</th>
                <th>阅读量</th>
                <th>链接</th>
                <th>发布人</th>
                <th>状态</th>
                <th>发布时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of basicTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td><img [src]="'http://aliyun-sz2.chewrobot.com:46006/api/notices/thumbnails/' + data.thumbnail" class="thumbnail"></td>
                <td>{{data.title}}</td>
                <td>{{data.type == 'SYSTEM_MESSAGE' ? '系统信息' : '其他'}}</td>
                <td>{{data.readingAmount}}</td>
                <td>{{data.url === 'null' ? '' : data.url }}</td>
                <td>{{data.pseudonym}}</td>
                <td>{{now >= data.publishTime ? '已发布' : '未发布'}}</td>
                <td>{{data.publishTime | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModifyModal(data)" style="margin-right: 10px;"><i
                      class="anticon anticon-form"></i>修改</button>
                  <button nz-button nzType="primary" (click)="showDeleteModal(data)" style="margin-right: 10px;"><i
                      class="anticon anticon-delete"></i>删除</button>
                  <button nz-button nzType="primary" (click)="doPreview(data)" style="margin-right: 10px;"><i
                      class="anticon anticon-play-circle"></i>预览</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </nz-tab>

        <!-- 弹框 —— 新增 —— 新增内容 -->
        <nz-modal [(nzVisible)]="isAddVisible" nzWidth="1150" nzTitle="新增内容" [nzFooter]="addModalFooter" nzClosable="false">
          <form [formGroup]="addForm">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*标题：</div>
              <div nz-col nzSpan="22">
                <input nz-input maxlength="25" formControlName="title" [(ngModel)]="emptyAdd[0]" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="请输入标题" nzSize="default">
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*类型：</div>
              <div nz-col nzSpan="22">
                <nz-select [ngModel]="''" formControlName="type" [(ngModel)]="emptyAdd[1]">
                  <nz-option [nzLabel]="'----无----'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'使用技巧'" [nzValue]="'SKILL'"></nz-option>
                  <nz-option required [nzLabel]="'运营活动'" [nzValue]="'OPERATION'"></nz-option>
                  <nz-option required [nzLabel]="'小悟动态'" [nzValue]="'OCCURRENCE'"></nz-option>
                  <nz-option required [nzLabel]="'系统消息'" [nzValue]="'SYSTEM_MESSAGE'"></nz-option>
                </nz-select>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">url：</div>
              <div nz-col nzSpan="22">
                <input nz-input formControlName="url" [(ngModel)]="emptyAdd[2]" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="若url不为空，则默认使用url访问文章详情" nzSize="default">
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*摘要：</div>
              <div nz-col nzSpan="22">
                <textarea rows="4" nz-input formControlName="abstractContent" [(ngModel)]="emptyAdd[3]" maxlength="50" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="请输入摘要" nzSize="default"></textarea>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment"></div>
              <div nz-col nzSpan="22">
                <quill-editor formControlName="content" [(ngModel)]="emptyAdd[4]" [modules]="config" [style]="{height: '350px'}"></quill-editor>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment"><i class="anticon anticon-add"></i>缩略图：</div>
              <div nz-col nzSpan="22">
                <nz-upload [(nzFileList)]="fileList" [nzShowButton]="fileList.length < 1" nzMultiple [nzBeforeUpload]="beforeUpload">
                  <button nz-button>
                    <i class="anticon anticon-upload"></i><span>选择文件</span>
                  </button>
                </nz-upload>
              </div>
            </div>
            <div nz-row class="search_panel" *ngIf="fileList.length == 1">
              <div nz-col nzSpan="2" class="span_down right_alignment"></div>
              <div nz-col nzSpan="22">
                <img *ngIf="imageUrl" [src]="showImageUrl" class="avatar">
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*发布时间：</div>
              <div nz-col nzSpan="22">
                <nz-date-picker nzShowTime formControlName="publishTime" [(ngModel)]="emptyAdd[5]" required [nzFormat]="'yyyy-MM-dd HH:mm'" nzPlaceHolder="请输入发布时间"></nz-date-picker>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*发布人：</div>
              <div nz-col nzSpan="22">
                <input nz-input maxlength="6" formControlName="publisher" [(ngModel)]="emptyAdd[6]" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="请输入发布人" nzSize="default">
              </div>
            </div>
          </form>
          <!-- 弹框和底部定制 -->
          <ng-template #addModalFooter>
            <button nz-button nzType="primary" (click)="doSave()">保存</button>
            <button nz-button nzType="primary" (click)="doPreviewAdd()">预览</button>
            <button nz-button nzType="default" (click)="hideAddModal()">取消</button>
          </ng-template>
        </nz-modal>

        <!-- 弹框 —— 修改 —— 修改内容 -->
        <nz-modal [(nzVisible)]="isModifyVisible" nzWidth="1150" nzTitle="修改内容" [nzFooter]="modifyModalFooter"
          nzClosable="false">
          <form [formGroup]="modifyForm">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*标题：</div>
              <div nz-col nzSpan="22">
                <input nz-input maxlength="25" formControlName="title" [(ngModel)]="contentDate.title" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="请输入标题" nzSize="default">
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*类型：</div>
              <div nz-col nzSpan="22">
                <nz-select [ngModel]="contentDate.type" formControlName="type">
                  <nz-option [nzLabel]="'----无----'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'使用技巧'" [nzValue]="'SKILL'"></nz-option>
                  <nz-option required [nzLabel]="'运营活动'" [nzValue]="'OPERATION'"></nz-option>
                  <nz-option required [nzLabel]="'小悟动态'" [nzValue]="'OCCURRENCE'"></nz-option>
                  <nz-option required [nzLabel]="'系统消息'" [nzValue]="'SYSTEM_MESSAGE'"></nz-option>
                </nz-select>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">url：</div>
              <div nz-col nzSpan="22">
                <input nz-input formControlName="url" [(ngModel)]="contentDate.url" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="若url不为空，则默认使用url访问文章详情" nzSize="default">
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="spthumbnailan_down right_alignment">*摘要：</div>
              <div nz-col nzSpan="22">
                <textarea rows="4" nz-input formControlName="abstractContent" [(ngModel)]="contentDate.abstractContent" maxlength="64" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="请输入摘要" nzSize="default"></textarea>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment"></div>
              <div nz-col nzSpan="22">
                <quill-editor formControlName="content" [(ngModel)]="contentDate.content" [modules]="config" [style]="{height: '350px'}"></quill-editor>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment"><i class="anticon anticon-add"></i>缩略图：</div>
              <div nz-col nzSpan="22">
                <nz-upload [(nzFileList)]="fileList" [nzShowButton]="fileList.length < 1" nzMultiple [nzBeforeUpload]="beforeUpload">
                  <button nz-button>
                    <i class="anticon anticon-upload"></i><span>选择文件</span>
                  </button>
                </nz-upload>
              </div>
            </div>
            <div nz-row class="search_panel" *ngIf="fileList.length === 1">
              <div nz-col nzSpan="2" class="span_down right_alignment"></div>
              <div nz-col nzSpan="22">
                <img [src]="showImageUrl" class="avatar">
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*发布时间：</div>
              <div nz-col nzSpan="22">
                <nz-date-picker nzShowTime formControlName="publishTime" [(ngModel)]="contentDate.publishTime" required [nzFormat]="'yyyy-MM-dd HH:mm'" nzPlaceHolder="请输入发布时间"></nz-date-picker>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">*发布人：</div>
              <div nz-col nzSpan="22">
                <input nz-input maxlength="6" formControlName="publisher" [(ngModel)]="contentDate.pseudonym" onkeyup="this.value=this.value.replace(/(^\s*)|(\s*$)/g,'')"
                  placeholder="请输入发布人" nzSize="default">
              </div>
            </div>
          </form>
          <!-- 弹框和底部定制 -->
          <ng-template #modifyModalFooter>
            <button nz-button nzType="primary" (click)="doModify()">保存</button>
            <button nz-button nzType="primary" (click)="doPreviewModify()">预览</button>
            <button nz-button nzType="default" (click)="hideModifyModal()">取消</button>
          </ng-template>
        </nz-modal>

      </nz-tabset>
    </nz-card-tab>
  </nz-card>
</div>
