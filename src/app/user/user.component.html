<app-left-nav></app-left-nav>
<div class="user" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">
  <nz-card style="width: 100%;">
    <nz-card-tab>
      <nz-tabset nzSize="large" [(nzSelectedIndex)]="tabsetJson.currentNum">
        <nz-tab nzTitle="用户管理" (nzClick)="changePanel('user')" *ngIf="commonService.haveMenuPermission('children', '数据调整')">
          <form [formGroup]="searchUserForm">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                用户ID：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="userId" maxlength="10" placeholder="输入用户名" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">
                手机账号：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="phone" maxlength="11" placeholder="输入手机号" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">注册时间：</div>
              <div nz-col nzSpan="7">
                <nz-range-picker [nzFormat]="'yyyyMMdd'" formControlName="date" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'userRegister')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="3"></div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('user')"><i class="anticon anticon-search"></i>查询</button>
              </div>
            </div>

            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">登录时间：</div>
              <div nz-col nzSpan="7">
                <nz-range-picker [nzFormat]="'yyyyMMdd'" formControlName="date" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'userLogin')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">用户状态：</div>
              <div nz-col nzSpan="2">
                <nz-select [(ngModel)]="userLocked" formControlName="locked">
                  <nz-option required [nzLabel]="'全部'" nzValue=""></nz-option>
                  <nz-option required [nzLabel]="'正常'" nzValue="false"></nz-option>
                  <nz-option required [nzLabel]="'冻结'" nzValue="true"></nz-option>
                </nz-select>
              </div>
            </div>
          </form>

          <nz-table #rowSelectionUserTable [nzData]="userData" [nzSimple]="true" [nzScroll]="{x:'1800px'}">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户ID</th>
                <th>用户账号</th>
                <th>用户昵称</th>
                <th>小悟币余额</th>
                <th>冻结小悟币</th>
                <th>小悟豆余额</th>
                <th>冻结小悟豆</th>
                <th>免密支付</th>
                <th>注册时间</th>
                <th>上次登录时间</th>
                <th>用户状态</th>
                <th>充值记录</th>
                <th>开票记录</th>
                <th>消费记录</th>
                <th>常用信息</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionUserTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.userId}}</td>
                <td>{{data.account}}</td>
                <td>{{data.nickname}}</td>
                <td>{{data.availableAmount}}</td>
                <td>{{data.blockedAmount}}</td>
                <td>{{data.availableBeans}}</td>
                <td>{{data.blockedBeans}}</td>
                <td>{{data.autoPayment === true ? '开启' : data.autoPayment === false ? '关闭' : 'null'}}</td>
                <td>{{data.registerAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                <td>{{data.latestLoginAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                <td>{{data.locked === true ? '冻结' : data.locked === false ? '正常' : 'null' }}</td>
                <td><a (click)="showModal('goRecharge', data)">查看</a></td>
                <td><a (click)="showModal('goInvoice', data)">查看</a></td>
                <td><a>查看</a></td>
                <td><a (click)="showModal('userCommon', data)">查看</a></td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('UserInfo', data)" style="margin-right: 10px;">查看</button>
                  <button nz-button nzType="primary" *ngIf="data.locked === false" (click)="showModal('Blacklist', data)" style="margin-right: 10px;">冻结</button>
                  <button nz-button nzType="primary" *ngIf="data.locked === true" disabled style="margin-right: 10px;">冻结</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <!-- 弹框 —— 信息 —— 用户详情 -->
          <nz-modal [(nzVisible)]="isUserInfoDetailVisible" nzWidth="950" nzTitle="用户详情" [nzFooter]="userInfoDetailVisibleModalFooter" (nzOnCancel)="hideModal('UserInfo')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">用户账号：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.account}}</div>
              <div nz-col nzSpan="4" class="right_alignment">用户昵称：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.nickname}}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">小悟币余额：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.availableAmount}}</div>
              <div nz-col nzSpan="4" class="right_alignment">冻结小悟币：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.blockedAmount}}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">小悟豆余额：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.availableBeans}}</div>
              <div nz-col nzSpan="4" class="right_alignment">冻结小悟豆：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.blockedBeans}}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">免密支付：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.autoPayment === true ? '开启' : userInfoDetail.autoPayment === false ? '关闭' : 'null'}}</div>
              <div nz-col nzSpan="4" class="right_alignment">用户状态：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.locked === true ? '冻结' : userInfoDetail.locked === false ? '正常' : 'null' }}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">注册时间：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.registerAt | date:'yyyy-MM-dd HH:mm:ss'}}</div>
              <div nz-col nzSpan="4" class="right_alignment">登录时间：</div>
              <div nz-col nzSpan="8">{{userInfoDetail.latestLoginAt | date:'yyyy-MM-dd HH:mm:ss'}}</div>
            </div>
            <!-- <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">开启权限：</div>
              <div nz-col nzSpan="20">{{userInfoDetail.aaaa}}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">优惠券：</div>
            </div> -->

            <!-- <nz-table #rowSelectionUserDetailTable [nzData]="[{}]">
              <thead>
                <tr>
                  <th>序号</th>
                  <th>优惠券名称</th>
                  <th>优惠券类型</th>
                  <th>优惠券时间</th>
                  <th>优惠券金额</th>
                  <th>互斥规则</th>
                  <th>优惠券状态</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of rowSelectionUserDetailTable.data; let i=index;">
                  <td>{{i+1}}</td>
                  <td>{{data.aaaaa}}</td>
                  <td>{{data.aaaaa}}</td>
                  <td>{{data.aaaaa}}</td>
                  <td>{{data.aaaaa}}</td>
                  <td>{{data.aaaaa}}</td>
                  <td>{{data.aaaaa}}</td>
                </tr>
              </tbody>
            </nz-table> -->
            <!-- 弹框和底部定制 -->
            <ng-template #userInfoDetailVisibleModalFooter>
              <button nz-button nzType="default" (click)="hideModal('UserInfo')">取消</button>
            </ng-template>
          </nz-modal>

          <!-- 弹框 —— 信息 —— 常用信息 -->
          <nz-modal [(nzVisible)]="isUserInfoCommonVisible" nzWidth="950" nzTitle="常用信息" [nzFooter]="userInfoCommonVisibleModalFooter" (nzOnCancel)="hideModal('UserCommon')">
            <div nz-row class="search_panel">
              <nz-radio-group [(ngModel)]="currentUserCommonTab" (ngModelChange)="onChange($event, 'currentUserCommonTab')">
                <label nz-radio nzValue="TRAVELER">出行人</label>
                <label nz-radio nzValue="CONTACTS">联系人</label>
                <label nz-radio nzValue="DELIVERY_ADDRESS">配送地址</label>
                <label nz-radio nzValue="TRAVEL_ADDRESS">出行地址</label>
                <label nz-radio nzValue="INVOICE_TITLE">发票抬头</label>
              </nz-radio-group>
            </div>

            <nz-table #rowSelectionUserCommon1Table [nzData]="userInfoCommonData" *ngIf="currentUserCommonTab === 'TRAVELER'">
              <thead>
                <tr>
                  <th>序号</th> <th>姓名</th> <th>性别</th> <th>证件类型</th> <th>证件号</th> <th>出生日期</th> <th>手机号</th> <th>是否默认</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of rowSelectionUserCommon1Table.data; let i=index;">
                  <td>{{i+1}}</td> <td>{{data.cName}}</td> <td>{{data.sex === 0 ? '男' : data.sex === 1 ? '女' : 'null'}}</td>
                  <td>{{data.iDType === 1 ? '身份证' : data.iDType === 2 ? '护照' : data.iDType === 3 ? '内地前往台湾通行证' : data.iDType === 4 ? '内地前往港澳通行证' : data.iDType === 5 ? '港澳回乡证' : data.iDType === 6 ? '台湾回乡证' : data.iDType === 7 ? '军官证' : data.iDType === 8 ? '士兵证' : 'null'}}</td>
                  <td>{{data.iDNumber}}</td> <td>{{data.birthday}}</td> <td>{{data.contactPhone}}</td> <td>{{data.defaultCon ? '是' : '否'}}</td>
                </tr>
              </tbody>
            </nz-table>

            <nz-table #rowSelectionUserCommon2Table [nzData]="userInfoCommonData" *ngIf="currentUserCommonTab === 'CONTACTS'">
              <thead>
                <tr> <th>序号</th> <th>姓名</th> <th>手机号</th> <th>是否默认</th> </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of rowSelectionUserCommon2Table.data; let i=index;">
                  <td>{{i+1}}</td> <td>{{data.name}}</td> <td>{{data.phone}}</td> <td>{{data.exist ? '是' : '否'}}</td>
                </tr>
              </tbody>
            </nz-table>

            <nz-table #rowSelectionUserCommon3Table [nzData]="userInfoCommonData" *ngIf="currentUserCommonTab === 'DELIVERY_ADDRESS'">
              <thead>
                <tr> <th>序号</th> <th>姓名</th> <th>手机号</th> <th>配送地址</th> <th>是否默认</th> </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of rowSelectionUserCommon3Table.data; let i=index;">
                  <td>{{i+1}}</td> <td>{{data.name}}</td> <td>{{data.mobile}}</td> <td>{{data.address}}</td> <td>{{data.defaultParam ? '是' : '否'}}</td>
                </tr>
              </tbody>
            </nz-table>

            <nz-table #rowSelectionUserCommon4Table [nzData]="userInfoCommonData" *ngIf="currentUserCommonTab === 'TRAVEL_ADDRESS'">
              <thead> <tr> <th>序号</th> <th>标签</th> <th>地址</th> </tr> </thead>
              <tbody>
                <tr *ngFor="let data of rowSelectionUserCommon4Table.data; let i=index;"> <td>{{i+1}}</td> <td>{{data.title}}</td> <td>{{data.name}}</td> </tr>
              </tbody>
            </nz-table>

            <div *ngIf="currentUserCommonTab === 'INVOICE_TITLE'">
              <ng-container *ngFor="let data of userInfoCommonData; let i=index;">
                <ng-container *ngIf="data.type === true" style="background-color: #a9a9a9">
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="3" class="right_alignment">发票类型：</div>
                    <div nz-col nzSpan="5">企业</div>
                    <div nz-col nzSpan="3" class="right_alignment">企业名称：</div>
                    <div nz-col nzSpan="5">{{data.invoiceName ? data.invoiceName : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">纳税人识别号：</div>
                    <div nz-col nzSpan="5">{{data.dutyParagraph ? data.dutyParagraph : 'null'}}</div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="3" class="right_alignment">邮箱：</div>
                    <div nz-col nzSpan="5">{{data.email ? data.email : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">手机号：</div>
                    <div nz-col nzSpan="5">{{data.phone ? data.phone : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">注册地址：</div>
                    <div nz-col nzSpan="5">{{data.registerAdd ? data.registerAdd : 'null'}}</div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="3" class="right_alignment">注册电话：</div>
                    <div nz-col nzSpan="5">{{data.registerPhone ? data.registerPhone : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">开户银行：</div>
                    <div nz-col nzSpan="5">{{data.bank ? data.bank : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">开户账号：</div>
                    <div nz-col nzSpan="5">{{data.account ? data.account : 'null'}}</div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="3" class="right_alignment">是否默认：</div>
                    <div nz-col nzSpan="5">{{data.default === true ? '是' : data.default === false ? '否' : 'null'}}</div>
                  </div>
                </ng-container>

                <ng-container *ngIf="data.type === false">
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="3" class="right_alignment">发票类型：</div>
                    <div nz-col nzSpan="5">个人</div>
                    <div nz-col nzSpan="3" class="right_alignment">名称：</div>
                    <div nz-col nzSpan="5">{{data.invoiceName ? data.invoiceName : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">邮箱：</div>
                    <div nz-col nzSpan="5">{{data.email ? data.email : 'null'}}</div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="3" class="right_alignment">手机号：</div>
                    <div nz-col nzSpan="5">{{data.phone ? data.phone : 'null'}}</div>
                    <div nz-col nzSpan="3" class="right_alignment">是否默认：</div>
                    <div nz-col nzSpan="5">{{data.default === true ? '是' : data.default === false ? '否' : 'null'}}</div>
                  </div>
                </ng-container>

                <div nz-row class="search_panel invoice-line"></div>
              </ng-container>
            </div>
            <!-- 弹框和底部定制 -->
            <ng-template #userInfoCommonVisibleModalFooter>
              <button nz-button nzType="default" (click)="hideModal('UserInfoCommon')">取消</button>
            </ng-template>
          </nz-modal>

        </nz-tab>

        <nz-tab nzTitle="订单管理" (nzClick)="changePanel('booking')" *ngIf="commonService.haveMenuPermission('children', '数据调整')">
          <form [formGroup]="searchBookingForm">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                用户账号：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="status" placeholder="输入用户账号" nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down right_alignment">
                订票类型：
              </div>
              <div nz-col nzSpan="2">
                <nz-select [ngModel]="''" formControlName="type">
                  <nz-option [nzLabel]="'--全部--'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'机票'" [nzValue]="'1'"></nz-option>
                  <nz-option required [nzLabel]="'火车'" [nzValue]="'2'"></nz-option>
                  <nz-option required [nzLabel]="'酒店'" [nzValue]="'3'"></nz-option>
                  <nz-option required [nzLabel]="'打车'" [nzValue]="'4'"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                订单状态：
              </div>
              <div nz-col nzSpan="3">
                <nz-select [ngModel]="''" formControlName="status">
                  <nz-option [nzLabel]="'--全部--'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'待支付'" [nzValue]="'0'"></nz-option>
                  <nz-option *ngIf="1 > 2" required [nzLabel]="'出票中'" [nzValue]="'1'"></nz-option>
                  <nz-option required [nzLabel]="'待出行'" [nzValue]="'2'"></nz-option>
                  <nz-option required [nzLabel]="'已出行'" [nzValue]="'3'"></nz-option>
                  <nz-option required [nzLabel]="'出票失败'" [nzValue]="'4'"></nz-option>
                  <nz-option required [nzLabel]="'退款中'" [nzValue]="'5'"></nz-option>
                  <nz-option required [nzLabel]="'已退款'" [nzValue]="'6'"></nz-option>
                  <nz-option required [nzLabel]="'已取消'" [nzValue]="'7'"></nz-option>
                  <nz-option required [nzLabel]="'交易关闭'" [nzValue]="'8'"></nz-option>
                  <nz-option required [nzLabel]="'改签中'" [nzValue]="'9'"></nz-option>
                  <nz-option required [nzLabel]="'占座中'" [nzValue]="'10'"></nz-option>
                  <nz-option required [nzLabel]="'取消中'" [nzValue]="'11'"></nz-option>
                  <nz-option required [nzLabel]="'退票中'" [nzValue]="'12'"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="3" class="span_down right_alignment">
                订单生成日期：
              </div>
              <div nz-col nzSpan="7" class="span_down">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyyMMdd'" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'booking')"></nz-range-picker>
              </div>
            </div>

            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                订单编号：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input maxlength="32" formControlName="orderId" placeholder="输入订单编号" nzSize="default">
              </div>
              <div nz-col nzSpan="17"></div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="doSearch('booking')"><i class="anticon anticon-search"></i>查询</button>
              </div>
            </div>
          </form>

          <nz-table #rowSelectionBookingTable [nzData]="dataOrder" [nzSimple]="true" [(nzPageSize)]="bookingPageSize" [nzShowPagination]="false" [nzScroll]="{x:'1800px'}">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户账号</th>
                <th>用户昵称</th>
                <th>订单状态</th>
                <th>订票类型</th>
                <th>订单生成日期</th>
                <th>订单价格</th>
                <th>支付方式</th>
                <th>内部订单号</th>
                <th>企业管家订单号</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionBookingTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.aaaaa}}</td>
                <td>{{data.aaaaa}}</td>
                <td>{{data.state === 0 ? '待支付' : data.state === 1 ? '出票中' : data.state === 2 ? '已出行' : data.state === 3 ? '已出行' : data.state === 4 ? '出票失败' : data.state === 4 ? '待支付' : data.state === 5 ? '退款中' : data.state === 6 ? '已退款' : data.state === 7 ? '已取消' : data.state === 8 ? '交易关闭' : data.state === 9 ? '改签中' : data.state === 10 ? '占座中' : data.state === 11 ? '取消中' : data.state === 12 ? '退票中' : 'null' }}</td>
                <td>{{data.orderType === 0 || data.orderType === 1 ? '机票' : data.orderType === 2 ? '火车' : data.orderType === 3 ? '酒店' : data.orderType === 4 ? '打车' : data.orderType === 5 ? '充话费' : data.orderType === 8 ? '闪送' : 'null'}}</td>
                <td>{{data.createTime}}</td><!-- | date:'yy-MM-dd HH:mm:ss' -->
                <td>{{data.total}}</td>
                <td>{{data.paymentType === 1 ? '支付宝' : data.paymentType === 2 ? '微信' : data.paymentType === 3 ? (data.currencyTypeOfWallet === 1 ? '小悟币' : '小悟豆') : 'null' }}</td>
                <td>{{data.orderId}}</td>
                <td>{{data.actualId}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('BookingDetail', data)" style="margin-right: 10px;">订单详情</button>
                  <button nz-button nzType="primary" (click)="showModal('InvoiceDetail', data)" style="margin-right: 10px;">发票详情</button>
                  <button nz-button nzType="primary" *ngIf="data.state === 2 && (data.orderType === 0 || data.orderType === 1)" (click)="showModal('Refund', data)" style="margin-right: 10px;">退票</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div nz-row style="margin: 10px 0;line-height: 30px;">
            <div nz-col nzSpan="12"></div>
            <div nz-col nzSpan="2">
              <nz-select [(ngModel)]="bookingPageSize">
                <nz-option required [nzLabel]="'5'" [nzValue]="5"></nz-option>
                <nz-option required [nzLabel]="'10'" [nzValue]="10"></nz-option>
                <nz-option required [nzLabel]="'20'" [nzValue]="20"></nz-option>
                <nz-option required [nzLabel]="'50'" [nzValue]="50"></nz-option>
              </nz-select>
            </div>
            <div nz-col nzSpan="1" *ngIf="changeBookingPage !== 1 && totalBooking !== 0"><button nz-button nzType="primary" (click)="lastPage('booking')"><i class="anticon anticon-left"></i></button></div>
            <div nz-col nzSpan="1" *ngIf="changeBookingPage === 1 || totalBooking === 0"><button disabled nz-button nzType="primary"><i class="anticon anticon-left"></i></button></div>
            <div nz-col nzSpan="6">当前为 {{changeBookingPage}} / {{allBookingSize}} 页 &nbsp;&nbsp; 共 {{totalBooking}} 条</div>
            <div nz-col nzSpan="1" *ngIf="changeBookingPage !== allBookingSize && totalBooking !== 0"><button nz-button nzType="primary" (click)="nextPage('booking')"><i class="anticon anticon-right"></i></button></div>
            <div nz-col nzSpan="1" *ngIf="changeBookingPage === allBookingSize || totalBooking === 0"><button disabled nz-button nzType="primary"><i class="anticon anticon-right"></i></button></div>
          </div>

          <!-- 弹框 —— 信息 —— 发票详情 -->
          <nz-modal [(nzVisible)]="isInvoiceVisible" nzWidth="950" nzTitle="发票详情" [nzFooter]="invoiceDetailModalFooter" (nzOnCancel)="hideModal('InvoiceDetail')">
            <div *ngIf="invoiceDetail.invoiceMsg">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">发票状态：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.state === 0 ? '开票失败' : invoiceDetail.state === 1 ? '已开票' : invoiceDetail.state === 2 ? '开票中' : invoiceDetail.state === 3 ? '待开票' : invoiceDetail.state === 4 ? '发票作废' : 'null'}}</div>
                <div nz-col nzSpan="4" class="right_alignment">发票类型：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.type === 1 ? '企业' : invoiceDetail.type === 2 ? '个人' : 'null'}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">开票金额：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoicePrice}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">公司名称：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.invoiceName}}</div>
                <div nz-col nzSpan="4" class="right_alignment">纳税人识别号：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.dutyParagraph}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">邮箱：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.email}}</div>
                <div nz-col nzSpan="4" class="right_alignment">手机号：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.phone}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">注册地址：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.registerAdd}}</div>
                <div nz-col nzSpan="4" class="right_alignment">注册电话：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.registerPhone}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">开户银行：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.bank}}</div>
                <div nz-col nzSpan="4" class="right_alignment">开户账户：</div>
                <div nz-col nzSpan="8">{{invoiceDetail.invoiceMsg.account}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">开票订单号：</div>
                <div nz-col nzSpan="8">
                  <span *ngFor="let item of invoiceDetail.orderIds; let i=index;">
                    {{item}}<br>
                  </span>
                </div>
              </div>
            </div><div *ngIf="!invoiceDetail.invoiceMsg">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="10"></div>
                <div nz-col nzSpan="4">暂无发票详情！</div>
                <div nz-col nzSpan="10"></div>
              </div>
            </div>
            <!-- 弹框和底部定制 -->
            <ng-template #invoiceDetailModalFooter>
              <button nz-button nzType="default" (click)="hideModal('InvoiceDetail')">取消</button>
            </ng-template>
          </nz-modal>

          <!-- 弹框 —— 信息 —— 订单详情 -->
          <nz-modal [(nzVisible)]="isBookingDetailVisible" nzWidth="750" nzTitle="订单详情" [nzFooter]="bookingDetailModalFooter" (nzOnCancel)="hideModal('BookingDetail')">
            <form [formGroup]="modifyBookingForm">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4"></div>
                <div nz-col nzSpan="7" class="right_alignment">订单id：</div>
                <div nz-col nzSpan="9">{{orderId}}</div>
                <div nz-col nzSpan="4"></div>
              </div>

              <!-- 机票信息 -->
              <div *ngIf="isFlightOrder">
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">目的机场位置：</div>
                  <div nz-col nzSpan="9">{{dataDetail.arr_airport}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">目的城市：</div>
                  <div nz-col nzSpan="9">{{dataDetail.arr_city}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">到达时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.arr_date}} {{dataDetail.arr_time}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">机票类型：</div>
                  <div nz-col nzSpan="9">{{dataDetail.cabin_type}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">联系人：</div>
                  <div nz-col nzSpan="9">{{dataDetail.contact}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">联系人电话：</div>
                  <div nz-col nzSpan="9">{{dataDetail.contact_mobile}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">始发机场：</div>
                  <div nz-col nzSpan="9">{{dataDetail.dept_airport}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">始发城市：</div>
                  <div nz-col nzSpan="9">{{dataDetail.dept_city}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">始发时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.dept_date}} {{dataDetail.dept_time}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">所在航班：</div>
                  <div nz-col nzSpan="9">{{dataDetail.flight_com}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div *ngFor="let item of dataDetail.flight_order_passengers; let i=index;" style="background-color: whitesmoke;">
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}姓名：</div>
                    <div nz-col nzSpan="9">{{item.name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}属性：</div>
                    <div nz-col nzSpan="9">{{item.age_type}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}生日：</div>
                    <div nz-col nzSpan="9">{{item.birthday}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}证件号：</div>
                    <div nz-col nzSpan="9">{{item.card_no}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}性别：</div>
                    <div nz-col nzSpan="9" *ngIf="item.sex === '1'">男</div>
                    <div nz-col nzSpan="9" *ngIf="item.sex === '2'">女</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">旅程时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.flight_times}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">航班类型：</div>
                  <div nz-col nzSpan="9">{{dataDetail.flight_type}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">企业管家编号：</div>
                  <div nz-col nzSpan="9"><a (click)="showExternal(1, dataDetail.no)">{{dataDetail.no}}</a></div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单价格：</div>
                  <div nz-col nzSpan="9">{{dataDetail.amount}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单类型：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_type}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">备注：</div>
                  <div nz-col nzSpan="9">{{dataDetail.remark}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">当前订单状态：</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 0">待支付</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 1">出票中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 2">待出行</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 3">已出行</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 4">出票失败</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 5">退款中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 6">已退款</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 7">已取消</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 8">交易关闭</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 9">改签中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 10">占座中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 11">取消中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 12">退票中</div>
                  <div nz-col nzSpan="4"></div>
                </div>
              </div>

              <!-- 酒店信息 -->
              <div *ngIf="isHotelOrder">
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">到达时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.arrival_date}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">是否可取消：</div>
                  <div nz-col nzSpan="9" *ngIf="dataDetail.cancel_policy.allowed === true">可以取消</div>
                  <div nz-col nzSpan="9" *ngIf="dataDetail.cancel_policy.allowed === false">不可取消</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">取消说明：</div>
                  <div nz-col nzSpan="9">{{dataDetail.cancel_policy.penalty_type_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">取消时限：</div>
                  <div nz-col nzSpan="9">{{dataDetail.cancel_policy.time_limit}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">手续费：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotelOrderReturn.detail.penalty}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">最晚到达时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.cancel_policy.time_limit}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">联系人电话：</div>
                  <div nz-col nzSpan="9">{{dataDetail.contact_mobile}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">联系人姓名：</div>
                  <div nz-col nzSpan="9">{{dataDetail.contact_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单创建时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.createAt}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div *ngFor="let item of dataDetail.customers; let i=index;" style="background-color: whitesmoke;">
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">入住成员{{i}}：</div>
                    <div nz-col nzSpan="9">{{item.name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">离开时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.departure_date}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单价格：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotelOrderReturn.order_amount}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店订单编号：</div>
                  <div nz-col nzSpan="9"><a (click)="showExternal(3, dataDetail.hotelOrderReturn.no)">{{dataDetail.hotelOrderReturn.no}}</a></div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店订单状态：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotelOrderReturn.state_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店订单创建时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotelOrderReturn.created_at}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店所在城市：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotel_city}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店编号：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotel_id}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店名称：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotel_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店评价：</div>
                  <div nz-col nzSpan="9">{{dataDetail.hotel_score}}分</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">最晚到达时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.latest_arrival_time}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间类型：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.bed_type}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间容纳人数：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.capacity}}人</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间小孩人数：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.children}}人</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间是否有早餐：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.meal}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间规格：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.rate_type_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间占地面积：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.roomArea}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">房间特色：</div>
                  <div nz-col nzSpan="9">{{dataDetail.order_room.room_type_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <!-- <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店所在区：</div>
                  <div nz-col nzSpan="9">{{dataDetail.peripheral_information}}</div>
                  <div nz-col nzSpan="4"></div>
                </div> -->
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">预订房间数量：</div>
                  <div nz-col nzSpan="9">{{dataDetail.room_nums}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">信息来源：</div>
                  <div nz-col nzSpan="9">{{dataDetail.source}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">酒店星级：</div>
                  <div nz-col nzSpan="9">{{dataDetail.stars_level}}星级</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">用户Id：</div>
                  <div nz-col nzSpan="9">{{dataDetail.userId}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">当前订单状态：</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 0">待支付</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 1">出票中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 2">待出行</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 3">已出行</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 4">出票失败</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 5">退款中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 6">已退款</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 7">已取消</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 8">交易关闭</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 9">改签中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 10">占座中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 11">取消中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 12">退票中</div>
                  <div nz-col nzSpan="4"></div>
                </div>
              </div>

              <!-- 火车信息 -->
              <div *ngIf="isTrainOrder">
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单创建时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.created_at}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单编号：</div>
                  <div nz-col nzSpan="9"><a (click)="showExternal(2, dataDetail.no)">{{dataDetail.no}}</a></div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">到达时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.arrival_at}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">到达城市：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.arrival_city_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">变更差价：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.change_price_diff}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">变更服务价格：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.change_service_charge}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">联系人电话：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.contact_mobile}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">联系人姓名：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.contacts}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">出发时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.departure_at}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">出发城市：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.departure_city_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">出发站台：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.from_station}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">到达站台：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.to_station}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">火车编号：</div>
                  <div nz-col nzSpan="9">{{dataDetail.service_order.train_no}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div *ngFor="let item of dataDetail.service_order.tickets; let i=index;" style="background-color: whitesmoke;">
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}退款价：</div>
                    <div nz-col nzSpan="9">{{item.estimate_refund_price}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}变更价格：</div>
                    <div nz-col nzSpan="9">{{item.estimate_refund_service_charge}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}编号：</div>
                    <div nz-col nzSpan="9">{{item.id}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}价格：</div>
                    <div nz-col nzSpan="9">{{item.price}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}退款费用：</div>
                    <div nz-col nzSpan="9">{{item.refund_price}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}退款服务费：</div>
                    <div nz-col nzSpan="9">{{item.refund_service_charge}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}座位类型：</div>
                    <div nz-col nzSpan="9">{{item.seat_category}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">车票{{i+1}}状态：</div>
                    <div nz-col nzSpan="9">{{item.state_name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}生日：</div>
                    <div nz-col nzSpan="9">{{item.passenger.birthday}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}编号：</div>
                    <div nz-col nzSpan="9">{{item.passenger.id_no}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}身份证：</div>
                    <div nz-col nzSpan="9">{{item.passenger.id_type_name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}姓名：</div>
                    <div nz-col nzSpan="9">{{item.passenger.name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}类型：</div>
                    <div nz-col nzSpan="9">{{item.passenger.passenger_type_name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}是否退款：</div>
                    <div nz-col nzSpan="9" *ngIf="item.passenger.refund === true">是</div>
                    <div nz-col nzSpan="9" *ngIf="item.passenger.refund === false">否</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                  <div nz-row class="search_panel">
                    <div nz-col nzSpan="4"></div>
                    <div nz-col nzSpan="7" class="right_alignment">乘客{{i+1}}性别：</div>
                    <div nz-col nzSpan="9">{{item.passenger.sex_name}}</div>
                    <div nz-col nzSpan="4"></div>
                  </div>
                </div>

                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单情况：</div>
                  <div nz-col nzSpan="9">{{dataDetail.state_name}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">当前订单状态：</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 0">待支付</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 1">出票中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 2">待出行</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 3">已出行</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 4">出票失败</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 5">退款中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 6">已退款</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 7">已取消</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 8">交易关闭</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 9">改签中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 10">占座中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 11">取消中</div>
                  <div nz-col nzSpan="9" *ngIf="orderStatus === 12">退票中</div>
                  <div nz-col nzSpan="4"></div>
                </div>
              </div>

              <!-- 打车信息 -->
              <div *ngIf="isTaxiOrder">
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单状态：</div>
                  <div nz-col nzSpan="9">{{dataDetail.state}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单生成时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.createTime}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">预估价格：</div>
                  <div nz-col nzSpan="9">{{dataDetail.estimatePrice}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">内部订单号：</div>
                  <div nz-col nzSpan="9">{{dataDetail.orderId}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">出发地：</div>
                  <div nz-col nzSpan="9">{{dataDetail.deptAdd}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">目的地：</div>
                  <div nz-col nzSpan="9">{{dataDetail.arrAdd}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">用户账号：</div>
                  <div nz-col nzSpan="9">{{dataDetail.userPhone}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">用户昵称：</div>
                  <div nz-col nzSpan="9">{{dataDetail.userName}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">打车平台：</div>
                  <div nz-col nzSpan="9">{{dataDetail.source}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">司机电话：</div>
                  <div nz-col nzSpan="9">{{dataDetail.driverPhone}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">车牌号码：</div>
                  <div nz-col nzSpan="9">{{dataDetail.carNo}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">订单类型：</div>
                  <div nz-col nzSpan="9">{{dataDetail.orderType}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">出行时间：</div>
                  <div nz-col nzSpan="9">{{dataDetail.startTime}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">实付价格：</div>
                  <div nz-col nzSpan="9">{{dataDetail.paymentPrice}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="7" class="right_alignment">企业管家订单号：</div>
                  <div nz-col nzSpan="9">{{dataDetail.actualId}}</div>
                  <div nz-col nzSpan="4"></div>
                </div>
              </div>

              <div nz-row class="search_panel" *ngIf="!isHotelOrder">
                <div nz-col nzSpan="4"></div>
                <div nz-col nzSpan="7" class="right_alignment">修改订单状态：</div>
                <div nz-col nzSpan="6" class="right_alignment">
                  <nz-select [ngModel]="''" formControlName="updateType">
                    <nz-option [nzLabel]="'-------无-------'" [nzValue]="''"></nz-option>
                    <nz-option required [nzLabel]="'出票中 => 待出行'" [nzValue]="'1'"></nz-option>
                    <nz-option *ngIf="!isTrainOrder" required [nzLabel]="'退票中 => 退款中'" [nzValue]="'2'"></nz-option>
                  </nz-select>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="3"><button nz-button nzType="primary" (click)="showModal('modifyBooking', '')" style="margin-right: 10px;">修改</button></div>
                <div nz-col nzSpan="3"></div>
              </div>
            </form>
            <!-- 弹框和底部定制 待出行且为酒店时 才可取消订单 -->
            <ng-template #bookingDetailModalFooter>
              <button *ngIf="isHotelOrder && orderStatus===2" nz-button nzType="primary" (click)="cancleHotelOrder()">取消订单</button>
              <button nz-button nzType="default" (click)="hideModal('BookingDetail')">取消</button>
            </ng-template>
          </nz-modal>

          <!-- 弹框 —— 信息 —— 退票申请 -->
          <nz-modal [(nzVisible)]="isRefundVisible" nzWidth="950" nzTitle="退票申请" [nzFooter]="refundModalFooter" (nzOnCancel)="hideModal('Refund')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="24">选择退票机票</div>
            </div>
            <div nz-row class="search_panel" *ngFor="let data of dataRefund; let i=index;">
              <div nz-col nzSpan="1">
                <nz-radio-group [(ngModel)]="refundRadio">
                  <label nz-radio [nzValue]="data.passengerName"></label>
                </nz-radio-group>
              </div>
              <div nz-col nzSpan="2" style="font-weight: bold;">乘客{{i+1}}</div>
              <div nz-col nzSpan="2">{{data.passengerName}}</div>
              <div nz-col nzSpan="2" style="font-weight: bold;">证件号{{i+1}}</div>
              <div nz-col nzSpan="7">{{data.cardNum}}</div>
              <div nz-col nzSpan="2" style="font-weight: bold;">退票原因</div>
              <div nz-col nzSpan="8">
                <nz-select [ngModel]="data.msg" (ngModelChange)="onRefundMsgChange($event, i)">
                  <nz-option required *ngFor="let item of data.msg; let i=index;" [nzLabel]="item" [nzValue]="item"></nz-option>
                </nz-select>
              </div>
            </div>
            <!-- 弹框和底部定制 -->
            <ng-template #refundModalFooter>
              <button nz-button nzType="primary" (click)="doDelete('Refund')">提交</button>
              <button nz-button nzType="default" (click)="hideModal('Refund')">取消</button>
            </ng-template>
          </nz-modal>

        </nz-tab>

        <nz-tab nzTitle="数据调整" (nzClick)="changePanel('adjust')" *ngIf="commonService.haveMenuPermission('children', '数据调整')">
          <div nz-row class="search_panel">
            <div nz-col nzSpan="7">
              <nz-range-picker [nzFormat]="'yyyyMMdd'" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'booking')"></nz-range-picker>
            </div>
            <div nz-col nzSpan="1"></div>
            <div nz-col nzSpan="4">
              <nz-select [(ngModel)]="adjustType">
                <nz-option required [nzLabel]="'小悟豆'" nzValue="BEAN"></nz-option>
                <nz-option required [nzLabel]="'小悟币'" nzValue="COIN"></nz-option>
              </nz-select>
            </div>
            <div nz-col nzSpan="7"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('adjust')"><i class="anticon anticon-search"></i>查询</button>
            </div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showModal('adjustAdd', '')"><i class="anticon anticon-add"></i>新增发放</button>
            </div>
          </div>

          <nz-table #rowSelectionUserTable [nzData]="adjustData" [nzSimple]="true" [nzShowPagination]="false">
            <thead>
              <tr>
                <th>序号</th>
                <th>发放日期</th>
                <th>发放时间</th>
                <th>发放人数</th>
                <th>失败人数</th>
                <th>货币类型</th>
                <th>数量</th>
                <th>调整原因</th>
                <th>操作人</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionUserTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.createDate | date:'yyyy-MM-dd' }}</td>
                <td>{{data.createTime}}</td>
                <td>{{data.all}}</td>
                <td>{{data.failNum}}</td>
                <td>{{data.adjustType === 'BEAN' ? '小悟豆' : data.adjustType === 'COIN' ? '小悟币' : 'null'}}</td>
                <td>{{data.adjustAmount}}</td>
                <td nzTitle="{{data.adjustReason}}" nzPlacement="bottom" nz-tooltip><a>详细原因</a></td>
                <td>{{data.operater.phone}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('adjustDetail', data)" style="margin-right: 10px;">查看</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <!-- 弹框 —— 新增 —— 新增发放 -->
          <nz-modal [(nzVisible)]="isAdjustAddVisible" nzWidth="950" nzTitle="新增发放" [nzFooter]="adjustAddModalFooter" (nzOnCancel)="hideModal('adjustAdd')">
            <form [formGroup]="addAdjustForm">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down" style="font-size: 20px;font-weight: bold;">发送对象</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="20" style="color: #a9a9a9">
                  请填写发送的用户id（手机号码），如果需要发送多个，请换行输入<br>单次发送人数上限：10000（如果需要调整，请通知产品）
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3">
                </div>
                <div nz-col nzSpan="12">
                  <textarea rows="5" nz-input formControlName="users" [(ngModel)]="adjustDetail.users" placeholder="请输入发送对象手机号" nzSize="default"></textarea>
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down" style="font-size: 20px;font-weight: bold;">附带消息</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="20" class="span_down" style="color: #a9a9a9">
                  一般适用于奖励/补偿用户，附带的信息
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down right_alignment">
                  标题：
                </div>
                <div nz-col nzSpan="9">
                  <input nz-input nzSize="default" formControlName="noticeTitle" [(ngModel)]="adjustDetail.noticeTitle" placeholder="请输入标题">
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down right_alignment">
                  类型：
                </div>
                <div nz-col nzSpan="9" class="span_down">
                  系统消息
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down right_alignment">
                  摘要：
                </div>
                <div nz-col nzSpan="9">
                  <input nz-input nzSize="default" formControlName="noticeAbstract" [(ngModel)]="adjustDetail.noticeAbstract" placeholder="请输入摘要">
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down right_alignment">
                  内容：
                </div>
                <div nz-col nzSpan="20">
                  <quill-editor formControlName="noticeContent" [(ngModel)]="adjustDetail.noticeContent" [modules]="config" [style]="{height: '300px'}"></quill-editor>
                </div>
              </div>

              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="span_down" style="font-size: 20px;font-weight: bold;">发送奖励配置</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="19" class="span_down" style="color: #a9a9a9">
                  正数为增加，负数为减少；若减少的金额大于用户余额，则调整失败
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="24">
                  <nz-radio-group [(ngModel)]="adjustTypeAdd" formControlName="adjustType">
                    <div nz-row class="search_panel">
                      <div nz-col nzSpan="4"><label nz-radio nzValue="BEAN">小悟豆</label></div>
                      <div nz-col nzSpan="6"><input nz-input formControlName="adjustAmount" [ngModel]="''" nzSize="default"></div>
                      <div nz-col nzSpan="2"></div>
                      <div nz-col nzSpan="4"><label nz-radio nzValue="COIN">小悟币</label></div>
                      <div nz-col nzSpan="6"><input nz-input formControlName="adjustAmount" [ngModel]="''" nzSize="default"></div>
                    </div>
                  </nz-radio-group>
                </div>
              </div>

              <div nz-row class="search_panel">
                <div nz-col nzSpan="3" class="span_down" style="font-size: 20px;font-weight: bold;">调整原因</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="20" class="span_down" style="color: #a9a9a9">
                  调整原因，是为了后面追溯的时候，能够追溯到为什么有这个操作，也方便归因
                </div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="3">
                </div>
                <div nz-col nzSpan="12">
                  <textarea rows="5" nz-input formControlName="adjustReason" [(ngModel)]="adjustDetail.adjustReason" placeholder="请输入调整原因" nzSize="default"></textarea>
                </div>
              </div>

            </form>
            <!-- 弹框和底部定制 -->
            <ng-template #adjustAddModalFooter>
              <button nz-button nzType="primary" (click)="showModal('adjustSend')">确定</button>
              <button nz-button nzType="default" (click)="hideModal('adjustAdd')">取消</button>
            </ng-template>
          </nz-modal>

          <!-- 弹框 —— 发送 —— 执行发送 -->
          <nz-modal [(nzVisible)]="isAdjustSendVisible" nzWidth="750" nzTitle="执行发送" [nzFooter]="adjustSendModalFooter" (nzOnCancel)="hideModal('adjustSend')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="7" class="spthumbnailan_down">发送对象（总计x个）</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="spthumbnailan_down">奖励配置</div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7" class="spthumbnailan_down">附带消息</div>
              <div nz-col nzSpan="1"></div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="7">
                <textarea rows="5" nz-input [(ngModel)]="adjustSendData.users" [disabled]="true" nzSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7">
                <textarea rows="5" nz-input [(ngModel)]="adjustSendData.config" [disabled]="true" zSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="7">
                <textarea rows="5" nz-input [(ngModel)]="adjustSendData.noticeContent" [disabled]="true" zSize="default"></textarea>
              </div>
              <div nz-col nzSpan="1"></div>
            </div>

            <div nz-row class="search_panel">
              <div nz-col nzSpan="4">
                <nz-select [(ngModel)]="operateObject.operater">
                  <nz-option required *ngFor="let data of operatersData; let i=index;" [nzLabel]="data" [nzValue]="data"></nz-option>
                </nz-select>
              </div>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="doSave('sendMsg')" [disabled]="semdMesCodeText !== 60">{{semdMesCodeText === 60 ? '验证' : semdMesCodeText + 's'}}</button>
              </div>
            </div>

            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment span_down">
                验证码：
              </div>
              <div nz-col nzSpan="2"></div>
              <div nz-col nzSpan="2">
                <input nz-input nzSize="default" maxlength="4" [(ngModel)]="operateObject.code">
              </div>
            </div>
            <!-- 弹框和底部定制 -->
            <ng-template #adjustSendModalFooter>
              <button nz-button nzType="primary" (click)="doSave('adjustSend')" [disabled]="operateObject.code.length !== 4">执行发送</button>
              <button nz-button nzType="default" (click)="hideModal('adjustSend')">放弃</button>
            </ng-template>
          </nz-modal>

          <!-- 弹框 —— 查看 —— 查看详情 -->
          <nz-modal [(nzVisible)]="isAdjustDetailVisible" nzWidth="950" nzTitle="查看详情" [nzFooter]="adjustDetailModalFooter" (nzOnCancel)="hideModal('adjustDetail')">
            <div *ngIf="adjustDetail">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="2"></div>
                <div nz-col nzSpan="5" class="span_down">发放日期<br>{{adjustDetail.createDate ? (adjustDetail.createDate | date:'yyyy-MM-dd') : 'null'}}</div>
                <div nz-col nzSpan="5" class="span_down">发放时间<br>{{adjustDetail.createTime}}</div>
                <div nz-col nzSpan="5" class="span_down">发放人数<br>{{adjustDetail.all}}</div>
                <div nz-col nzSpan="5" class="span_down">失败人数<br>{{adjustDetail.failNum}}</div>
                <!-- adjustDetail.errorRevL.length -->
                <div nz-col nzSpan="2"></div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="11" class="spthumbnailan_down">发送成功（总计{{adjustDetail.successNum}}个）</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="11" class="spthumbnailan_down">奖励配置</div>
                <div nz-col nzSpan="1"></div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="11">
                  <textarea rows="5" nz-input [(ngModel)]="adjustDetail.success" [disabled]="true" nzSize="default"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="11">
                  <textarea rows="5" nz-input [(ngModel)]="(adjustDetail.adjustType === 'BEAN' ? '小悟豆' : adjustDetail.adjustType === 'COIN' ? '小悟币' : null) + '*' + adjustDetail.adjustAmount" [disabled]="true" zSize="default"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
              </div>

              <div nz-row class="search_panel">
                <div nz-col nzSpan="11" class="spthumbnailan_down">失败对象(总计{{adjustDetail.failNum}}个)</div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="11" class="spthumbnailan_down">附带消息</div>
                <div nz-col nzSpan="1"></div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="11">
                  <textarea rows="5" nz-input [(ngModel)]="adjustDetail.fail" [disabled]="true" nzSize="default"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
                <div nz-col nzSpan="11">
                  <textarea rows="5" nz-input [(ngModel)]="adjustDetail.noticeContent" [disabled]="true" nzSize="default"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
              </div>

              <div nz-row class="search_panel">
                <div nz-col nzSpan="11" class="spthumbnailan_down">调整原因</div>
                <div nz-col nzSpan="1"></div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="11">
                  <textarea rows="5" nz-input [(ngModel)]="adjustDetail.adjustReason" [disabled]="true" nzSize="default"></textarea>
                </div>
                <div nz-col nzSpan="1"></div>
              </div>
            </div>
            <!-- 弹框和底部定制 -->
            <ng-template #adjustDetailModalFooter>
              <button nz-button nzType="default" (click)="hideModal('adjustDetail')">关闭</button>
            </ng-template>
          </nz-modal>

        </nz-tab>

        <nz-tab nzTitle="充值记录" (nzClick)="changePanel('recharge')" *ngIf="commonService.haveMenuPermission('children', '数据调整')">
          <form [formGroup]="searchRechargeForm">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">用户账号：</div>
              <div nz-col nzSpan="3">
                <input nz-input maxlength="32" formControlName="phone" [(ngModel)]="rechargePhone" placeholder="输入用户账号" nzSize="default">
              </div>
              <div nz-col nzSpan="1"></div>
              <div nz-col nzSpan="2" class="span_down right_alignment">充值时间：</div>
              <div nz-col nzSpan="7">
                <nz-range-picker [nzFormat]="'yyyyMMdd'" formControlName="date" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'recharge')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="6"></div>
              <div nz-col nzSpan="3">
                <button nz-button nzType="primary" (click)="loadData('recharge')"><i class="anticon anticon-search"></i>查询</button>
              </div>
            </div>
          </form>

          <nz-table #rowSelectionRechargeTable [nzData]="rechargeData" [nzSimple]="true" [nzShowPagination]="true">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户账号</th>
                <th>用户昵称</th>
                <th>充值小悟币</th>
                <th>赠送小悟豆</th>
                <th>支付方式</th>
                <th>充值状态</th>
                <th>充值时间</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionRechargeTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.account}}</td>
                <td>{{data.nickname}}</td>
                <td>{{data.amount}}</td>
                <td>{{data.presentAmount}}</td>
                <td>{{data.paymentType === 'WECHAT_PAY' ? '微信支付' : data.paymentType === 'ALI_PAY' ? '支付宝支付' : 'null'}}</td>
                <td>{{data.status === 'WAITING_FOR_PAY' ? '待支付' : data.status === 'paid' ? '已支付' : data.status === 'DEPOSITED' ? '已充值' : 'null' }}</td>
                <td>{{data.createTime }}</td>
              </tr>
            </tbody>
          </nz-table>

        </nz-tab>

        <nz-tab nzTitle="开票记录" (nzClick)="changePanel('invoice')" *ngIf="commonService.haveMenuPermission('children', '数据调整')">
          <form [formGroup]="searchInvoiceForm">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="2" class="span_down right_alignment">用户账号：</div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="phone" [(ngModel)]="invoicePhone" placeholder="输入用户账号" nzSize="default">
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">开票类型：</div>
              <div nz-col nzSpan="2">
                <nz-select [(ngModel)]="invoiceType" formControlName="type">
                  <nz-option required [nzLabel]="'全部'" nzValue=""></nz-option>
                  <nz-option required [nzLabel]="'机票'" nzValue="FLIGHT"></nz-option>
                  <nz-option required [nzLabel]="'酒店'" nzValue="HOTEL"></nz-option>
                  <nz-option required [nzLabel]="'打车'" nzValue="TAXI"></nz-option>
                  <!-- <nz-option required [nzLabel]="'充话费'" nzValue="COIN"></nz-option> -->
                  <nz-option required [nzLabel]="'闪送'" nzValue="EXPRESS"></nz-option>
                  <!-- <nz-option required [nzLabel]="'星座'" nzValue="COIN"></nz-option> -->
                </nz-select>
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">开票状态：</div>
              <div nz-col nzSpan="2">
                <nz-select [(ngModel)]="invoiceState" formControlName="state">
                  <nz-option required [nzLabel]="'全部状态'" nzValue=""></nz-option>
                  <nz-option required [nzLabel]="'开票失败'" nzValue="0"></nz-option>
                  <nz-option required [nzLabel]="'已开票'" nzValue="1"></nz-option>
                  <nz-option required [nzLabel]="'开票中'" nzValue="2"></nz-option>
                  <nz-option required [nzLabel]="'待开票'" nzValue="3"></nz-option>
                </nz-select>
              </div>
              <div nz-col nzSpan="2" class="span_down right_alignment">充值时间：</div>
              <div nz-col nzSpan="7">
                <nz-range-picker [nzFormat]="'yyyyMMdd'" formControlName="date" nzShowTime [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'invoice')"></nz-range-picker>
              </div>
              <div nz-col nzSpan="2">
                <button nz-button nzType="primary" (click)="loadData('invoice', '')"><i class="anticon anticon-search"></i>查询</button>
              </div>
            </div>
          </form>

          <nz-table #rowSelectionInvoiceTable [nzData]="invoiceData" [nzSimple]="true" [nzShowPagination]="true">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户账号</th>
                <th>用户昵称</th>
                <th>开票金额</th>
                <th>收件邮箱</th>
                <th>开票类型</th>
                <th>开票状态</th>
                <th>申请时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowSelectionInvoiceTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.account}}</td>
                <td>{{data.nickname}}</td>
                <td>{{data.invoicePrice}}</td>
                <td>{{data.invoiceMsg.email}}</td>
                <td>{{data.orderType === 'FlightOrder' ? '机票' : data.orderType === 'HotelOrder' ? '酒店' : data.orderType === 'TaxiOrder' ? '打车' : data.orderType === 'ExpressOrde' ? '闪送' : 'null' }}</td>
                <td>{{data.state === 0 ? '开票失败' : data.state === 1 ? '已开票' : data.state === 2 ? '开票中' : data.state === 3 ? '待开票' : 'null'}}</td>
                <td>{{data.createTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('invoiceInfoDetail', data)" style="margin-right: 10px;">查看</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <!-- 弹框 —— 信息 —— 开票详情 -->
          <nz-modal [(nzVisible)]="isInvoiceDetailVisible" nzWidth="950" nzTitle="开票详情" [nzFooter]="invoiceDetailModalFooter" (nzOnCancel)="hideModal('invoiceInfoDetail')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">用户账号：</div> <div nz-col nzSpan="8">{{invoiceItem.account}}</div>
              <div nz-col nzSpan="4" class="right_alignment">用户昵称：</div> <div nz-col nzSpan="8">{{invoiceItem.nickname}}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">开票金额：</div> <div nz-col nzSpan="8">{{invoiceItem.invoicePrice}}</div>
              <div nz-col nzSpan="4" class="right_alignment">申请时间：</div> <div nz-col nzSpan="8">{{invoiceItem.createTime}}</div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="right_alignment">开票状态：</div> <div nz-col nzSpan="8">{{invoiceItem.state}}</div>
              <div nz-col nzSpan="4" class="right_alignment">开票类型：</div> <div nz-col nzSpan="8">{{invoiceItem.type}}</div>
            </div>
            <div *ngIf="invoiceItem.invoiceMsg">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">公司名称：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.invoiceName}}</div>
                <div nz-col nzSpan="4" class="right_alignment">纳税人识别号：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.dutyParagraph}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">收件邮箱：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.email}}</div>
                <div nz-col nzSpan="4" class="right_alignment">手机号：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.phone}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">注册地址：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.registerAdd}}</div>
                <div nz-col nzSpan="4" class="right_alignment">注册电话：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.registerPhone}}</div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="4" class="right_alignment">开户银行：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.bank}}</div>
                <div nz-col nzSpan="4" class="right_alignment">开户账户：</div> <div nz-col nzSpan="8">{{invoiceItem.invoiceMsg.account}}</div>
              </div>
            </div>
            <nz-table #rowSelectionInvoiceDetailTable [nzData]="invoiceItem.orderIds">
              <thead>
                <tr>
                  <th>序号</th> <th>订单号</th> <th>出发地</th> <th>目的地</th> <th>订单金额</th> <th>订单状态</th> <th>出发时间</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of rowSelectionInvoiceDetailTable.data; let i=index;">
                  <td>{{i+1}}</td> <td>{{data}}</td> <td>{{data.aaaaa}}</td> <td>{{data.aaaaa}}</td> <td>{{data.aaaaa}}</td> <td>{{data.aaaaa}}</td> <td>{{data.aaaaa}}</td>
                </tr>
              </tbody>
            </nz-table>
            <!-- 弹框和底部定制 -->
            <ng-template #invoiceDetailModalFooter>
              <button nz-button nzType="default" (click)="hideModal('invoiceDetail')">取消</button>
            </ng-template>
          </nz-modal>

        </nz-tab>

      </nz-tabset>
    </nz-card-tab>
  </nz-card>
</div>
