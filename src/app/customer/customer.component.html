<app-left-nav></app-left-nav>
<div class="user" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">
  <nz-card style="width: 100%;">
    <nz-card-tab>
      <nz-tabset nzSize="large">

        <nz-tab nzTitle="用户反馈" (nzClick)="changePanel('feedback')" *ngIf="commonService.haveMenuPermission('children', '用户反馈')">
          <nz-table #rowFeedBackTable [nzData]="feedbackInfo" [nzSimple]="true" [(nzPageSize)]="feedBackPageSize" [nzShowPagination]="false">
            <thead>
              <tr>
                <th nzWidth="100px">序号</th>
                <th nzWidth="100px">问题描述</th>
                <th nzWidth="100px">图片（张）</th>
                <th nzWidth="100px">手机号或邮箱</th>
                <th nzWidth="100px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowFeedBackTable.data; let i=index;">
                <td nzWidth="100px">{{i + 1}}</td>
                <td nzWidth="100px">{{data.words ? data.words : 'null'}}</td>
                <td nzWidth="100px">{{data.photo ? (data.photo.length === 0 ? '0' : data.photo.length) : '0'}}</td>
                <td nzWidth="100px">{{data.number ? data.number : 'null'}}</td>
                <td nzWidth="100px">
                  <button nz-button nzType="primary" (click)="showFeedbackInfo(data)" style="margin-right: 10px;">查看详情</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <!-- 弹框 —— 信息 —— 反馈详情 -->
          <nz-modal [(nzVisible)]="isFeedBackVisible" nzWidth="750" nzTitle="反馈详情" [nzFooter]="feedBackModalFooter" (nzOnCancel)="hideFeedBack()">
            <form style="font-size: 0.4rem;line-height: 1rem;">
              <div nz-row class="search_panel">
                <div nz-col nzSpan="8" class="right_alignment">问题描述：</div>
                <div nz-col nzSpan="12">{{tempFeedBack.words ? tempFeedBack.words : 'null'}}</div>
                <div nz-col nzSpan="4"></div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="8" class="right_alignment">手机号或邮箱：</div>
                <div nz-col nzSpan="12">{{tempFeedBack.number ? tempFeedBack.number : 'null'}}</div>
                <div nz-col nzSpan="4"></div>
              </div>
              <div nz-row class="search_panel">
                <div nz-col nzSpan="8" class="right_alignment">图片（张）：</div>
                <div nz-col nzSpan="12">{{!tempFeedBack.photo ? 'null' : ''}}</div>
                <div nz-col nzSpan="4"></div>
              </div>
              <ng-container *ngIf="tempFeedBack.photo">
                <div nz-row class="search_panel" *ngFor="let item of tempFeedBack.photo; let i=index;" style="margin-bottom: 8px;">
                   <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="4"></div>
                  <div nz-col nzSpan="12"><img [src]="commonService.baseUrl.substring(0, commonService.baseUrl.indexOf('/admin')) + '/feedback/img/' + item" style="width: 350px;"></div>
                  <div nz-col nzSpan="4"></div>
                </div>
              </ng-container>
            </form>
            <!-- 弹框和底部定制 -->
            <ng-template #feedBackModalFooter>
              <button nz-button nzType="default" (click)="hideFeedBack()">取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab nzTitle="点踩日志" (nzClick)="changePanel('opposition')" *ngIf="commonService.haveMenuPermission('children', '点踩日志')">
          <!-- <div nz-row class="search_panel">
            <div nz-col nzSpan="24">
              <button nz-button nzType="primary" (click)="getExcel('opposition')"><i class="anticon anticon-search"></i>点踩对话日志</button>
            </div>
          </div> -->

          <nz-table #rowOppositionTable [nzData]="oppositionInfo" [nzSimple]="true" [(nzPageSize)]="oppositionPageSize" [nzShowPagination]="false">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户昵称</th>
                <th>用户账号</th>
                <th>上传时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowOppositionTable.data; let i=index;">
                <td>{{i + 1}}</td>
                <td>{{data.nickName ? data.nickName : data.userId}}</td>
                <td>{{data.phone ? data.phone : data.userId}}</td>
                <td>{{data.date}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showOppositionInfo(data)" style="margin-right: 10px;">查看详情</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <!-- 弹框 —— 信息 —— 点踩对话日志详情 -->
          <nz-modal [(nzVisible)]="isOppositionVisible" nzWidth="1400" nzTitle="点踩对话日志详情" [nzFooter]="oppositionModalFooter" (nzOnCancel)="hideOpposition()">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="24">
                <button nz-button nzType="primary" (click)="getExcel('opposition')"><i class="anticon anticon-download"></i>导出点踩对话日志</button>
              </div>
            </div>

            <ng-container *ngIf="tempOpposition.session">
              <ng-container *ngFor="let item of tempOpposition.session">
                <div nz-row class="search_panel" style="background-color: #DFF0D8;">
                  <div nz-col nzSpan="24">
                    <i class="anticon anticon-question"></i>
                    用户提问&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#bfbfbf">{{item.create}}</font>
                    <br>
                    {{item.ask}}
                  </div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="24">
                    <i class="anticon anticon-exclamation"></i>
                    齐悟回答&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#bfbfbf">{{item.create}}</font>
                    <br>
                    {{item.cpsAnswer}}
                  </div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="24">
                    <i class="anticon anticon-exclamation"></i>
                    子bot回答&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#bfbfbf">{{item.create}}</font>
                    <br>
                    {{item.businessAnswer}}
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <!-- 弹框和底部定制 -->
            <ng-template #oppositionModalFooter>
              <button nz-button nzType="default" (click)="hideOpposition()">取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab nzTitle="点赞日志" (nzClick)="changePanel('agree')" *ngIf="commonService.haveMenuPermission('children', '点赞日志')">
          <!-- <div nz-row class="search_panel">
            <div nz-col nzSpan="24">
              <button nz-button nzType="primary" (click)="getExcel('agree')"><i class="anticon anticon-search"></i>点赞对话日志</button>
            </div>
          </div> -->

          <nz-table #rowAgreeTable [nzData]="agreeInfo" [nzSimple]="true" [(nzPageSize)]="agreePageSize" [nzShowPagination]="false">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户昵称</th>
                <th>用户账号</th>
                <th>上传时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowAgreeTable.data; let i=index;">
                <td>{{i + 1}}</td>
                <td>{{data.nickName ? data.nickName : data.userId}}</td>
                <td>{{data.phone ? data.phone : data.userId}}</td>
                <td>{{data.date}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showAgreeInfo(data)" style="margin-right: 10px;">查看详情</button>
                </td>
              </tr>
            </tbody>
          </nz-table>

          <!-- 弹框 —— 信息 —— 点赞对话日志详情 -->
          <nz-modal [(nzVisible)]="isAgreeVisible" nzWidth="1400" nzTitle="点赞对话日志详情" [nzFooter]="agreeModalFooter" (nzOnCancel)="hideAgree()">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="24">
                <button nz-button nzType="primary" (click)="getExcel('agree')"><i class="anticon anticon-download"></i>导出点赞对话日志</button>
              </div>
            </div>

            <ng-container *ngIf="tempAgree.session">
              <ng-container *ngFor="let item of tempAgree.session">
                <div nz-row class="search_panel" style="background-color: #DFF0D8;">
                  <div nz-col nzSpan="24">
                    <i class="anticon anticon-question"></i>
                    用户提问&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#bfbfbf">{{item.create}}</font>
                    <br>
                    {{item.ask}}
                  </div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="24">
                    <i class="anticon anticon-exclamation"></i>
                    齐悟回答&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#bfbfbf">{{item.create}}</font>
                    <br>
                    {{item.cpsAnswer}}
                  </div>
                </div>
                <div nz-row class="search_panel">
                  <div nz-col nzSpan="24">
                    <i class="anticon anticon-exclamation"></i>
                    子bot回答&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#bfbfbf">{{item.create}}</font>
                    <br>
                    {{item.businessAnswer}}
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <!-- 弹框和底部定制 -->
            <ng-template #agreeModalFooter>
              <button nz-button nzType="default" (click)="hideAgree()">取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>

        <nz-tab nzTitle="开票时间管理" (nzClick)="changePanel('invoiceTime')" *ngIf="commonService.haveMenuPermission('children', '开票时间管理')">
          <div nz-row class="search_panel">
            <form [formGroup]="searchInvoiceTimeForm">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                用户账号：
              </div>
              <div nz-col nzSpan="2">
                <input nz-input maxlength="32" formControlName="phone" placeholder="输入订单编号"
                  nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                订单号：
              </div>
              <div nz-col nzSpan="2">
                <input nz-input maxlength="32" formControlName="orderId" placeholder="输入订单编号"
                  nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                订单类型：
              </div>
              <div nz-col nzSpan="3">
                <nz-select [ngModel]="1" formControlName="orderType">
                  <nz-option required [nzLabel]="'机票'" [nzValue]="1"></nz-option>
                  <nz-option required [nzLabel]="'酒店'" [nzValue]="3"></nz-option>
                  <nz-option required [nzLabel]="'打车'" [nzValue]="4"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="2" class="span_down right_alignment">
                订单时间：
              </div>
              <div nz-col nzSpan="7" class="span_down">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'invoiceTime')"></nz-range-picker>
              </div>

            </form>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('invoiceTime')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #rowInvoiceTimeTable [nzData]="invoiceTimeInfo.olderList" [nzSimple]="true">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户账号</th>
                <th>用户昵称</th>
                <th>订单号</th>
                <th>订单类型</th>
                <th>订单金额</th>
                <th>订单出行时间</th>
                <th>可开票状态</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowInvoiceTimeTable.data; let i=index;">
                <td>{{i + 1}}</td>
                <td>{{data.userAccountID}}</td>
                <td>{{data.userName}}</td>
                <td>{{data.orderId}}</td>
                <td>{{data.orderType === 0 || data.orderType === 1 ? '机票' : data.orderType === 2 ? '火车' : data.orderType === 3 ? '酒店' : data.orderType === 4 ? '打车' : 'null'}}</td>
                <td>{{data.money}}</td>
                <td>{{data.createTime}}</td>
                <td>
                  <nz-form-item>
                    <nz-form-control>
                      <nz-switch [(ngModel)]="data.drawBill" (click)="clickSwitch(data, 'invoiceTime')"></nz-switch>
                    </nz-form-control>
                  </nz-form-item>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </nz-tab>

        <nz-tab nzTitle="开票管理日志" (nzClick)="changePanel('invoiceLog')" *ngIf="commonService.haveMenuPermission('children', '开票时间管理')">
          <div nz-row class="search_panel">
            <form [formGroup]="searchInvoiceLogForm">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                用户账号：
              </div>
              <div nz-col nzSpan="2">
                <input nz-input maxlength="32" formControlName="phone" placeholder="输入订单编号"
                  nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                订单号：
              </div>
              <div nz-col nzSpan="2">
                <input nz-input maxlength="32" formControlName="orderId" placeholder="输入订单编号"
                  nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                订单类型：
              </div>
              <div nz-col nzSpan="3">
                <nz-select [ngModel]="''" formControlName="orderType">
                  <nz-option required [nzLabel]="'全部'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'机票'" [nzValue]="1"></nz-option>
                  <nz-option required [nzLabel]="'火车'" [nzValue]="2"></nz-option>
                  <nz-option required [nzLabel]="'酒店'" [nzValue]="3"></nz-option>
                  <nz-option required [nzLabel]="'打车'" [nzValue]="4"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="2" class="span_down right_alignment">
                订单时间：
              </div>
              <div nz-col nzSpan="7" class="span_down">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'invoiceLog')"></nz-range-picker>
              </div>

            </form>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('invoiceLog')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #rowInvoiceTimeTable [nzData]="invoiceLogInfo.adminBillLogsList" [nzSimple]="true">
            <thead>
              <tr>
                <th>序号</th>
                <th>用户账号</th>
                <th>用户昵称</th>
                <th>订单号</th>
                <th>订单类型</th>
                <th>订单金额</th>
                <th>操作人</th>
                <th>操作时间</th>
                <th>操作动作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rowInvoiceTimeTable.data; let i=index;">
                <td>{{i + 1}}</td>
                <td>{{data.userAccountID}}</td>
                <td>{{data.userName}}</td>
                <td>{{data.orderId}}</td>
                <td>{{data.orderType === 0 || data.orderType === 1 ? '机票' : data.orderType === 2 ? '火车' : data.orderType === 3 ? '酒店' : data.orderType === 4 ? '打车' : 'null'}}</td>
                <td>{{data.money}}</td>
                <td>{{data.adminName}}</td>
                <td>{{data.operaTime | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                <td>{{data.open === true ? '开启可开票状态' : '关闭可开票状态'}}</td>
              </tr>
            </tbody>
          </nz-table>
        </nz-tab>

      </nz-tabset>
    </nz-card-tab>
  </nz-card>
</div>
