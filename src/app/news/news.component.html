<app-left-nav></app-left-nav>
<div class="news" [ngStyle]="{'left': !commonService.isLeftNavClose ? 'calc(240px)' : 'calc(80px)','width': !commonService.isLeftNavClose ? 'calc(100% - 240px)' : 'calc(100% - 80px)'}">
  <nz-card style="width: 100%;">
    <nz-card-tab>
      <nz-tabset nzSize="large">

        <nz-tab [nzTitle]="taggingNewsTemplate" (nzClick)="changePanel('taggingNews')" *ngIf="commonService.haveMenuPermission('children', '人工标注')">
          <ng-template #taggingNewsTemplate><i class="anticon anticon-tag-o"></i>人工标注</ng-template>
          <div nz-row class="search_panel">
            <form [formGroup]="taggingNewsSearchForm">
              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                标注状态：
              </div>
              <div nz-col nzSpan="4">
                <nz-select formControlName="status">
                  <nz-option required [nzLabel]="'全部'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'未完成'" [nzValue]="'NEW'"></nz-option>
                  <nz-option required [nzLabel]="'已完成'" [nzValue]="'MARKED'"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                上传时间：
              </div>
              <div nz-col nzSpan="7">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'taggingNews')" nzShowTime></nz-range-picker>
              </div>

            </form>
            <div nz-col nzSpan="7"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('taggingNews')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #taggingNewsTable [nzData]="dataTaggingNews" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">词条数</th>
                <th nzWidth="20px">已分类词条数</th>
                <th nzWidth="20px">标注状态</th>
                <th nzWidth="20px">上传时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of taggingNewsTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.totalCount}}</td>
                <td>{{data.markedCount}}</td>
                <td>{{data.status === 'NEW' ? '未完成' : data.status === 'MARKED' ? '已完成' : ''}}</td>
                <td>{{data.uploadTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('sortSpeech', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>词条分类</button>
                  <button nz-button nzType="primary" (click)="showModal('submitTagAudit', data)" [disabled]="data.status === 'NEW'" style="margin-right: 10px;"><i class="anticon anticon-form"></i>提交审核</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="isSortSpeechVisible" nzWidth="750" nzTitle="词性分类" [nzFooter]="sortSpeechFooter" (nzOnCancel)="hideModal('sortSpeech')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="3" class="span_down right_alignment">
                标注本页：
              </div>
              <div nz-col nzSpan="21" class="span_down">
                <nz-radio-group [(ngModel)]="sortSpeechDate.type" (ngModelChange)="onChange($event, 'sortPage')">
                  <label nz-radio nzValue="PERSON">人名</label>
                  <label nz-radio nzValue="ADDRESS">地名</label>
                  <label nz-radio nzValue="EVENT">事件</label>
                  <label nz-radio nzValue="INVALID">无效</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="24">
                <nz-table #sortSpeechTable [nzData]="dataSortSpeech" *ngIf="!isSpinning" (nzPageSizeChange)="sortSpeechPage">
                  <thead>
                    <tr>
                      <th nzWidth="20px">序号</th>
                      <th nzWidth="20px">词条</th>
                      <th nzWidth="20px">词性分类</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of sortSpeechTable.data; let i=index;">
                      <td>{{i+1}}</td>
                      <td>{{data.word}}</td>
                      <td>
                        <nz-radio-group [(ngModel)]="data.type" (ngModelChange)="onChange({result: $event, index: data.index}, 'sortCell')">
                          <label nz-radio nzValue="PERSON">人名</label>
                          <label nz-radio nzValue="ADDRESS">地名</label>
                          <label nz-radio nzValue="EVENT">事件</label>
                          <label nz-radio nzValue="INVALID">无效</label>
                        </nz-radio-group>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
            <ng-template #sortSpeechFooter>
              <button nz-button nzType="primary" (click)="doSave('sortSpeech', '')"><i class="anticon anticon-save"></i>保存</button>
              <button nz-button nzType="default" (click)="hideModal('sortSpeech')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>


        <nz-tab [nzTitle]="manualAuditTemplate" (nzClick)="changePanel('manualAudit')" *ngIf="commonService.haveMenuPermission('children', '人工审核')">
          <ng-template #manualAuditTemplate><i class="anticon anticon-tag-o"></i>人工审核</ng-template>
          <div nz-row class="search_panel">
            <form [formGroup]="manualAuditSearchForm">

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                提交审核来源：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="submitter" placeholder="输入提交审核来源" nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                审核状态：
              </div>
              <div nz-col nzSpan="3">
                <nz-select formControlName="status">
                  <nz-option required [nzLabel]="'全部'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'未审核'" [nzValue]="'SUBMITTED'"></nz-option>
                  <nz-option required [nzLabel]="'已审核'" [nzValue]="'CONFIRMED'"></nz-option>
                  <nz-option required [nzLabel]="'已更新'" [nzValue]="'UPDATED'"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                提交时间：
              </div>
              <div nz-col nzSpan="7">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'manualAudit')" nzShowTime></nz-range-picker>
              </div>

            </form>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('manualAudit')"><i class="anticon anticon-search"></i>查询</button>
            </div>
            <div nz-col nzSpan="3">
              <button nz-button nzType="primary" (click)="showModal('uploadAudit')"><i class="anticon anticon-search"></i>上传审核</button>
            </div>
          </div>
          <nz-table #manualAuditTable [nzData]="dataManualAudit" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">提交审核来源</th>
                <th nzWidth="20px">词条数</th>
                <th nzWidth="20px">提交时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of manualAuditTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.submitter}}</td>
                <td>{{data.totalCount}}</td>
                <td>{{data.submitTime}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal(data.status === 'SUBMITTED' || data.status === 'CONFIRMED' ? 'manualAudit' : data.status === 'CONFIRMED' ? '' : '', data)" [disabled]="data.status === 'UPDATED'" style="margin-right: 10px;">
                    <i class="anticon anticon-form"></i>{{data.status === 'SUBMITTED' ? '待审核' : data.status === 'CONFIRMED' || data.status === 'UPDATED' ? '已审核' : ''}}
                  </button>
                  <button nz-button nzType="primary" (click)="showModal(data.status === 'CONFIRMED' ? 'updateLoading'  : '', data)" [disabled]="data.status === 'SUBMITTED' || data.status === 'UPDATED'" style="margin-right: 10px;">
                    <i class="anticon anticon-form"></i>{{data.status === 'SUBMITTED' || data.status === 'CONFIRMED' ? '待更新' : data.status === 'UPDATED' ? '已更新' : ''}}
                  </button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

          <nz-modal [(nzVisible)]="isManualAuditVisible" nzWidth="950" nzTitle="审核" [nzFooter]="manualAuditFooter" (nzOnCancel)="hideModal('manualAudit')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="24">
                <nz-table #sortSpeechTable [nzData]="dataSortSpeech" *ngIf="!isSpinning">
                  <thead>
                    <tr>
                      <th nzWidth="20px">序号</th>
                      <th nzWidth="20px">词条</th>
                      <th nzWidth="20px">词性分类</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of sortSpeechTable.data; let i=index;">
                      <td>{{i+1}}</td>
                      <td>{{data.word}}</td>
                      <td>
                        <nz-radio-group [(ngModel)]="data.type" (ngModelChange)="onChange({result: $event, index: data.index}, 'sortCell')">
                          <label nz-radio nzValue="PERSON">人名</label>
                          <label nz-radio nzValue="ADDRESS">地名</label>
                          <label nz-radio nzValue="EVENT">事件</label>
                          <label nz-radio nzValue="INVALID">无效</label>
                        </nz-radio-group>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
            <ng-template #manualAuditFooter>
              <button nz-button nzType="primary" (click)="doSave('manualAudit', '')"><i class="anticon anticon-save"></i>审核通过</button>
              <button nz-button nzType="default" (click)="hideModal('manualAudit')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>

          <nz-modal [(nzVisible)]="isUploadAuditVisible" nzTitle="上传审核文件" [nzFooter]="uploadMarkedFooter" (nzOnCancel)="hideModal('uploadMarked')">
            <div nz-row class="search_panel">
              <div nz-col nzSpan="4" class="span_down spacing right_alignment">
                词性类型：
              </div>
              <div nz-col nzSpan="20">
                <nz-radio-group [(ngModel)]="uploadMarkedData.type">
                  <label nz-radio nzValue="PERSON">人名</label>
                  <label nz-radio nzValue="ADDRESS">地名</label>
                  <label nz-radio nzValue="EVENT">事件</label>
                  <label nz-radio nzValue="INVALID">无效</label>
                </nz-radio-group>
              </div>
            </div>
            <div nz-row class="search_panel">
              <div nz-col nzSpan="24">
                <nz-upload [(nzFileList)]="fileList" [nzShowButton]="fileList.length < 1" nzMultiple [nzBeforeUpload]="beforeUpload">
                  <button nz-button>
                    <i class="anticon anticon-upload"></i><span>选择文件</span>
                  </button>
                </nz-upload>
              </div>
            </div>
            <ng-template #uploadMarkedFooter>
              <button nz-button nzType="default" (click)="hideModal('uploadMarked')"><i class="anticon anticon-close-circle-o"></i>取消</button>
            </ng-template>
          </nz-modal>
        </nz-tab>



        <nz-tab [nzTitle]="newsThesaurusTemplate" (nzClick)="changePanel('newsThesaurus')" *ngIf="commonService.haveMenuPermission('children', '新闻词库')">
          <ng-template #newsThesaurusTemplate><i class="anticon anticon-tag-o"></i>新闻词库</ng-template>
          <div nz-row class="search_panel">
            <form [formGroup]="newsThesaurusSearchForm">

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                新闻词库：
              </div>
              <div nz-col nzSpan="3">
                <nz-select formControlName="type">
                  <nz-option [nzLabel]="'----无----'" [nzValue]="''"></nz-option>
                  <nz-option required [nzLabel]="'人名'" [nzValue]="'PERSON'"></nz-option>
                  <nz-option required [nzLabel]="'地名'" [nzValue]="'ADDRESS'"></nz-option>
                  <nz-option required [nzLabel]="'事件'" [nzValue]="'EVENT'"></nz-option>
                  <nz-option required [nzLabel]="'无效'" [nzValue]="'INVALID'"></nz-option>
                </nz-select>
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                词条名称：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="name" placeholder="输入词条名称" nzSize="default">
              </div>

            </form>
            <div nz-col nzSpan="12"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('newsThesaurus')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #newsThesaurus [nzData]="dataNewsThesaurus" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">词条</th>
                <th nzWidth="20px">修改词性</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of newsThesaurus.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.word}}</td>
                <td>
                  <nz-radio-group [(ngModel)]="data.type">
                    <label nz-radio nzValue="PERSON">人名</label>
                    <label nz-radio nzValue="ADDRESS">地名</label>
                    <label nz-radio nzValue="EVENT">事件</label>
                    <label nz-radio nzValue="INVALID">无效</label>
                  </nz-radio-group>
                  <button nz-button nzType="primary" (click)="doSave('modifyNewsThesaurus', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>保存</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

        </nz-tab>




        <nz-tab [nzTitle]="newsNERTemplate" (nzClick)="changePanel('newsNER')" *ngIf="commonService.haveMenuPermission('children', '新闻NER')">
          <ng-template #newsNERTemplate><i class="anticon anticon-tag-o"></i>新闻NER</ng-template>
          <div nz-row class="search_panel">
            <form [formGroup]="newsNERSearchForm">

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                断句库名称：
              </div>
              <div nz-col nzSpan="3">
                <input nz-input formControlName="aaa" placeholder="输入断句库名称" nzSize="default">
              </div>

              <div nz-col nzSpan="2" class="span_down spacing right_alignment">
                上传时间：
              </div>
              <div nz-col nzSpan="7">
                <nz-range-picker formControlName="date" [nzFormat]="'yyyy-MM-dd HH:mm:ss'" [nzShowToday]="true" ngModel [nzRanges]="dateSearch" (ngModelChange)="onChange($event, 'newsNER')" nzShowTime></nz-range-picker>
              </div>

            </form>
            <div nz-col nzSpan="8"></div>
            <div nz-col nzSpan="2">
              <button nz-button nzType="primary" (click)="loadData('newsNER')"><i class="anticon anticon-search"></i>查询</button>
            </div>
          </div>
          <nz-table #newsNERTable [nzData]="datanewsNER" *ngIf="!isSpinning">
            <thead>
              <tr>
                <th nzWidth="20px">序号</th>
                <th nzWidth="20px">断句库名称</th>
                <th nzWidth="20px">段距数量</th>
                <th nzWidth="20px">上传时间</th>
                <th nzWidth="20px">操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of newsNERTable.data; let i=index;">
                <td>{{i+1}}</td>
                <td>{{data.appChannel}}</td>
                <td>{{data.appChannelName}}</td>
                <td>{{data.appChannelName}}</td>
                <td>
                  <button nz-button nzType="primary" (click)="showModal('newsNER', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>测试</button>
                  <button nz-button nzType="primary" (click)="showModal('newsNER', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>提取</button>
                  <button nz-button nzType="primary" (click)="showModal('newsNER', data)" style="margin-right: 10px;"><i class="anticon anticon-form"></i>查看结果</button>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <div class="spin" *ngIf="isSpinning">
            <nz-spin [nzSize]="'large'"></nz-spin>
          </div>

        </nz-tab>

      </nz-tabset>
    </nz-card-tab>
  </nz-card>
</div>
